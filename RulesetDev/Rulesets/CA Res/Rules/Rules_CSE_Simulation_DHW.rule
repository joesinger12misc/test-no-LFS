; -------------------------------------------------------------------------
; Rules pertaining to:   Prep For and Clean-up After each CSE Energy Simulation
; CEC Title-24 Residential Energy Code
; -------------------------------------------------------------------------
; Copyright (c) 2012-2014, California Energy Commission
; Copyright (c) 2012-2014, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP       )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER     )  }
	"Delete all cseDHWHEATREC components"			Proj:Action = {	DeleteAllComps( cseDHWHEATREC    )  }  ; SAC 1/7/19
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS        )  }
	"Delete all cseDHWSOLARCOLLECTOR components" Proj:Action = {	DeleteAllComps( cseDHWSOLARCOLLECTOR )  }    ; SAC 1/15/20
	"Delete all cseDHWSOLARSYS components"			Proj:Action = {	DeleteAllComps( cseDHWSOLARSYS       )  }    ; SAC 1/15/20
	"Delete all DwellUnitDHW components"			Proj:Action = {	DeleteAllComps( DwellUnitDHW     )  }	; SAC 5/11/16


   "Create and setup cseDHWSOLARSYS & cseDHWSOLARCOLLECTOR objects"  DHWSolarSys:Action  =      ; SAC 1/15/20 (tic #1013)    ; SAC 6/23/20 - prevent creation of cseDHWSOL... for OG-300 solar systems (tic #1210)
      {  if (IfValidAnd( ErrID > 0 )==0 .AND. RatingProgram != 3 .AND.
             IfValidAnd( FloorAreaServed > 0.1 ))
         then  EvalRulelist( "CSE_SimulationPrep_DHW_SolarSys", 1 )
         else  UNCHANGED  endif  }
   "Set DHWSys:CSESolarSysSimValid"    DHWSys:CSESolarSysSimValid  =    ; SAC 1/15/20 (tic #1013)    ; SAC 6/23/20 - added logic to prevent CSESolarSYs sim for OG-300 systems (SSF only) (tic #1210)
      {  if (LocalCompAssigned( DHWSolarSysRef ) < 1) then  0
         else if (IfValidAnd( DHWSolarSysRef:CSESimValid > 0 ) .AND.
                  IfValidAnd( DHWSolarSysRef:RatingProgram != 3 )) then  1
         else  0  endif endif  }


	; SAC 4/25/16 - added creation of DHWMETER obejcts
	"Create site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (CSEDHWUseMethod < 2) then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrFXMix" )  endif  }
	"Create site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (CSEDHWUseMethod < 2) then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrWH" )  endif  }

;	Descriptions of DHW system types defined in the Res ACM, appendix E, section E1:
;	--------------------------------------------------------------------------------------------------------------------
;		1	One distribution system with one or multiple water heaters serving a single dwelling unit. The system might include
;			recirculation loops within the dwelling unit.  
;		2	Two water heaters with independent distribution systems serving a single dwelling unit. One or more of the
;			distribution systems may include a recirculation loop within the dwelling unit.  
;		3	One distribution system without recirculation loop and with one or multiple water heaters serving multiple
;			dwelling units.  
;		4	One distribution system with one or multiple recirculation loops and with one or multiple water heaters serving
;			multiple units.  
;	--------------------------------------------------------------------------------------------------------------------

  ; CSE DHWSYS creation & setup
	; SAC 10/26/15 - revised to create cseDHWSYS by DHWSys only for SFam, and (potentially multiple) cseDHWSys objects for each DwellUnitType for MFam
   ; new logic to prevent creation of main home cseDHWSYS for Addition Alone projects where addition is entirely ADU - SAC 06/01/21 (tic #1218)
	"Create a CSE DHWSYS for each DHWSys-1"	   DHWSys:cseDHWSYSRef[1]	   			=
      {  if (IfValidAnd( SimDHWSys > 0.5 )==0 .OR. (Proj:IsMultiFamily > 0.5 .AND. CentralDHW < 0.5)) then  UNCHANGED
         else if (Proj:IsMultiFamily < 0.5 .AND. Proj:RunScope == 1 .AND. Proj:IsAddAlone > 0 .AND.
                  IfValidAnd( Proj:UseSFamADUArea > 0 ) .AND. IfValidAnd( Proj:UseSFamADUArea >= Proj:AddAloneAddedArea )) then  UNCHANGED
         else  CreateComp( cseDHWSYS, "dhwsys-" + substr( Name, 0, 47 ) )  endif endif  }
	"Set DHWSys:cseDHWSYSRef[1]:SourceDHWSys"		DHWSys:cseDHWSYSRef[1]:SourceDHWSys	= {	Name  }
	"Set DHWSys:cseDHWSYSRef[1]:SFamMainDayUse"	DHWSys:cseDHWSYSRef[1]:SFamMainDayUse	 = {
	      if (CountOccurrences( cseDHWSYS:SFamMainDayUse, 1 ) < 1)
	      then  1           ; first DHWSys that will serve as the main dwelling gain system
	      else  0
	      endif  }

   ; SAC 4/22/19 - create second cseDHWSys object for SFam ADUs (tic #1010)
	"Create a CSE DHWSYS for each DHWSys-2"	   DHWSys:cseDHWSYSRef[2]	   			= {	if (IfValidAnd( SimDHWSys > 0.5 )==0 .OR. Proj:IsMultiFamily > 0.5 .OR. Proj:SFamADUType < 1 .OR.
	                                                                                           IfValidAnd( Proj:UseSFamADUNumBedrooms >= 0 )==0 .OR. IfValidAnd( Proj:UseSFamADUArea > 0 )==0) then  UNCHANGED
																									      			else  CreateComp( cseDHWSYS, "dhwadu-" + substr( Name, 0, 47 ) )  endif  }
	"Set DHWSys:cseDHWSYSRef[2]:SourceDHWSys"		DHWSys:cseDHWSYSRef[2]:SourceDHWSys	= {	Name  }
	"Set DHWSys:cseDHWSYSRef[2]:SFamADUDayUse"	DHWSys:cseDHWSYSRef[2]:SFamADUDayUse	 = {
	      if (CountOccurrences( cseDHWSYS:SFamADUDayUse, 1 ) < 1)
	      then  1          ; first ADU DHWSys that will serve as the main gain system
	      else  0
	      endif  }

   "Create a CSE DHWSYS for each non-central OtherZone serving as DwellUnit:WasherZoneRef"      ; SAC 10/2/19 - MFamProto
      OtherZone:cseDHWSYSRef  =
         {  if (Proj:IsMultiFamily < 0.5 .OR. LocalCompAssigned( ozDHWSys ) < 1) then  UNDEFINED
            else if (IfValidAnd( WasherDwellUnits > 0 ) .OR. IfValidAnd( Appl_DishGain > 0 ) .OR.
                     IfValidAnd( Appl_WasherGain > 0 ))
            then  if (IfValidAnd( ozDHWSys:CentralDHW > 0 ))
                  then  ozDHWSys:cseDHWSYSRef[1]
                  else  CreateComp( cseDHWSYS, "dhwsys-" + substr( Name, 0, 47 ) )
                  endif
            else  UNDEFINED  endif endif  }
   "Set OtherZone:cseDHWSYSRef:SourceOtherZone"    OtherZone:cseDHWSYSRef:SourceOtherZone	 =
      {  if (IfValidAnd( ozDHWSys:CentralDHW > 0 )==0) then  Name  else  UNCHANGED  endif  }

;"dbg" DHWSys:Action = { if (LocalCompAssigned( DHWHeater[1] )==0) then  MessageBox( "setup DHWSys '%s' (run %s) as autosized CHPWH (w/ no Htr[1])?  CentralDHWTypeVal=%g  CHPWHSysDescrip=%g  CHPWHCompAutosizeSim=%g", Name, Proj:RunAbbrev, ValidOr( CentralDHWTypeVal, -999 ), ValidOr( CHPWHSysDescrip, -999 ), ValidOr( CHPWHCompAutosizeSim, -999 ) )
;                                                                  else  MessageBox( "setup DHWSys '%s' (run %s) as autosized CHPWH (w/ Htr[1] assigned)?  CentralDHWTypeVal=%g  CHPWHSysDescrip=%g  CHPWHCompAutosizeSim=%g", Name, Proj:RunAbbrev, ValidOr( CentralDHWTypeVal, -999 ), ValidOr( CHPWHSysDescrip, -999 ), ValidOr( CHPWHCompAutosizeSim, -999 ) )  endif }
   "Import & setup DHWSys:DHWHeater[1] for CHPWH needing sizing"     DHWSys:Action  =        ; SAC 07/05/21 (tic #1275)
      {  if (IfValidAnd( CentralDHWTypeVal = 2 ) .AND. LocalCompAssigned( DHWHeater[1] )==0 .AND.
             IfValidAnd( CHPWHSysDescrip   = 2 ) .AND. IfValidAnd( CHPWHCompAutosizeSim > 0 ))
         then  EvalRulelist( "Setup_CentralHPWH_LargeAutosized", 1 )
         else  UNCHANGED  endif  }
   "Set cseDHWSYS:IsStdLargeCHPWH (if applicable)"    cseDHWSYS:IsStdLargeCHPWH =         ; SAC 07/10/21 (tic #1275)
      {  if (IfValidAnd( SourceDHWSys:IsStdLargeCHPWH > 0 )) then  1  else  UNDEFINED  endif  }

	"Call subordinate rulelist to setup MFam DHWSYS objects"		Proj:Action		= {	if (IsMultiFamily < 0.5) then  UNCHANGED
																												else if (CSEDHWUseMethod == 1)
																												then	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsUse" )
																												else	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsDayUse" )    endif endif  }

	"Call subordinate rulelist to complete setup of DHW objects"	Proj:Action	= {	EvalRulelist( "CSE_SimulationPrep_DHW_part2" )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_Cleanup_DHW" 1 0 0 1
;*************************************************************************
	"Blast site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (LocalCompAssigned( CSE_FXHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }	; SAC 4/25/16
	"Blast site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (LocalCompAssigned( CSE_WHHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER )  }	; SAC 7/6/15
	"Delete all cseDHWHEATREC components"			Proj:Action = {	DeleteAllComps( cseDHWHEATREC    )  }  ; SAC 1/7/19
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS )  }
	"Delete all cseDHWSOLARCOLLECTOR components" Proj:Action = {	DeleteAllComps( cseDHWSOLARCOLLECTOR )  }    ; SAC 1/15/20
	"Delete all cseDHWSOLARSYS components"			Proj:Action = {	DeleteAllComps( cseDHWSOLARSYS       )  }    ; SAC 1/15/20
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SetDHWUseInclude" 1 0 0 1
	"Set Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { "ShwrFLOWF"		 }
	"Set Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { "ShwrDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { "CwshHOTF"			 }
	"Set Proj:CSE_DefineName[24]"		Proj:CSE_DefineName[24]		= { "CwshUSEF"			 }
	"Set Proj:CSE_DefineName[25]"		Proj:CSE_DefineName[25]		= { "FaucHOTF"			 }
	"Set Proj:CSE_DefineName[26]"		Proj:CSE_DefineName[26]		= { "FaucFlowF"		 }
	"Set Proj:CSE_DefineName[27]"		Proj:CSE_DefineName[27]		= { "BathFLOWF"		 }
	"Set Proj:CSE_DefineName[28]"		Proj:CSE_DefineName[28]		= { "BathDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[29]"		Proj:CSE_DefineName[29]		= { "DwshFLOWF"		 }
	"Set Proj:CSE_DefineName[30]"		Proj:CSE_DefineName[30]		= { UNDEFINED  }				; add next here
	"Set Proj:CSE_DefineName[31]"		Proj:CSE_DefineName[31]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[32]"		Proj:CSE_DefineName[32]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[33]"		Proj:CSE_DefineName[33]		= { UNDEFINED  }

	"Set Proj:CSE_DefineFloat[21]"	Proj:CSE_DefineFloat[21]	= { Proj:ShwrFLOWF		}
	"Set Proj:CSE_DefineFloat[22]"	Proj:CSE_DefineFloat[22]	= { if (IfValidAnd( HaveShwrDrnHtRecov > 0 ) .AND.
	                                                                    IfValidAnd( ShwrDRAINHREFF >= 0 ))
	                                                                then  Proj:ShwrDRAINHREFF
	                                                                else  0  endif	}           ; SAC 2/16/18 (tic #978)  
	"Set Proj:CSE_DefineFloat[23]"	Proj:CSE_DefineFloat[23]	= { Proj:CwshHOTF			}
	"Set Proj:CSE_DefineFloat[24]"	Proj:CSE_DefineFloat[24]	= { Proj:CwshUSEF			}
	"Set Proj:CSE_DefineFloat[25]"	Proj:CSE_DefineFloat[25]	= { Proj:FaucHOTF			}
	"Set Proj:CSE_DefineFloat[26]"	Proj:CSE_DefineFloat[26]	= { Proj:FaucFlowF		}
	"Set Proj:CSE_DefineFloat[27]"	Proj:CSE_DefineFloat[27]	= { Proj:BathFLOWF		}
	"Set Proj:CSE_DefineFloat[28]"	Proj:CSE_DefineFloat[28]	= { Proj:BathDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[29]"	Proj:CSE_DefineFloat[29]	= { Proj:DwshFLOWF		}
	"Set Proj:CSE_DefineFloat[30]"	Proj:CSE_DefineFloat[30]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[31]"	Proj:CSE_DefineFloat[31]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[32]"	Proj:CSE_DefineFloat[32]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[33]"	Proj:CSE_DefineFloat[33]	= { UNDEFINED  }

	"Set Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	1  }
	"Set Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	1  }
	"Set Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	1  }
	"Set Proj:CSE_DefineType[24]"		Proj:CSE_DefineType[24]		= {	1  }
	"Set Proj:CSE_DefineType[25]"		Proj:CSE_DefineType[25]		= {	1  }
	"Set Proj:CSE_DefineType[26]"		Proj:CSE_DefineType[26]		= {	1  }
	"Set Proj:CSE_DefineType[27]"		Proj:CSE_DefineType[27]		= {	1  }
	"Set Proj:CSE_DefineType[28]"		Proj:CSE_DefineType[28]		= {	1  }
	"Set Proj:CSE_DefineType[29]"		Proj:CSE_DefineType[29]		= {	1  }
	"Set Proj:CSE_DefineType[30]"		Proj:CSE_DefineType[30]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[31]"		Proj:CSE_DefineType[31]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[32]"		Proj:CSE_DefineType[32]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[33]"		Proj:CSE_DefineType[33]		= {	UNDEFINED  }
END

RULELIST "CSE_BlastDHWUseInclude" 1 0 0 1
	"Blast Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[24]"		Proj:CSE_DefineName[24]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[25]"		Proj:CSE_DefineName[25]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[26]"		Proj:CSE_DefineName[26]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[27]"		Proj:CSE_DefineName[27]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[28]"		Proj:CSE_DefineName[28]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[29]"		Proj:CSE_DefineName[29]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[30]"		Proj:CSE_DefineName[30]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[31]"		Proj:CSE_DefineName[31]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[32]"		Proj:CSE_DefineName[32]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[33]"		Proj:CSE_DefineName[33]		= { UNDEFINED  }

	"Blast Proj:CSE_DefineFloat[21]"		Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[22]"		Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[23]"		Proj:CSE_DefineFloat[23]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[24]"		Proj:CSE_DefineFloat[24]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[25]"		Proj:CSE_DefineFloat[25]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[26]"		Proj:CSE_DefineFloat[26]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[27]"		Proj:CSE_DefineFloat[27]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[28]"		Proj:CSE_DefineFloat[28]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[29]"		Proj:CSE_DefineFloat[29]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[30]"		Proj:CSE_DefineFloat[30]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[31]"		Proj:CSE_DefineFloat[31]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[32]"		Proj:CSE_DefineFloat[32]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[33]"		Proj:CSE_DefineFloat[33]	= { UNDEFINED  }

	"Blast Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[24]"		Proj:CSE_DefineType[24]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[25]"		Proj:CSE_DefineType[25]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[26]"		Proj:CSE_DefineType[26]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[27]"		Proj:CSE_DefineType[27]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[28]"		Proj:CSE_DefineType[28]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[29]"		Proj:CSE_DefineType[29]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[30]"		Proj:CSE_DefineType[30]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[31]"		Proj:CSE_DefineType[31]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[32]"		Proj:CSE_DefineType[32]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[33]"		Proj:CSE_DefineType[33]		= {	UNDEFINED  }
END
;*************************************************************************


;************************************************************************* ; SAC 07/05/21 (tic #1275)
RULELIST "Setup_CentralHPWH_LargeAutosized" 1 0 1 1
   "Import DHWSys:DHWHeater[1] from library for CHPWH needing sizing"   DHWSys:DHWHeater[1]  =
      {  RuleLibrary( DHWHeater, "t24std-CHPWH", 1 )  }
;   "Set DHWSys:HeaterMult[1] for CHPWH needing sizing"      DHWSys:HeaterMult[1]  = {  1  }

   "Set DHWSys:DHWHeater[1]:CentralHPWHCprsrType"     DHWSys:DHWHeater[1]:CentralHPWHCprsrType  = {  CHPWHCompType  }
   "Set DHWSys:DHWHeater[1]:ASHPType"                 DHWSys:DHWHeater[1]:ASHPType      = {  "generic 26kW"  }
   "Set DHWSys:DHWHeater[1]:IsBuiltUp flag"           DHWSys:DHWHeater[1]:IsBuiltUp     = {  1  } 
   "Set DHWSys:DHWHeater[1]:ASHPAutoSize flag"        DHWSys:DHWHeater[1]:ASHPAutoSize  = {  1  } 

   ; tank size to be autosized
;   "Set DHWSys:DHWHeater[1]:NonStdTankVolume (if specified)"   DHWSys:DHWHeater[1]:NonStdTankVolume  =
;      {  if (IfValidAnd( CHPWHTotTankVol > 0 ) .AND. IfValidAnd( CHPWHNumCompFlt > 0 ))
;         then  CHPWHTotTankVol / CHPWHNumCompFlt
;         else  UNCHANGED  endif  }
;
;   "Set DHWSys:DHWHeater[1]:TankCountSim (tanks per htr/compressor)"    DHWSys:DHWHeater[1]:TankCountSim  = 
;      {  if (CHPWHSysDescrip == 2)
;         then  CHPWHTankCount / CHPWHNumCompFlt
;         else  UNDEFINED  endif  }

   "Set DHWSys:DHWHeater[1]:InsulRValSim"             DHWSys:DHWHeater[1]:InsulRValSim  = 
      {  if (CHPWHSysDescrip == 2)
         then  CHPWHTankRVal
         else  UNDEFINED  endif  }

   "call subordinate rulelist to set remaining DHWHeater properties"    DHWSys:Action =
      {  EvalRulelist( "PostProposedInput_CentralHPWH_LargeAndSmall", 1 )  }

;"dbg - store BEMProc details"  DHWSys:Action = {  StoreBEMProc( Format( "after AutoszdCHPWH setup-%s-%g", Proj:RunAbbrev, ComponentIndex() ), 0 )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsUse" 1 0 0 1
;   Rules to setup DHWSYS objects using old (2013 and earlier) DHW use & gains mechanism
;*************************************************************************
	"Create a CSE DHWSYS for each DwellUnitType-1"		DwellUnitType:cseDHWSYSRefs[1]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 1 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[1] ) < 1) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys1-" + substr( Name, 0, 47 ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys			= {	DHWSysRef[1]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:wsMult"					DwellUnitType:cseDHWSYSRefs[1]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-2"		DwellUnitType:cseDHWSYSRefs[2]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 2 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[2] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys2-" + substr( Name, 0, 47 ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys			= {	DHWSysRef[2]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:wsMult"					DwellUnitType:cseDHWSYSRefs[2]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-3"		DwellUnitType:cseDHWSYSRefs[3]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 3 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[3] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys3-" + substr( Name, 0, 47 ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys			= {	DHWSysRef[3]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:wsMult"					DwellUnitType:cseDHWSYSRefs[3]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-4"		DwellUnitType:cseDHWSYSRefs[4]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 4 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[4] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys4-" + substr( Name, 0, 47 ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys			= {	DHWSysRef[4]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:wsMult"					DwellUnitType:cseDHWSYSRefs[4]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-5"		DwellUnitType:cseDHWSYSRefs[5]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 5 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[5] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys5-" + substr( Name, 0, 47 ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys			= {	DHWSysRef[5]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:wsMult"					DwellUnitType:cseDHWSYSRefs[5]:wsMult					= {	NumAssigningDUs  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsDayUse" 1 0 0 1
;   Rules to setup DHWSYS objects using NEW (2016+) DHW use & gains mechanism
;*************************************************************************
	"Create DwellUnitDHW children for each DwellUnit"	DwellUnit:Action	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. Count < 1 .OR.
																											 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNCHANGED
																										else	CreateChildren( DwellUnitDHW, Count, Name + " DU" )  endif  }
																					;					else	CreateChildren( DwellUnitDHW, Count, Name + " DU", "Setup_DwellUnitDHW", 1 )  endif  }
   "Set Proj:DHWDUShuffleNum[2] (MFam)"      Proj:DHWDUShuffleNum[2] =     ; SAC 02/18/21
      {  if (IfValidAnd( MFamDHWDUShuffleNum >= 1) .AND. 
             EnableResearchMode > 0) then  MFamDHWDUShuffleNum
         else  0  endif  }
	"Setup DwellUnitDHW objects"							DwellUnitDHW:Action	= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }

; SAC 7/26/16 - rules to create and setup "load-sharing" DwellUnitDHW objects in order to enable multiple DHWSys per DwellUnit (tic #711)
	"Create load-sharing DwellUnitDHW-2"		DwellUnitDHW:LoadShareDUDHWRef[1]	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. IfValidAnd( NumBedrooms >= 0 )==0 .OR.
																														 IfValidAnd( DwellUnitTypeRef:NumDHWSysTypes >= 2 )==0 .OR.
																														 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[2] ) < 1) then  UNCHANGED
																													else	CreateComp( DwellUnitDHW, Name + "-2" )  endif  }
	"Set load-sharing DwellUnitDHW-2 Parent"				DwellUnitDHW:LoadShareDUDHWRef[1]:Parent				= {	Parent( Name )  }
	"Set load-sharing DwellUnitDHW-2 DwellUnitTypeRef"	DwellUnitDHW:LoadShareDUDHWRef[1]:DwellUnitTypeRef	= {	DwellUnitTypeRef  }
   "Set load-sharing DwellUnitDHW-2 CompactFactor"    DwellUnitDHW:LoadShareDUDHWRef[1]:CompactFactor    = {
         if (Proj:EnergyCodeYearNum >= 2019 .AND. IfValidAnd( DwellUnitTypeRef:CompactFactor > 0 ) .AND.
             ( IfValidAnd( DwellUnitTypeRef:CDCompatible[2] > 0 ) .OR. (IfValidAnd( DwellUnitTypeRef:CompactDistrib > 0 ) .AND. IfValidAnd( DwellUnitTypeRef:CDSpecFixDists < 1 ) .AND. IfValidAnd( DwellUnitTypeRef:UsrCompactFactor > 0 )) ))
         then  DwellUnitTypeRef:CompactFactor
         else  UNDEFINED  endif  }  ; SAC 1/7/19 - added to model 2019+ compact distribution
   "Set load-sharing DwellUnitDHW-2 DUTypeDHWSysIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDHWSysIndex  = {  2  }   ; SAC 4/1/19

	"Create load-sharing DwellUnitDHW-3"		DwellUnitDHW:LoadShareDUDHWRef[2]	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. IfValidAnd( NumBedrooms >= 0 )==0 .OR.
																														 IfValidAnd( DwellUnitTypeRef:NumDHWSysTypes >= 3 )==0 .OR.
																														 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[3] ) < 1) then  UNCHANGED
																													else	CreateComp( DwellUnitDHW, Name + "-3" )  endif  }
	"Set load-sharing DwellUnitDHW-3 Parent"				DwellUnitDHW:LoadShareDUDHWRef[2]:Parent				= {	Parent( Name )  }
	"Set load-sharing DwellUnitDHW-3 DwellUnitTypeRef"	DwellUnitDHW:LoadShareDUDHWRef[2]:DwellUnitTypeRef	= {	DwellUnitTypeRef  }
   "Set load-sharing DwellUnitDHW-3 CompactFactor"    DwellUnitDHW:LoadShareDUDHWRef[2]:CompactFactor    = {
         if (Proj:EnergyCodeYearNum >= 2019 .AND. IfValidAnd( DwellUnitTypeRef:CompactFactor > 0 ) .AND.
             ( IfValidAnd( DwellUnitTypeRef:CDCompatible[3] > 0 ) .OR. (IfValidAnd( DwellUnitTypeRef:CompactDistrib > 0 ) .AND. IfValidAnd( DwellUnitTypeRef:CDSpecFixDists < 1 ) .AND. IfValidAnd( DwellUnitTypeRef:UsrCompactFactor > 0 )) ))
         then  DwellUnitTypeRef:CompactFactor
         else  UNDEFINED  endif  }  ; SAC 1/7/19 - added to model 2019+ compact distribution
   "Set load-sharing DwellUnitDHW-3 DUTypeDHWSysIndex"  DwellUnitDHW:LoadShareDUDHWRef[2]:DUTypeDHWSysIndex  = {  3  }   ; SAC 4/1/19

	"Create load-sharing DwellUnitDHW-4"		DwellUnitDHW:LoadShareDUDHWRef[3]	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. IfValidAnd( NumBedrooms >= 0 )==0 .OR.
																														 IfValidAnd( DwellUnitTypeRef:NumDHWSysTypes >= 4 )==0 .OR.
																														 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[4] ) < 1) then  UNCHANGED
																													else	CreateComp( DwellUnitDHW, Name + "-4" )  endif  }
	"Set load-sharing DwellUnitDHW-4 Parent"				DwellUnitDHW:LoadShareDUDHWRef[3]:Parent				= {	Parent( Name )  }
	"Set load-sharing DwellUnitDHW-4 DwellUnitTypeRef"	DwellUnitDHW:LoadShareDUDHWRef[3]:DwellUnitTypeRef	= {	DwellUnitTypeRef  }
   "Set load-sharing DwellUnitDHW-4 CompactFactor"    DwellUnitDHW:LoadShareDUDHWRef[3]:CompactFactor    = {
         if (Proj:EnergyCodeYearNum >= 2019 .AND. IfValidAnd( DwellUnitTypeRef:CompactFactor > 0 ) .AND.
             ( IfValidAnd( DwellUnitTypeRef:CDCompatible[4] > 0 ) .OR. (IfValidAnd( DwellUnitTypeRef:CompactDistrib > 0 ) .AND. IfValidAnd( DwellUnitTypeRef:CDSpecFixDists < 1 ) .AND. IfValidAnd( DwellUnitTypeRef:UsrCompactFactor > 0 )) ))
         then  DwellUnitTypeRef:CompactFactor
         else  UNDEFINED  endif  }  ; SAC 1/7/19 - added to model 2019+ compact distribution
   "Set load-sharing DwellUnitDHW-4 DUTypeDHWSysIndex"  DwellUnitDHW:LoadShareDUDHWRef[3]:DUTypeDHWSysIndex  = {  4  }   ; SAC 4/1/19

	"Create load-sharing DwellUnitDHW-5"		DwellUnitDHW:LoadShareDUDHWRef[4]	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. IfValidAnd( NumBedrooms >= 0 )==0 .OR.
																														 IfValidAnd( DwellUnitTypeRef:NumDHWSysTypes >= 5 )==0 .OR.
																														 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[5] ) < 1) then  UNCHANGED
																													else	CreateComp( DwellUnitDHW, Name + "-5" )  endif  }
	"Set load-sharing DwellUnitDHW-5 Parent"				DwellUnitDHW:LoadShareDUDHWRef[4]:Parent				= {	Parent( Name )  }
	"Set load-sharing DwellUnitDHW-5 DwellUnitTypeRef"	DwellUnitDHW:LoadShareDUDHWRef[4]:DwellUnitTypeRef	= {	DwellUnitTypeRef  }
   "Set load-sharing DwellUnitDHW-5 CompactFactor"    DwellUnitDHW:LoadShareDUDHWRef[4]:CompactFactor    = {
         if (Proj:EnergyCodeYearNum >= 2019 .AND. IfValidAnd( DwellUnitTypeRef:CompactFactor > 0 ) .AND.
             ( IfValidAnd( DwellUnitTypeRef:CDCompatible[5] > 0 ) .OR. (IfValidAnd( DwellUnitTypeRef:CompactDistrib > 0 ) .AND. IfValidAnd( DwellUnitTypeRef:CDSpecFixDists < 1 ) .AND. IfValidAnd( DwellUnitTypeRef:UsrCompactFactor > 0 )) ))
         then  DwellUnitTypeRef:CompactFactor
         else  UNDEFINED  endif  }  ; SAC 1/7/19 - added to model 2019+ compact distribution
   "Set load-sharing DwellUnitDHW-5 DUTypeDHWSysIndex"  DwellUnitDHW:LoadShareDUDHWRef[4]:DUTypeDHWSysIndex  = {  5  }   ; SAC 4/1/19
; SAC 7/26/16 - (end of) rules to create and setup "load-sharing" DwellUnitDHW objects in order to enable multiple DHWSys per DwellUnit (tic #711)

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + substr( Name, 0, 47 ) )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType	= {	DwellUnitTypeRef:Name  }
; SAC 5/11/16 - DISALLOW multiple DHWSys objects per DwellUnitType
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	DwellUnitTypeRef:DHWSysRef[1]:Name  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }
	"Set DwellUnitDHW:cseDHWSYSRef:DUTypeDHWSysIndex"		   DwellUnitDHW:cseDHWSYSRef:DUTypeDHWSysIndex		   = {   DUTypeDHWSysIndex  }   ; SAC 1/7/19

	"Set DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS"			DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS			= {	if (IfValidAnd( DwellUnitTypeRef:DHWSysRef[1]:CentralDHW > 0.5 ))
																																					then	DwellUnitTypeRef:DHWSysRef[1]:cseDHWSYSRef
																																					else	UNDEFINED  endif  }

; SAC 7/26/16 - rules to setup "load-sharing" cseDHWSYS objects in order to enable multiple DHWSys per DwellUnit (tic #711)
	"Set DwellUnitDHW:LoadShareDUDHWRef[1]:cseDHWSYSRef:SourceDHWSys"			DwellUnitDHW:LoadShareDUDHWRef[1]:cseDHWSYSRef:SourceDHWSys			= {	DwellUnitTypeRef:DHWSysRef[2]:Name  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[1]:cseDHWSYSRef:wsLoadShareDHWSYS"	DwellUnitDHW:LoadShareDUDHWRef[1]:cseDHWSYSRef:wsLoadShareDHWSYS	= {	cseDHWSYSRef  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[2]:cseDHWSYSRef:SourceDHWSys"			DwellUnitDHW:LoadShareDUDHWRef[2]:cseDHWSYSRef:SourceDHWSys			= {	DwellUnitTypeRef:DHWSysRef[3]:Name  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[2]:cseDHWSYSRef:wsLoadShareDHWSYS"	DwellUnitDHW:LoadShareDUDHWRef[2]:cseDHWSYSRef:wsLoadShareDHWSYS	= {	cseDHWSYSRef  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[3]:cseDHWSYSRef:SourceDHWSys"			DwellUnitDHW:LoadShareDUDHWRef[3]:cseDHWSYSRef:SourceDHWSys			= {	DwellUnitTypeRef:DHWSysRef[4]:Name  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[3]:cseDHWSYSRef:wsLoadShareDHWSYS"	DwellUnitDHW:LoadShareDUDHWRef[3]:cseDHWSYSRef:wsLoadShareDHWSYS	= {	cseDHWSYSRef  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[4]:cseDHWSYSRef:SourceDHWSys"			DwellUnitDHW:LoadShareDUDHWRef[4]:cseDHWSYSRef:SourceDHWSys			= {	DwellUnitTypeRef:DHWSysRef[5]:Name  }
	"Set DwellUnitDHW:LoadShareDUDHWRef[4]:cseDHWSYSRef:wsLoadShareDHWSYS"	DwellUnitDHW:LoadShareDUDHWRef[4]:cseDHWSYSRef:wsLoadShareDHWSYS	= {	cseDHWSYSRef  }

END

;*************************************************************************
RULELIST "Setup_DwellUnitDHW" 1 0 0 0
;   Rules to setup newly created DwellUnitDHW objects
	"Set DwellUnitDHW:DwellUnitTypeRef"		DwellUnitDHW:DwellUnitTypeRef		= {	Parent( DwellUnitTypeRef )  }
	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	if (     IfValidAnd( DwellUnitTypeRef:NumBedrooms > 4.5 )) then  5
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 3.5 )) then  4
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 2.5 )) then  3
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 1.5 )) then  2
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 0.5 )) then  1
																											else	0  endif endif endif endif endif  }
   "Set DwellUnitDHW:NumDHWSchShuffles - # draw sched shuffles by # bedrooms"    DwellUnitDHW:NumDHWSchShuffles =       ; SAC 02/15/21
      {  if (     NumBedrooms >= 4) then  10
         else if (NumBedrooms == 3) then  20
         else                             50   endif endif  }
   ; SAC 11/29/18 - switch from 5 to 10 MFam DHW draw profile shufflings
   ; SAC 2/28/19 - restored use of 5 MFam DHW draw profile shufflings for PRE-2019 analysis
	"Set DwellUnitDHW:DHWProfileLetter"		DwellUnitDHW:DHWProfileLetter		=        ; updated for new DHWDU.txt w/ many more shufflings - SAC 02/15/21
   {  if (Proj:EnergyCodeYearNum >= 2019)
      then  if (                    mod( (CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ) + Proj:DHWDUShuffleNum[2]), NumDHWSchShuffles ) > 0)
            then  Format( "%02.0f", mod( (CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ) + Proj:DHWDUShuffleNum[2]), NumDHWSchShuffles ) )
            else  Format( "%02.0f", NumDHWSchShuffles )  endif
      else  switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 5 ) )
               case  1 :  "a"       case  2 :  "b"       case  3 :  "c"
               case  4 :  "d"       default :  "e"
            endswitch  endif  }
   ; prior >= 2019 logic
   ;   then  switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 10 ) )
   ;            case  1 :  "a"       case  2 :  "b"       case  3 :  "c"
   ;            case  4 :  "d"       case  5 :  "e"       case  6 :  "f"
   ;            case  7 :  "g"       case  8 :  "h"       case  9 :  "i"
   ;            default :  "j"
   ;         endswitch
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR", NumBedrooms )  }								; PRIOR to MFam central DHW fixes ~5/12/16
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; PRIOR to MFam central DHW fixes ~5/12/16
   "Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHWMF%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; revised DHWDU w/ more shufflings - SAC 02/15/21

   "Set DwellUnitDHW:CompactFactor (used to model 2019+ compact distribution)"   DwellUnitDHW:CompactFactor  = {
      if (Proj:EnergyCodeYearNum >= 2019 .AND. IfValidAnd( DwellUnitTypeRef:CompactFactor[1] > 0 ) .AND.
          ( IfValidAnd( DwellUnitTypeRef:CDCompatible[1] > 0 ) .OR. (IfValidAnd( DwellUnitTypeRef:CompactDistrib > 0 ) .AND. IfValidAnd( DwellUnitTypeRef:CDSpecFixDists < 1 ) .AND. IfValidAnd( DwellUnitTypeRef:UsrCompactFactor > 0 )) ))
      then  DwellUnitTypeRef:CompactFactor[1]
      else  UNDEFINED  endif  }  ; SAC 1/7/19 
   "Set DwellUnitDHW:PropCompactFactor (...compact distribution for Proposed model)"      DwellUnitDHW:PropCompactFactor  =      ; SAC 09/02/20 (tic #1187)
      {  if (IfValidAnd( DwellUnitTypeRef:PropCompactFactor > 0 ))
         then  DwellUnitTypeRef:PropCompactFactor
         else  UNDEFINED  endif  }
   "Set DwellUnitDHW:DUTypeDHWSysIndex (1-based index of DwellUnitType's DHWSysRef)"   DwellUnitDHW:DUTypeDHWSysIndex  = {  1  }   ; SAC 4/1/19
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_part2" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Set DHWSys:HWSupplyTemp"			DHWSys:HWSupplyTemp		= {	; based on Res ACM App E, Eqn RE-3 description of HW supply temp, combined w/ ACM system types described above
																				;		if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5)		; SAC 5/20/16 - removed MFam central dependence (per BAW 
																				;		then  130  else
																						if (Proj:CSEDHWUseMethod == 1)
																						then	124  else  115  endif  }		; SAC 4/6/16 - non-MFam/central switched from 124 to 115		; SAC 4/15/16 - restored 124 for old/2013 models (tic #641)

	"Setup cseDHWSYS meters and temperatures"		cseDHWSYS:Action	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																								else	EvalRulelist( "Setup_cseDHWSYS_MetersAndTemperatures", 1 )  endif  }

; THE FOLLOWING RULE SERVES TO RE-DISTRIBUTE ALL PROJECT HW CONSUMPTION EVENLY ACROSS ALL SIMULATED DHWSys OBJECTS
; REMOVE THIS RULE TO SIMULATE HW CONSUMPTION BY DHWSys BASED ON Zone/DwellUnitType SIZES/COUNTS
; SAC 10/24/15 - removed this rule to split DHW load based on dwelling units & area served
; SAC 10/26/15 - following rule WILL NOT WORK AGAIN for MFam, non-central systems, as these systems don't rely on this global parameter
;				"Re-allocate DHWSys:DailyHWConsumption"	DHWSys:DailyHWConsumption	= {	if (SumAll( DHWSys:SimDHWSys ) < 0.5)	then  UNCHANGED
;																													else	Proj:DailyHWConsumption / SumAll( DHWSys:SimDHWSys )  endif  }

	"Set cseDHWSYS:HWUse - HW use"		cseDHWSYS:HWUse		= {	if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																						then	SourceDwellUnitType:DHWDailyConsPerSys
																						else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																						then	SourceDHWSys:DailyHWConsumption
																						else	0  endif endif  }

   "Set cseDHWSYS:wsBranchModel - Model used to simulate DHW branch losses: T24DHW / DayWaste / DrawWaste"       ; SAC 11/6/19   - SAC 3/9/20 - fix bug where wsBranchModel not set unless EnableResearchMode is activated
        cseDHWSYS:wsBranchModel            = {  if (IfValidAnd( SourceDHWSys:BranchLossModel > 0 )==0 .OR. IfValidAnd( SourceDHWSys:MFamDistType > 0 )==0 .OR.
                                                    LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
                                                else  switch (SourceDHWSys:BranchLossModel)
                                                         case  1 :  "DayWaste"
                                                         case  2 :  "DrawWaste"
                                                         default :  "T24DHW"
                                                      endswitch   endif  }

   "Set cseDHWSYS:wsShowerDayWasteF - used to determine ratio of Shower/Faucet water waste"       ; SAC 11/06/19
        cseDHWSYS:wsShowerDayWasteF        = {  if (IfValidAnd( SourceDHWSys:ShwrFaucWasteRat > 0 )==0 .OR. IfValidAnd( SourceDHWSys:MFamDistType > 0 )==0 .OR.
                                                    IfValidAnd( SourceDHWSys:BranchLossModel = 1 )==0 .OR. LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
                                                else            SourceDHWSys:ShwrFaucWasteRat    endif  }
   "Set cseDHWSYS:wsFaucetDayWasteF - used to determine ratio of Shower/Faucet water waste"       ; SAC 11/06/19
        cseDHWSYS:wsFaucetDayWasteF        = {  if (IfValidAnd( wsShowerDayWasteF > 0 )) then  1  else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsDayWasteBranchVolF_x - Number of branch volumes discarded per day (wsBranchModel = DayWaste) (expression)"       ; SAC 11/06/19
        cseDHWSYS:wsDayWasteBranchVolF_x   = {  if (LocalStatus( SourceDHWSys:NumBranchVolsWasted ) < 1 .OR. IfValidAnd( SourceDHWSys:MFamDistType > 0 )==0 .OR.
                                                    IfValidAnd( SourceDHWSys:BranchLossModel = 1 )==0 .OR. LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
                                                else             SourceDHWSys:NumBranchVolsWasted    endif  }
   "Set cseDHWSYS:wsDayWasteBranchVolF_x - #2 (replace '#Flrs' w/ SourceDHWSys:NumFloorsServed)"       ; SAC 11/06/19
        cseDHWSYS:wsDayWasteBranchVolF_x   = {  if (LocalStatus( wsDayWasteBranchVolF_x ) < 1 .OR. IfValidAnd(  SourceDHWSys:NumFloorsServed > 0 )==0) then  UNCHANGED
                                                else   ReplaceInString( "#Flrs", Format( "%g", SourceDHWSys:NumFloorsServed ) )  endif  }

   "Set cseDHWSYS:CSESizingRunRequired"   cseDHWSYS:CSESizingRunRequired =       ; SAC 07/02/21 (tic #1275)
      {  if (IfValidAnd( SourceDHWSys:CHPWHCompAutosizeSim > 0 )) then  1
         else  UNDEFINED  endif  }

   ; REMOVED 1/5/20 mod preventing PreRuns for new Central... (per e-mail from CB 5/6/20) - SAC 5/6/20
   ; SAC 1/5/20 - added logic to prevent PreRuns for new Central HPWH that is not AutoSized (tic #862)  - SAC 3/9/20 - removed dependence on EnableResearchMode
   "Set cseDHWSYS:CSEPreRunRequired"     cseDHWSYS:CSEPreRunRequired  =        ; SAC 11/6/19   ; SAC 12/2/19 - switched logic from negative to positive & added UseMaxDurNumHtrs logic
     ;        (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 )==0 .OR. IfValidAnd( SourceDHWSys:CHPWHAutosize = 0 )==0)) then  1         - SAC 2/4/20 - CHPWHAutosize removed (tic #1197)
      {  if (IfValidAnd( SourceDHWSys:BranchLossModel = 1 ) .AND. IfValidAnd( SourceDHWSys:MFamDistType > 0 ) .AND.
             LocalCompAssigned( wsCentralDHWSYS ) < 1) then  1
         else if (IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND.
                  IfValidAnd( Proj:AnalysisVersion > 190101 )) then  1
         else  UNDEFINED  endif endif  }

	; SAC 3/17/16 - replaced old rule (below) which applied waste factor to HWUSE with this one that passes that factor directly into the DHWSYS via the new wsWF property (for wsDayUse DHW systems)
				"Set cseDHWSYS:wsWF (waste factor)"
						cseDHWSYS:wsWF		= {	if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED			; SAC 4/15/16 - prevent specification for old/2013 models (tic #641)
														else if (IfValidAnd( SourceDHWSys:CSEWaterUseWasteFactor >= 0 ) .AND.
														         LocalCompAssigned( wsCentralDHWSYS ) > 0) then  SourceDHWSys:CSEWaterUseWasteFactor   ; SAC 10/30/19
														else if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
																	LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1) then  UNDEFINED		; SAC 5/12/16 - no wsWF for DayUse central DHWSYSs
														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  1.0
														else	switch ( SourceDHWSys:SystemType )
																	case    4992 :  0.9		; "Recirculation, Non-Demand Control"                          
																	case    5248 :  0.9		; "Recirculation, Demand Control Push Button"                  
																	case    5504 :  0.9		; "Recirculation, Demand Control Occupancy/Motion"             
																	case 8393856 :  0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
																	case 8394112 :  0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
																	default      :  1.0
																endswitch  endif endif endif endif  }

   "Set cseDHWSYS:wsFaucetDrawWaste - Faucet water usage waste factor (applies to both old and new style use/profiles)"       ; SAC 10/31/19
        cseDHWSYS:wsFaucetDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEFaucetDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
                                          then            SourceDHWSys:CSEFaucetDrawWaste    else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsShowerDrawWaste - Shower water usage waste factor (applies to both old and new style use/profiles)"    
        cseDHWSYS:wsShowerDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEShowerDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
                                          then            SourceDHWSys:CSEShowerDrawWaste    else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsBathDrawWaste   - Bath water usage waste factor (applies to both old and new style use/profiles)"    
        cseDHWSYS:wsBathDrawWaste   = {   if (IfValidAnd( SourceDHWSys:CSEBathDrawWaste   >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
                                          then            SourceDHWSys:CSEBathDrawWaste      else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsCWashrDrawWaste - Clothes washer water usage waste factor (applies to both old and new style use/profiles)"    
        cseDHWSYS:wsCWashrDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSECWashrDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
                                          then            SourceDHWSys:CSECWashrDrawWaste    else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsDWashrDrawWaste - Dish washer water usage waste factor (applies to both old and new style use/profiles)"    
        cseDHWSYS:wsDWashrDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEDWashrDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
                                          then            SourceDHWSys:CSEDWashrDrawWaste    else  UNDEFINED  endif  }

	;; SAC 9/1/15 - adjustment added per input from Chip:
	; SAC 8/15/16 - RESTORE adjustment (after being removed 3/17/16) of HW use when simulating DHW use via wsUse (old/2013 method):
	; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	; 		 accounts for reduced waste for single-family recirculating systems                        ;
	; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
				"Adjust cseDHWSYS:HWUse for single family recirculation (when Proj:CSEDHWUseMethod == 'Old (via wsUse)')"
						cseDHWSYS:HWUse	= {	if (Proj:CSEDHWUseMethod != 1) then  UNCHANGED
														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
														else	switch ( SourceDHWSys:SystemType )
																	case    4992 :  HWUse * 0.9		; "Recirculation, Non-Demand Control"                          
																	case    5248 :  HWUse * 0.9		; "Recirculation, Demand Control Push Button"                  
																	case    5504 :  HWUse * 0.9		; "Recirculation, Demand Control Occupancy/Motion"             
																	case 8393856 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
																	case 8394112 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
																	default      :  UNCHANGED
																endswitch  endif endif  }

	; SAC 3/17/16 - added logic for Proj:CSEDHWUseMethod
	"Set cseDHWSYS:wsUse_x"				cseDHWSYS:wsUse_x	= {	if (Proj:CSEDHWUseMethod != 1) then  UNDEFINED
																				else	Format( "%g * select( $isWeekend, HWUSEF_WE, default HWUSEF_WD )", HWUse )  endif  }

   "Set Proj:DHWDUShuffleNum[1] (SFam)"      Proj:DHWDUShuffleNum[1] =     ; SAC 02/18/21
      {  if (IfValidAnd( SFamDHWDUShuffleNum >= 1) .AND. IfValidAnd( SFamDHWDUShuffleNum <= 5) .AND.
             EnableResearchMode > 0) then  SFamDHWDUShuffleNum
         else  1  endif  }
   "Set Proj:DHWDUShuffleNum[2] (MFam)"      Proj:DHWDUShuffleNum[2] =     ; SAC 02/18/21
      {  if (IfValidAnd( MFamDHWDUShuffleNum >= 1) .AND. 
             EnableResearchMode > 0) then  MFamDHWDUShuffleNum
         else  1  endif  }

	; SAC 3/17/16 - new wsDayUse property
	"Set cseDHWSYS:wsDayUse_x"			cseDHWSYS:wsDayUse_x	= {	
         if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED                                                ; Project is 2013 version, uses wsUse_x instead
			else if (LocalCompAssigned( SourceDwellUnitDHW ) > 0) then  SourceDwellUnitDHW:CSEDayUseName  ; Project is MFAM w/ NON-Central DHW System
			else if (Proj:IsMultiFamily < 0.5) then                                                       ; Project is Single Family
               if ( IfValidAnd( SFamMainDayUse < 1 ) .OR.
                    IfValidAnd( SFamADUDayUse  < 1 ) ) then UNDEFINED            ; DHW system is not first system, do not assign wsDayUse_x object
               else if ( IfValidAnd( SFamADUDayUse >= 0 ) )                      ; ADU DayUses
               then  if (     Proj:UseSFamADUNumBedrooms = 0) then  Format( "DHWMF0BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     else if (Proj:UseSFamADUNumBedrooms = 1) then  Format( "DHWMF1BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     else if (Proj:UseSFamADUNumBedrooms = 2) then  Format( "DHWMF2BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     else if (Proj:UseSFamADUNumBedrooms = 3) then  Format( "DHWMF3BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     else if (Proj:UseSFamADUNumBedrooms = 4) then  Format( "DHWMF4BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     else                                           Format( "DHWMF5BR%02.0f", Proj:DHWDUShuffleNum[2] )
                     endif endif endif endif endif
               else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 1.5 ) then  Format( "DHWSF1BR%02.0f", Proj:DHWDUShuffleNum[1] )
					else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 2.5 ) then  Format( "DHWSF2BR%02.0f", Proj:DHWDUShuffleNum[1] )
					else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 3.5 ) then  Format( "DHWSF3BR%02.0f", Proj:DHWDUShuffleNum[1] )
					else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 4.5 ) then  Format( "DHWSF4BR%02.0f", Proj:DHWDUShuffleNum[1] )
					else                                                                       Format( "DHWSF5BR%02.0f", Proj:DHWDUShuffleNum[1] )
					endif endif endif endif endif endif
			else	UNDEFINED  
         endif endif endif  }
      ; PRIOR VERSION of SFam DHWDU.txt dayuse assignments, before revised DHWDU w/ more shufflings... - SAC 02/15/21
      ;         then  if (     Proj:UseSFamADUNumBedrooms = 0) then  "DHW0BRa"
      ;               else if (Proj:UseSFamADUNumBedrooms = 1) then  "DHW1BRa"
      ;               else if (Proj:UseSFamADUNumBedrooms = 2) then  "DHW2BRa"
      ;               else if (Proj:UseSFamADUNumBedrooms = 3) then  "DHW3BRa"
      ;               else if (Proj:UseSFamADUNumBedrooms = 4) then  "DHW4BRa"
      ;               else                                           "DHW5BRa"
      ;               endif endif endif endif endif
      ;         else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 1.5 ) then  "DHW1BR"
		;			else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 2.5 ) then  "DHW2BR"
		;			else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 3.5 ) then  "DHW3BR"
		;			else if ( (Proj:SimNumBedrooms - Proj:UseSFamADUNumBedrooms) < 4.5 ) then  "DHW4BR"
		;			else                                        "DHW5BR"
																		; SAC 5/12/16 - ALL MFam DayUse assignments handled via DwellUnitDHW assignment above
																		;			else if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																		;			then	if (     SourceDwellUnitType:NumBedrooms < 0.5) then "DHW0BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 1.5) then "DHW1BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 2.5) then "DHW2BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 3.5) then "DHW3BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 4.5) then "DHW4BR"
																		;					else                                                 "DHW5BR"
																		;					endif endif endif endif endif
																		;			else	UNDEFINED  endif endif endif  }


	; LDH 7/25/16 - set new wsLoadShareDHWSYS for DHW Load Sharing via CSE
	"Set cseDHWSYS:wsLoadShareDHWSYS"			cseDHWSYS:wsLoadShareDHWSYS	= {
	      if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED                ; Project is 2013 version, not applicable
			else if (LocalCompAssigned( SourceDwellUnitDHW ) > 0) then  UNCHANGED                       ; Project is MFAM w/ NON-Central DHW System - this is set during cseDHWSYS creation
			else if (Proj:IsMultiFamily < 0.5) then                                                     ; Project is Single Family
			      if (IfValidAnd( SFamMainDayUse = 0 ))
			      then  MaxAllComp( cseDHWSYS:SFamMainDayUse )       ; assign first main dwelling cseDHWSYS to share load of
			      else if (IfValidAnd( SFamADUDayUse = 0 ))
			      then  MaxAllComp( cseDHWSYS:SFamADUDayUse )        ; assign first ADU cseDHWSYS to share load of
               else UNDEFINED                                  
				   endif endif
			else	UNDEFINED
         endif endif endif  }

   "Set cseDHWSYS:wsMult (for systems w/ day use shuffle copies)"    cseDHWSYS:wsMult  =        ; SAC 05/14/21
      {  if (IfValidAnd( Proj:ShuffleSFamDHWNum > 1 )) then  1 / Proj:ShuffleSFamDHWNum
         else  UNCHANGED  endif  }

  ; delta-T and other formulas related to calculation of (simulation) energy factor by water heater
	"Set Proj:InletMainsWtrTemp"		Proj:InletMainsWtrTemp	= {	T24RClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:ClimateZone )  }
	"Set DHWSys:HWDeltaTemp"			DHWSys:HWDeltaTemp		= {	if (IfValidAnd( Proj:InletMainsWtrTemp > 0 )==0) then  10		; ERROR
																						else  HWSupplyTemp - Proj:InletMainsWtrTemp  endif  }

	; SAC 10/27/15 - fix problem where DHWSys:NumAssignedDUFracs not taking into account number of assigned DwellUnits of each DwellUnitType
	"Set DwellUnitType:NumDUsSrvdPerDHWSys"	DwellUnitType:NumDUsSrvdPerDHWSys	= {	DHWSysAssignFrac * NumAssigningDUs  }
	"Set DHWSys:NumAssignedDUFracs"		DHWSys:NumAssignedDUFracs	= {	if (Proj:IsMultiFamily < 0.5) then  Proj:NumDwellingUnits
																								else	SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumDUsSrvdPerDHWSys ) 
																								endif  }

   ; SAC 1/2/19 - added to facilitate standard design HPWH sizing (HPWHSIZE)
	"Set DwellUnitType:NumBRsSrvdPerDHWSys"	DwellUnitType:NumBRsSrvdPerDHWSys	= {	NumDUsSrvdPerDHWSys * ValidOr( NumBedrooms, 0 )  }
	"Set DHWSys:NumAssignedBRFracs"		DHWSys:NumAssignedBRFracs	= {	if (Proj:IsMultiFamily < 0.5)
	                                                                     then  if (Proj:RunScope = 1 .AND. Proj:IsAddAlone > 0.5)
	                                                                           then  Proj:NumBedrooms + Proj:NumAddBedrooms
	                                                                           else  Proj:NumBedrooms
	                                                                           endif
																								else	SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumBRsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumBRsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumBRsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumBRsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumBRsSrvdPerDHWSys ) 
																								endif  }

; REVISE THIS RULE TO REFERENCE SERVED CFA, # HEATERS & # DWELLING UNITS FOR MORE SYSTEM-SPECIFIC CFAk VALUE
   ; SAC 10/12/15 - revised rule to remove dependence on # DHW heaters and add dependence on # systems (serving same area)
   "Set cseDHWSYS:CFAk - defined in Res ACM, equation RE-5, used to calc SDLMk (std distrib loss mult)"
                                                cseDHWSYS:CFAk     = {  if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
                                                                        then  SourceDwellUnitType:CondFlrArea
                                                                        else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
                                                                        then  if (IfValidAnd( SourceDHWSys:NumAssignedDUFracs > 0 ))
                                                                              then  SourceDHWSys:FloorAreaServed[1] / SourceDHWSys:NumAssignedDUFracs
                                                  ; SAC 7/27/16 - replaced above w/ below to ensure consistent wsSDLM for DHYSYS objects where multiple systems serve SFam home (tic #711)
                                                  ; SAC 8/19/16 - removed mod described above which was causing mult systems in single DU to have same SDLMs (tic #739)
                                                  ;                            then  SumAll( Zone:DHWFloorArea )
                                                                              else  0  endif
                                                                        else  0  endif endif  }      ; error if = 0
                                                                  ; was (prior to 10/26/15):
                                                                  ;                  else if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5 .AND. Proj:NumDwellingUnits > 0)
                                                                  ;                  then   SumAll( DHWSys:FloorAreaServed[1] ) / Proj:NumDwellingUnits
                                                                  ;            ;      else if (SumAcrossIf( DHWSys:NumDHWHeaters, DHWSys:SimDHWSys > 0.5 ) > 0.5)
                                                                  ;            ;      then   SumAll( DHWSys:FloorAreaServed[1] ) / SumAcrossIf( DHWSys:NumDHWHeaters, DHWSys:SimDHWSys > 0.5 )
                                                                  ;                  else if (IfValidAnd( DHWSys:FloorAreaServed[1] > 0.5 ) .AND. SumAll( DHWSys:SimDHWSys ) > 0.5)
                                                                  ;                  then   SumAll( DHWSys:FloorAreaServed[1] ) / SumAll( DHWSys:SimDHWSys )
                                                                  ;                  else   0  endif endif  }      ; error if = 0

	; SAC 10/12/15 - added 'min( ..., 2500 )' to forumla (based on e-mail from BAW)
	"Set cseDHWSYS:wsSDLM - Standard distribution loss multiplier (refer to Res ACM App E, eqn RE-5)"
										cseDHWSYS:wsSDLM		= {	if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
																				 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1) then  UNDEFINED		; SAC 5/12/16 - no wsSDLM for central DHWSYSs
																			else	1.0032 + (0.0001864 * min( CFAk, 2500 )) -
																							   (0.0000000215 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
                                          ; SAC 6/30/17 - following formula replaced with above, proposed for 2017 (tic #737 - consistent w/ DEG_2017_PipeInsulationUpdateMemo_082616 document)
														;					else	1.004 + (0.000202 * min( CFAk, 2500 )) -
														;									  (0.0000000231 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
;										DHWSys:cseDHWSYSRef:wsSDLM		= {	1.1829  }  ; DEBUGGING  1.004 + (0.000202 * cseDHWSYSRef:CFAk) - (0.0000000231 * cseDHWSYSRef:CFAk * cseDHWSYSRef:CFAk)  }
                                                            
	"Set cseDHWSYS:HrlyStdEndUse"		cseDHWSYS:HrlyStdEndUse		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																							then	8.345 * HWUse * SourceDHWSys:HWDeltaTemp / 24
																							else	0  endif  }

   ; SAC 10/18/17 - force override of DHWSys:DistribSysMult with SystemType-based specification only if not 2019 code analysis
   "Force default of DHWSys:DistribSysMult for code vintages < 2019"    DHWSys:Action  = {
         if (LocalStatus( DistribSysMult ) < 7 .OR. Proj:EnergyCodeYearNum >= 2019) then  UNCHANGED
         else  EvalRulelist( "ForceDefault_DHWSys_DistribSysMult", 1 )  endif  }

   ; SAC 12/5/18 - apply new DHWSys:CompactFactor for 2019 Compact Distribution credit (tic #975)
   ; SAC 1/7/19 - added logic to reference SourceDwellUnitDHW:CompactFactor for MFam models (tic #975)
   ; added logic to use proposed model CompactFactor when simulating Std or DRtg models for Alt or Existing DHWSystems - SAC 09/02/20 (tic #1187)
            ;"dbg" cseDHWSYS:Action = { PostMessageToLog( "cseDHWSYS '%s' RunAbbrev '%s' SourceDHWSys:CmpctDistAllowed=%g  SourceDHWSys:CDModelCredit=%g  Proj:SFamCompactFactor=%g", Name, Proj:RunAbbrev, ValidOr( SourceDHWSys:CmpctDistAllowed, 0 ), ValidOr( SourceDHWSys:CDModelCredit, 0 ), ValidOr( Proj:SFamCompactFactor, 1 ) )  }
	"Set cseDHWSYS:wsDSM - Distribution system multiplier (ACM App R, Table B-2)"
		cseDHWSYS:wsDSM	= {
         if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
             LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1)
         then  UNDEFINED		; SAC 5/12/16 - no wsDSM for central DHWSYSs
         else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
         then  if (Proj:IsMultiFamily > 0.5)
               then  if ( (Proj:RunAbbrev == "s" .OR. Proj:RunAbbrev == "smf" .OR. Proj:RunAbbrev == "dr") .AND.
                          IfValidAnd( SourceDHWSys:Status != 3 ) )
                     then  if (IfValidAnd( SourceDwellUnitDHW:PropCompactFactor < 1.0 ))
                           then  SourceDHWSys:DistribSysMult * SourceDwellUnitDHW:PropCompactFactor
                           else  SourceDHWSys:DistribSysMult
                           endif
                     else if (IfValidAnd( SourceDwellUnitDHW:CompactFactor < 1.0 ))
                     then  SourceDHWSys:DistribSysMult * SourceDwellUnitDHW:CompactFactor
                     else  SourceDHWSys:DistribSysMult
                     endif endif
               else  ; SFam
                     if ( (Proj:RunAbbrev == "s" .OR. Proj:RunAbbrev == "smf" .OR. Proj:RunAbbrev == "dr") .AND.
                          IfValidAnd( SourceDHWSys:Status != 3 ) )
                     then  if (IfValidAnd( Proj:PropSFamCompactFactor < 1.0 ))
                           then  SourceDHWSys:DistribSysMult * Proj:PropSFamCompactFactor
                           else  SourceDHWSys:DistribSysMult
                           endif
                     else if (IfValidAnd( SourceDHWSys:CmpctDistAllowed > 0 ) .AND.
                              IfValidAnd( SourceDHWSys:CDModelCredit > 0 ) .AND. IfValidAnd( Proj:SFamCompactFactor < 1.0 ))
                     then  SourceDHWSys:DistribSysMult * Proj:SFamCompactFactor
                     else  SourceDHWSys:DistribSysMult
                     endif endif
               endif
         else  1.0  endif endif  }

;	"Set cseDHWSYS:DistribLossMult"		cseDHWSYS:DistribLossMult		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND. LocalStatus( wsSDLM ) > 0)
;																									then	1 + ((wsSDLM - 1) * SourceDHWSys:DistribSysMult)
;																									else	1.0  endif  }

// TO DO - account for Monthly solar fractions ??
// TO DO - add in HRDLk (hourly recirculation distribution loss (btu))
;	"Set cseDHWSYS:HrlyAdjRecovLoad"		cseDHWSYS:HrlyAdjRecovLoad		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
;																									then	if (IfValidAnd( SourceDHWSys:SolFracType > 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracAnnRpt > 0)==0)
;																											then	(HrlyStdEndUse * DistribLossMult) 
;																											else	(HrlyStdEndUse * DistribLossMult) -
;																													(HrlyStdEndUse * SourceDHWSys:SolFracAnnRpt) 
;																											endif
;																									else	0  endif  }		; 0 => error

	; electrical parasitic power representing recirculation pump energy use - only when DHWCalcMethod = "CSE"
	; SAC 10/29/15 - revised logic to INSTALL wsParElec in T24-match mode (was previsouly turned OFF) - but do so w/ a 0.1 multiplier, since T24DHW DLL seems to calculate pump elec @ only 10% of what it should be
   ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
	"Set cseDHWSYS:wsParElec"		cseDHWSYS:wsParElec		= {	if (Proj:IsMultiFamily > 0.5 .OR. IfValidAnd( SourceDHWSys:SystemType = 4992 )==0) then  UNDEFINED
																					else 	40			; 40 Watts continual use for SFam where SystemType = "Recirculation, Non-Demand Control"
																					endif  }
	; SAC 3/21/19 - revised logic to cause output of wsParElec_x for non-central MFam systems
	;"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	if (Proj:IsMultiFamily > 0.5 .OR.
	"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	if ( (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 )) .OR.
																							(IfValidAnd( SourceDHWSys:SystemType = 5248 )==0 .AND. IfValidAnd( SourceDHWSys:SystemType = 8393856 )==0 .AND.
																							 IfValidAnd( SourceDHWSys:SystemType = 5504 )==0 .AND. IfValidAnd( SourceDHWSys:SystemType = 8394112 )==0)) then  UNDEFINED
																else	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
																endif  }		; scheduled use for SFam where SystemType = any demand-controlled recirculation
                                 ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
											;					else if (Proj:DHWCalcMethod == 1)		; straight CSE
											;					then	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
											;					else	; 10% of each schedule value above when in T24-match mode, since we believe T24 DLL electric pump results are only 10% of what they should be
											;							"hourval( 0.1, 0.05, 0.06, 0.06, 0.12, 0.24, 0.45, 0.57, 0.54, 0.45, 0.37, 0.28, 0.25, 0.23, 0.21, 0.19, 0.28, 0.32, 0.33, 0.31, 0.27, 0.25, 0.23, 0.15 )"
											;					endif endif  }		; scheduled use for SFam where SystemType = any demand-controlled recirculation

;   "wsFaucetCount",  "Total number of faucets served by this DHWSYS"  ; SAC 4/1/19   - faucets always evenly split across all DHWSys objects
   "Set cseDHWSYS:wsShowerCount"    cseDHWSYS:wsShowerCount  = {
         if (Proj:EnergyCodeYearNum < 2019) then  UNDEFINED
         else if (Proj:IsMultiFamily < 0.5)
         then  if (IfValidAnd( SourceDHWSys:TotShowersServed >= 0 ))
               then  SourceDHWSys:TotShowersServed
               else  UNDEFINED  endif
         else  switch (DUTypeDHWSysIndex)
                  case  1 :   if (IfValidAnd( SourceDwellUnitType:TotShowersServed[1] >= 0 ))
                              then  SourceDwellUnitType:TotShowersServed[1]
                              else  UNDEFINED  endif
                  case  2 :   if (IfValidAnd( SourceDwellUnitType:TotShowersServed[2] >= 0 ))
                              then  SourceDwellUnitType:TotShowersServed[2]
                              else  UNDEFINED  endif
                  case  3 :   if (IfValidAnd( SourceDwellUnitType:TotShowersServed[3] >= 0 ))
                              then  SourceDwellUnitType:TotShowersServed[3]
                              else  UNDEFINED  endif
                  case  4 :   if (IfValidAnd( SourceDwellUnitType:TotShowersServed[4] >= 0 ))
                              then  SourceDwellUnitType:TotShowersServed[4]
                              else  UNDEFINED  endif
                  case  5 :   if (IfValidAnd( SourceDwellUnitType:TotShowersServed[5] >= 0 ))
                              then  SourceDwellUnitType:TotShowersServed[5]
                              else  UNDEFINED  endif
                  default :   UNDEFINED
               endswitch
         endif endif  }
   "Set cseDHWSYS:wsBathCount"    cseDHWSYS:wsBathCount  = {
         if (Proj:EnergyCodeYearNum < 2019) then  UNDEFINED
         else if (Proj:IsMultiFamily < 0.5)
         then  if (IfValidAnd( SourceDHWSys:TotBathsServed >= 0 ))
               then  SourceDHWSys:TotBathsServed
               else  UNDEFINED  endif
         else  switch (DUTypeDHWSysIndex)
                  case  1 :   if (IfValidAnd( SourceDwellUnitType:TotBathsServed[1] >= 0 ))
                              then  SourceDwellUnitType:TotBathsServed[1]
                              else  UNDEFINED  endif
                  case  2 :   if (IfValidAnd( SourceDwellUnitType:TotBathsServed[2] >= 0 ))
                              then  SourceDwellUnitType:TotBathsServed[2]
                              else  UNDEFINED  endif
                  case  3 :   if (IfValidAnd( SourceDwellUnitType:TotBathsServed[3] >= 0 ))
                              then  SourceDwellUnitType:TotBathsServed[3]
                              else  UNDEFINED  endif
                  case  4 :   if (IfValidAnd( SourceDwellUnitType:TotBathsServed[4] >= 0 ))
                              then  SourceDwellUnitType:TotBathsServed[4]
                              else  UNDEFINED  endif
                  case  5 :   if (IfValidAnd( SourceDwellUnitType:TotBathsServed[5] >= 0 ))
                              then  SourceDwellUnitType:TotBathsServed[5]
                              else  UNDEFINED  endif
                  default :   UNDEFINED
               endswitch
         endif endif  }
; TO DO
;           "wsCWashrCount",  "Total number of clothes washers served by this DHWSYS"  ; SAC 4/1/19
;           "wsDWashrCount",  "Total number of dish washers served by this DHWSYS"  ; SAC 4/1/19

   ; SAC 1/7/19 - separate SFam vs. MFam cseDHWHEATREC creation & setup
   "Setup cseDHWHEATRECs for cseDHWSYS"   cseDHWSYS:Action  = {
         if (Proj:IsMultiFamily < 0.5)
         then  if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR.
                   IfValidAnd( SourceDHWSys:NumDWHRSysDevices > 0 )==0) then  UNCHANGED
               else  EvalRulelist( "Setup_cseDHWHEATREC_SFam", 1 )
               endif
         else  if (IfValidAnd( DUTypeDHWSysIndex > 0 )==0) then  UNCHANGED
               else  EvalRulelist( "Setup_cseDHWHEATREC_MFam", 1 )
               endif
         endif  }

   "Setup remaining cseDHWHEATREC properties"      Proj:Action  = {
         if (SumAll( cseDHWSYS:wsShowerCount ) > 0)
         then  EvalRulelist( "Setup_cseDHWHEATREC" )
         else  UNCHANGED  endif  }
	; end of - cseDHWHEATREC setup

   ; SAC 10/24/19 - added writing of new DHWLOOPHEATER for 'new' CSE central electric system model
   ; SAC 10/28/19 - moved DHWLOOPHEATER creation & population here, ABOVE DHWHEATER, to ensure proper placement (above loops) in CSE input
   ; SAC 5/27/20 - added logic to create & populate loop heater via latest SourceDHWSys inputs
	"Create Child cseDHWLOOPHEATER"		cseDHWSYS:ChildcseDHWLOOPHEATER	=
      {  if ( IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 )==0 .OR.
              LocalCompAssigned( wsCentralDHWSYS ) > 0 ) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 ) .AND. IfValidAnd( SourceDHWSys:CHPWHSysDescrip > 0 ) .AND.
                  IfValidAnd( SourceDHWSys:CHPWHLoopTankType > 0 ) .AND. IfValidAnd( SourceDHWSys:ValidAnalysisCHPWH > 0 ))
         then  CreateComp( cseDHWLOOPHEATER, "dhwlphtr-" + substr( SourceDHWSys:Name, 0, 44 ) )
         else if (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 )==0 .AND. LocalCompAssigned( SourceDHWSys:LoopHeater ) > 0)
         then  CreateComp( cseDHWLOOPHEATER, "dhwlphtr-" + substr( SourceDHWSys:LoopHeater:Name, 0, 44 ) )
         else  UNCHANGED  endif endif endif  }

   "Set cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys"     cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys =      ; SAC 5/27/20
      {  if (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 ) .AND. IfValidAnd( SourceDHWSys:CHPWHSysDescrip > 0 ) .AND.
             IfValidAnd( SourceDHWSys:CHPWHLoopTankType > 0 ) .AND. IfValidAnd( SourceDHWSys:ValidAnalysisCHPWH > 0 ))
         then  SourceDHWSys  else  UNDEFINED  endif  }

;	"Set cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWHeater"
;				cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:LoopHeater ) == ComponentType( "DHWHeater" ))
;																							then	SourceDHWSys:LoopHeater  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankHeater"
				cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankHeater		=
      {  if (LocalCompAssigned( ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys ) > 0) then  UNDEFINED
         else if (LocalCompAssigned( SourceDHWSys:LoopHeater ) == ComponentType( "DHWLoopTankHeater" ))
         then	SourceDHWSys:LoopHeater  else  UNDEFINED  endif endif  }
	"Set cseDHWSYS:ChildcseDHWLOOPHEATER:whMult"		cseDHWSYS:ChildcseDHWLOOPHEATER:whMult		=
      {  if (IfValidAnd( ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys:CHPWHLoopTankCompCnt > 0 )) then  ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys:CHPWHLoopTankCompCnt
         else  SourceDHWSys:LoopHeaterMult  endif  }
	"Call subordinate rulelist to setup remaining cseDHWLOOPHEATER properties"
;				cseDHWLOOPHEATER:Action	= {	if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
				cseDHWLOOPHEATER:Action	= {	if (LocalCompAssigned( SourceDHWLoopTankSys ) > 0.5)
				                              then  EvalRulelist( "CSE_SimulationPrep_DHWLoopHtr_DHWSys",  1 )
				                              else if (LocalCompAssigned( SourceDHWLoopTankHeater ) > 0.5)
													   then  EvalRulelist( "CSE_SimulationPrep_DHWLoopHtr_DHWHtr",  1 )
													   else  UNCHANGED  endif endif  }

	; cseDHWHEATER & cseDHWTANK setup
	      ; SAC 10/2/19 - revs for MFamProto
	"Create Child cseDHWHEATER - 1"		cseDHWSYS:ChildcseDHWHEATERs[1]	= {	if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                                LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) < 1 .OR.
																											  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr1-" + substr( SourceDHWSys:DHWHeater[1]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[1]:whMult		= {	SourceDHWSys:HeaterMultFlt[1]  }

; SAC 9/11/15 - revised logic to create cseDHWTANK objects for heaters of all types except large & small storage (as long as tank vol > 0)
   ; SAC 5/10/17 - added logic to prevent DHWTANK modeling of small instantaneous water heaters (since minimal tank integrated into EF) (tic #838)
   ; LH 170717 - added logic to prevent DHWTank modeling for all 2017 UEF rated equipment
	"Create Child cseDHWTANK - 1"			cseDHWSYS:ChildcseDHWTANKs[1]		= {
         if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	             IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	           LocalCompAssigned( SourceDHWSys:DHWHeater[1] )==0 .OR.
         	  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if ( LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 15 ) .OR.
         			     ( IfValidAnd( SourceDHWSys:DHWHeater[1]:TankVolume > 0.001 )==0 .AND. 
                     IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 1 )==0)) 
            then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk1-" + substr( SourceDHWSys:DHWHeater[1]:Name, 0, 44 ) )   
            endif
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 3 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 5 ) .OR.
         			     ( IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankVolume > 0.001 )==0 .AND. 
                     IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 1 )==0)) 
            then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk1-" + substr( SourceDHWSys:DHWHeater[1]:Name, 0, 44 ) )   
            endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[1]:wtMult		= {	SourceDHWSys:HeaterMultFlt[1]  }

	"Create Child cseDHWHEATER - 2"		cseDHWSYS:ChildcseDHWHEATERs[2]	= {	if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                               LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr2-" + substr( SourceDHWSys:DHWHeater[2]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[2]:whMult		= {	SourceDHWSys:HeaterMultFlt[2]  }

	"Create Child cseDHWTANK - 2"			cseDHWSYS:ChildcseDHWTANKs[2]		= {
         if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	             IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	           LocalCompAssigned( SourceDHWSys:DHWHeater[2] )==0 .OR.
         	  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if ( LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ) )
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 15 ) .OR.
         			    ( IfValidAnd( SourceDHWSys:DHWHeater[2]:TankVolume > 0.001 )==0 .AND. 
                    IfValidAnd( SourceDHWSys:DHWHeater[2]:HeaterType = 1 )==0)) 
           then  UNCHANGED
         	 else	CreateComp( cseDHWTANK, "dhwtnk2-" + substr( SourceDHWSys:DHWHeater[2]:Name, 0, 44 ) )   endif
         else if ( LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ) )
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 5 ) .OR.
         			    ( IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankVolume > 0.001 )==0 .AND. 
                    IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 1 )==0)) 
           then  UNCHANGED
         	 else	CreateComp( cseDHWTANK, "dhwtnk2-" + substr( SourceDHWSys:DHWHeater[2]:Name, 0, 44 ) )   endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[2]:wtMult		= {	SourceDHWSys:HeaterMultFlt[2]  }

	"Create Child cseDHWHEATER - 3"		cseDHWSYS:ChildcseDHWHEATERs[3]	= {	if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                                LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) < 1 .OR.
																											  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr3-" + substr( SourceDHWSys:DHWHeater[3]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[3]:whMult		= {	SourceDHWSys:HeaterMultFlt[3]  }

	"Create Child cseDHWTANK - 3"			cseDHWSYS:ChildcseDHWTANKs[3]		= {
         if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	            IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	          LocalCompAssigned( SourceDHWSys:DHWHeater[3] )==0 .OR.
         	 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 15 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[3]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:HeaterType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk3-" + substr( SourceDHWSys:DHWHeater[3]:Name, 0, 44 ) )   endif
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
         then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 5 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk3-" + substr( SourceDHWSys:DHWHeater[3]:Name, 0, 44 ) )   endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[3]:wtMult		= {	SourceDHWSys:HeaterMultFlt[3]  }

	"Create Child cseDHWHEATER - 4"		cseDHWSYS:ChildcseDHWHEATERs[4]	= {	if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                                LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) < 1 .OR.
																											  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr4-" + substr( SourceDHWSys:DHWHeater[4]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[4]:whMult		= {	SourceDHWSys:HeaterMultFlt[4]  }

	"Create Child cseDHWTANK - 4"			cseDHWSYS:ChildcseDHWTANKs[4]		= {
         if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	            IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	          LocalCompAssigned( SourceDHWSys:DHWHeater[4] )==0 .OR.
         	 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 15 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[4]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:HeaterType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk4-" + substr( SourceDHWSys:DHWHeater[4]:Name, 0, 44 ) )   endif
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
         then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 5 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk4-" + substr( SourceDHWSys:DHWHeater[4]:Name, 0, 44 ) )   endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[4]:wtMult		= {	SourceDHWSys:HeaterMultFlt[4]  }

	"Create Child cseDHWHEATER - 5"		cseDHWSYS:ChildcseDHWHEATERs[5]	= {	if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                                LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) < 1 .OR.
																											  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr5-" + substr( SourceDHWSys:DHWHeater[5]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[5]:whMult		= {	SourceDHWSys:HeaterMultFlt[5]  }

	"Create Child cseDHWTANK - 5"			cseDHWSYS:ChildcseDHWTANKs[5]		= {
         if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	            IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	          LocalCompAssigned( SourceDHWSys:DHWHeater[5] )==0 .OR.
         	 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 15 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[5]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:HeaterType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk5-" + substr( SourceDHWSys:DHWHeater[5]:Name, 0, 44 ) )   endif
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
         then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 5 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk5-" + substr( SourceDHWSys:DHWHeater[5]:Name, 0, 44 ) )   endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[5]:wtMult		= {	SourceDHWSys:HeaterMultFlt[5]  }

	"Create Child cseDHWHEATER - 6"		cseDHWSYS:ChildcseDHWHEATERs[6]	= {	if ( ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                                  IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                                LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) < 1 .OR.
																											  LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr6-" + substr( SourceDHWSys:DHWHeater[6]:Name, 0, 44 ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[6]:whMult		= {	SourceDHWSys:HeaterMultFlt[6]  }

	"Create Child cseDHWTANK - 6"			cseDHWSYS:ChildcseDHWTANKs[6]		= {
         if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	            IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	          LocalCompAssigned( SourceDHWSys:DHWHeater[6] )==0 .OR.
         	 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 3 ) .OR. 
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 5 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 10 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 12 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 13 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 14 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 15 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[6]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:HeaterType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk6-" + substr( SourceDHWSys:DHWHeater[6]:Name, 0, 44 ) )   endif
         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
         then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 6 ) .OR.
                   IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 5 ) .OR.
         			(IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 1 )==0)) then  UNCHANGED
         		else	CreateComp( cseDHWTANK, "dhwtnk6-" + substr( SourceDHWSys:DHWHeater[6]:Name, 0, 44 ) )   endif
         else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[6]:wtMult		= {	SourceDHWSys:HeaterMultFlt[6]  }

	; SAC 10/21/15 - added DHWLOOP creation
	; SAC 11/10/15 - added check to ensure no loops for MFamDistType = No Loops/Pumps - was causing HUGE elec use in this scenario
	; SAC 8/3/16 - removed check for SourceDHWSys:MFamDistType > 0.5 in order to create a DHWLoop for central systems where MFamDistType = "Multi-family: No loops or recirc pump"
	"Create Child cseDHWLOOP"		cseDHWSYS:ChildcseDHWLOOP	= {	if (( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .AND.
	                                                                     IfValidAnd( SourceOtherZone:WasherDwellUnits > 0.5 )==0 ) .OR.
	                                                                   IfValidAnd( SourceDHWSys:CentralDHW > 0.5 )==0 .OR.
																							 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																						else	CreateComp( cseDHWLOOP, "dhwlp-" + substr( SourceDHWSys:Name, 0, 44 ) )   endif  }

	"Set cseDHWSYS:NumWaterHeaters"		cseDHWSYS:NumWaterHeaters	= {	SumChildren( cseDHWHEATER:whMult )  }		; SAC 7/18/15
;	"Set cseDHWHEATER:HrlyAdjRecovLoad - hourly adjusted recovery load (HARLj in ACM DHW docu)"		; SAC 7/17/15   
;					cseDHWHEATER:HrlyAdjRecovLoad	= {	if (cseDHWSYS:NumWaterHeaters < 1) then  0
;																	else	cseDHWSYS:HrlyAdjRecovLoad / cseDHWSYS:NumWaterHeaters  endif  }

  ; SAC 12/31/15 - revised logic of following rules to accommodate special handling of DHW heater & tank used to model HVACSys-based air-to-water heat pump DHW heating (tic 560)
  ; SAC 1/13/16 - similar revision as above comment for DHWHeater-source DHW when HeaterElementType = "Heat Pump" and IsHydronic flag set (should only happen in MFam) (tic 560)
	"Call subordinate rulelist to setup remaining cseDHWHEATER properties"
				cseDHWHEATER:Action	= {	if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
													then  if (IfValidAnd( SourceDHWHeater:HeaterElementType == 3 ) .AND. IfValidAnd( SourceDHWHeater:IsHydronic > 0.5 ))
															then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP",  1 )
															else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_DHWHtr",  1 )
															endif
													else if (LocalCompAssigned( SourceHVACSys   ) > 0.5)
													then	if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 11 ))
															then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP_OLD", 1 )
                                             else if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 34 ))
															then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP", 1 )
															else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_HVACSys", 1 )  endif endif
													else  UNCHANGED  endif endif  }

	"Set cseDHWSYS:wsLoadMaxDur - # of hours for tracking the maximum load (default = 12)"    cseDHWSYS:wsLoadMaxDur =   ; SAC 12/2/19
	   {  if (LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. IfValidAnd( Proj:AnalysisVersion > 190101 ) .AND.
	          IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. IfValidAnd( SourceDHWSys:LoadMaxNumHrs > 0 ) .AND.
	          LocalStatus( SourceDHWSys:LoadMaxNumHrs ) > 5)
	      then  SourceDHWSys:LoadMaxNumHrs  else  UNDEFINED  endif  }
	"Set cseDHWSYS:wsDrawMaxDur - # of hours for tracking the maximum draw (default = 4)"     cseDHWSYS:wsDrawMaxDur =
	   {  if (LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. IfValidAnd( Proj:AnalysisVersion > 190101 ) .AND.
	          IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. IfValidAnd( SourceDHWSys:DrawMaxNumHrs > 0 ) .AND.
	          LocalStatus( SourceDHWSys:DrawMaxNumHrs ) > 5)
	      then  SourceDHWSys:DrawMaxNumHrs  else  UNDEFINED  endif  }

	"Set cseDHWHEATER:CSESizingRunRequired"   cseDHWHEATER:CSESizingRunRequired =    ; SAC 07/07/21 (tic #1275)
      {  if (IfValidAnd( SourceDHWHeater:ASHPAutoSize > 0 ))
         then  1
         else  UNDEFINED  endif  }

  ; SAC 3/22/16 - set new property indicating whether or not a CSE pre-run is required for each cseDHWHEATER
  ;						based on e-mail from CSB: "PreRun is needed ONLY for SmallStorage, non-ASHPX.  (Supposedly) harmless for all other types"
  ; SAC 8/13/19 - added logic to prevent use of PreRun for ResistanceX heaters (per call w/ BW during testing of new CSE tank model)
  ; SAC 10/18/19 - added logic to ensure the modeling in 2019.1.1 release is same as for 19.1.0
	"Set cseDHWHEATER:CSEPreRunRequired"	cseDHWHEATER:CSEPreRunRequired	=
	   {  if (IfValidAnd( whType == 1 ) .AND. IfValidAnd( whHeatSrc != 4 ))
	      then  if (IfValidAnd( Proj:AnalysisVersion <= 190101 )) then  1
	            else if (IfValidAnd( whHeatSrc != 5 )) then  1
	            else  0  endif endif
	      else  0  endif  }
  ; SAC 3/22/16 - set cseDHWSYS:wsCalcMode based on whether or not any child heaters require pre-run
	"Set cseDHWSYS:wsCalcMode based on child cseDHWHEATER objects"		cseDHWSYS:wsCalcMode	=        ; SAC 11/6/19 - revised for cseDHWSYS::CSEPreRunRequired
      {  if (IfValidAnd( CSEPreRunRequired > 0 )) then  "PreRun"
         else if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
         else if (SumChildren( cseDHWHEATER:CSEPreRunRequired ) > 0.5 .OR.
                  SumChildren( cseDHWLOOPHEATER:CSEPreRunRequired ) > 0.5 .OR.
                  IfValidAnd( CSESizingRunRequired > 0.5 ))
         then  "PreRun"  else  "Simulate"  endif endif endif  }

   "Set Proj:CSE_DHWSizingRunReqd"     Proj:CSE_DHWSizingRunReqd  =        ; SAC 07/01/21
      {  if (SumAll( cseDHWSYS:CSESizingRunRequired ) > 0.5) then  1  else  0  endif  }

   "Set Proj:CSE_DHWPreRunReqd"     Proj:CSE_DHWPreRunReqd  =        ; SAC 11/6/19 - added logic to include checks for cseDHWSYS: & cseDHWLOOPHEATER: CSEPreRunRequired
      {  if (SumAll( cseDHWHEATER:CSEPreRunRequired ) > 0.5 .OR.
             SumAll( cseDHWLOOPHEATER:CSEPreRunRequired ) > 0.5 .OR.
             SumAll( cseDHWSYS:CSEPreRunRequired ) > 0.5) then  1  else  0  endif  }		; SAC 3/22/16

	"Call subordinate rulelist to setup remaining cseDHWTANK properties"
				cseDHWTANK:Action		= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_DHWHtr",  1 )
													else if (LocalCompAssigned( SourceHVACSys   ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_HVACSys", 1 )
												   else  UNCHANGED  endif endif  }

	"Call subordinate rulelist to setup remaining cseDHWLOOP properties"
				Proj:Action				= {	if (ComponentCount( cseDHWLOOP ) < 1) then  UNCHANGED
													else	EvalRulelist( "CSE_SimulationPrep_DHWLoop" )  endif  }		; default all via one call


; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	"Call subordinate rulelist to revise whEF of cseDHWHEATER to a Load Dependent Energy Factor (LDEF) - ONLY for Small Storage water heaters"
;				cseDHWHEATER:Action	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc > 0 ) .AND. IfValidAnd( whEF > 0 ))
;													then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_LDEF",  1 )
;													else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWHEATREC"  1 0 0 0
   "Set cseDHWHEATREC:wrType"        cseDHWHEATREC:wrType        = {
         if (LocalCompAssigned( SourceDWHRSys )) then  SourceDWHRSys:Type         else  UNCHANGED  endif  }
   "Set cseDHWHEATREC:wrCSARatedEF"  cseDHWHEATREC:wrCSARatedEF  = {
         if (LocalCompAssigned( SourceDWHRSys )) then  int( (10*SourceDWHRSys:CSARatedEff)+0.5 ) / 1000  else  UNCHANGED  endif  }
   ; SAC 1/8/19 - revised rule to round to nearest tenth of % and post to CSE as fraction (not %)
   ;      if (LocalCompAssigned( SourceDWHRSys )) then  SourceDWHRSys:CSARatedEff  else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWSYS_MetersAndTemperatures" 1 0 0 0
	"Set cseDHWSYS:wsElecMtr"			cseDHWSYS:wsElecMtr		= {	Proj:CSE_ElecMETER  }
	"Set cseDHWSYS:wsFuelMtr"			cseDHWSYS:wsFuelMtr		= {	     if (Proj:Fuel_HaveNatGas > 0.5) then  Proj:CSE_NatGasMETER
																						else if (Proj:Fuel_HaveOther  > 0.5) then  Proj:CSE_OtherFuelMETER
																						else  UNDEFINED  endif endif  }

	"Set cseDHWSYS:wsFXHwMtr"			cseDHWSYS:wsFXHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_FXHwDHWMETER ) < 1) then  UNDEFINED		; SAC 4/25/16
																						else	Proj:CSE_FXHwDHWMETER  endif  }
	"Set cseDHWSYS:wsWHHwMtr"			cseDHWSYS:wsWHHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_WHHwDHWMETER ) < 1) then  UNDEFINED
																						else	Proj:CSE_WHHwDHWMETER  endif  }

	"Set cseDHWSYS:wsTUse"				cseDHWSYS:wsTUse			=           ; SAC 10/24/19 - hardwire 'new' CSE central electric system model wsTUse to 125
      {  if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 )) then  125
         else	SourceDHWSys:HWSupplyTemp  endif endif  }

   "Set demand response method: cseDHWSYS:wsDRMethod"       cseDHWSYS:wsDRMethod  =          ; SAC 01/11/21
      {  if (IfValidAnd( SourceDHWSys:DemRespCompat > 0 ) .AND. LocalCompAssigned( SourceDHWSys:DRSignalSchRef ))
         then  if (LocalStatus( SourceDHWSys:DRSignalSchRef:CSEinput ) > 0)
               then  "Schedule"
               else  UNDEFINED  endif
         else  UNDEFINED  endif  }

	; SAC 3/28/17 - added in conjunction w/ latest demand response CSE HPWH model
   ; SAC 6/14/17 - added logic to ensure proper SourceDHWSys:DemandResponseFlag (to help facilitate toggling off demand response)
   "Set cseDHWSYS:wsTSetpoint_x"    cseDHWSYS:wsTSetpoint_x  = {
	      if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 )) then  UNDEFINED
	      else if (strlen( SourceDHWSys:TSetpoint_x ) < 2) then  UNDEFINED
	      else  SourceDHWSys:TSetpoint_x
	      endif endif endif  }

   "Set demand response temp schedule for cseDHWSYS:wsTSetpoint_x"   cseDHWSYS:wsTSetpoint_x  =     ; SAC 12/11/20
      {  if (IfValidAnd( SourceDHWSys:DemRespCompat > 0 ) .AND. LocalCompAssigned( SourceDHWSys:DRTempSetptSchRef ))
         then  if (LocalStatus( SourceDHWSys:DRTempSetptSchRef:CSEinput ) > 0)
               then  SourceDHWSys:DRTempSetptSchRef:CSEinput
               else  UNCHANGED  endif
         else  UNCHANGED  endif  }
   "Set demand response temp schedule for cseDHWSYS:wsDRSignal_x"    cseDHWSYS:wsDRSignal_x  = 
      {  if (IfValidAnd( SourceDHWSys:DemRespCompat > 0 ) .AND. LocalCompAssigned( SourceDHWSys:DRSignalSchRef ))
         then  if (LocalStatus( SourceDHWSys:DRSignalSchRef:CSEinput ) > 0)
               then  SourceDHWSys:DRSignalSchRef:CSEinput
               else  UNCHANGED  endif
         else  UNCHANGED  endif  }

	; SAC 4/6/16 - added in conjunction w/ CSE 0.796 - related to new HPWH model
	"Set cseDHWSYS:wsTSetpoint"		cseDHWSYS:wsTSetpoint	=           ; SAC 10/24/19 - hardwire 'new' CSE central electric system model wsTSetpoint to 135   ; SAC 5/27/20   ; SAC 6/2/20 - removed dependence on SourceDHWSys:NewCentralElecModel
      {  if (Proj:CSEDHWUseMethod == 1 .OR. LocalStatus( wsTSetpoint_x ) > 0) then  UNDEFINED
         else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:CentralElecDHW > 0 ))
         then  if (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 ) .AND. IfValidAnd( SourceDHWSys:CHPWHSysDescrip > 0 ) .AND.
                   IfValidAnd( SourceDHWSys:CHPWHTankSetpt > 0 )) then  SourceDHWSys:CHPWHTankSetpt
               else  135  endif
         else	125  endif endif endif  }		; SAC 5/20/16 - removed MFam-Central dependence (e-mailed request from BAW)
	;		else if (Proj:IsMultiFamily > 0.5 .AND. SourceDHWSys:CentralDHW > 0.5)		; SAC 4/13/16 - revised to 130 for central systems
	;		then  130  else  125  endif endif endif  }

; 1,           "wsTSetPointLH",     BEMP_Flt,  1,  0,  1, "F",               0,  0,                          3208, "Setpoint temperature for loop heater"    
	"Set cseDHWSYS:wsTSetPointLH"	   cseDHWSYS:wsTSetPointLH			=           ; SAC 11/14/19 - fix to incorporate wsTSetPointLH into new central DHWSYS objects   ; SAC 5/27/20   ; SAC 6/2/20 - removed dependence on SourceDHWSys:NewCentralElecModel & MFamDistType
      {  if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ))
         then  if (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 ) .AND. IfValidAnd( SourceDHWSys:CHPWHSysDescrip > 0 ) .AND.
                   IfValidAnd( SourceDHWSys:CHPWHLoopTankType > 0 ) .AND. IfValidAnd( SourceDHWSys:CHPWHLoopTankSetpt > 0 ))
               then  SourceDHWSys:CHPWHLoopTankSetpt
               else if (LocalCompAssigned( SourceDHWSys:LoopHeater ) > 0)
               then  136
               else  UNDEFINED  endif endif
         else	UNDEFINED  endif endif  }

	; Solar savings fraction inputs
	      ; SAC 2/3/20 - mods to all following rules to prevent SSF modeling for 2019.1.2 (w/ no EnableResearchMode) (tic #1189)    - SAC 3/9/20 - modified further to remove SSF for all 2019.1.2 and later releases, regardless of EnableResearchMode
	      ; SAC 6/23/20 - modified to enable writing of wsSSF for OG-300 DWHSolarSys objects (tic #1210)
	"Set cseDHWSYS:wsSSF"		cseDHWSYS:wsSSF		=     ; SAC 1/15/20 - add logic preventing output of wsSSF if CSE DHWSOLARSYS employed (tic #1013)
      {  if (IfValidAnd( SourceDHWSys:DHWSolarSysRef:ErrID > 0 )==0 .AND.
             IfValidAnd( SourceDHWSys:DHWSolarSysRef:RatingProgram = 3 ) .AND.
             IfValidAnd( SourceDHWSys:DHWSolarSysRef:RatedSSF > 0 ))
         then  SourceDHWSys:DHWSolarSysRef:RatedSSF
         else if (SourceDHWSys:SolFracType != 1 .OR. IfValidAnd( SourceDHWSys:SolFracAnn >= 0 )==0) then  UNDEFINED 
         else if (IfValidAnd( Proj:AnalysisVersion >= 190102 )) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:CSESolarSysSimValid > 0 )) then  UNDEFINED
         else  SourceDHWSys:SolFracAnn  endif endif endif endif  }
	"Set cseDHWSYS:wsSSF_x"		cseDHWSYS:wsSSF_x		=     ; SAC 1/15/20 - add logic preventing output of wsSSF if CSE DHWSOLARSYS employed (tic #1013)
      {  if (SourceDHWSys:SolFracType != 2 .OR.
             IfValidAnd( SourceDHWSys:SolFracMon[1]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[2]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[3]  >= 0 )==0 .OR.
             IfValidAnd( SourceDHWSys:SolFracMon[4]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[5]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[6]  >= 0 )==0 .OR.
             IfValidAnd( SourceDHWSys:SolFracMon[7]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[8]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[9]  >= 0 )==0 .OR.
             IfValidAnd( SourceDHWSys:SolFracMon[10] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[11] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[12] >= 0 )==0 ) then  UNDEFINED
         else if (IfValidAnd( Proj:AnalysisVersion >= 190102 )) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:CSESolarSysSimValid > 0 )) then  UNDEFINED
         else	Format( "choose1( $month, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g )", SourceDHWSys:SolFracMon[1], SourceDHWSys:SolFracMon[2], SourceDHWSys:SolFracMon[3],
                        SourceDHWSys:SolFracMon[4], SourceDHWSys:SolFracMon[5], SourceDHWSys:SolFracMon[6], SourceDHWSys:SolFracMon[7], SourceDHWSys:SolFracMon[8],
                        SourceDHWSys:SolFracMon[9], SourceDHWSys:SolFracMon[10], SourceDHWSys:SolFracMon[11], SourceDHWSys:SolFracMon[12] )
         endif endif endif  }
	"Set cseDHWSYS:wsSolarSys"		cseDHWSYS:wsSolarSys	=     ; SAC 1/15/20 (tic #1013)
      {  if (IfValidAnd( Proj:AnalysisVersion >= 190102 )==0 .OR. IfValidAnd( SourceDHWSys:CSESolarSysSimValid > 0 )==0) then  UNDEFINED
         else  SourceDHWSys:DHWSolarSysRef:cseDHWSOLARSYSRef:Name  endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_DHWHtr" 1 0 0 1
;*************************************************************************
   ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
	"Set cseDHWHEATER:whType"			cseDHWHEATER:whType		= 
      {  if (IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )) then  6 ; "BuiltUp"  SAC 5/28/20
         else if (SourceDHWHeater:HeaterElementType == 5) then  1	; "Heat Pump (2016)" -> "Small Storage"
			else	switch ( SourceDHWHeater:HeaterType )
						case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
						case 16 :	4		; "Commercial Packaged Boiler" -> "LargeInstantaneous"   ; SAC 12/30/19 (tic #862)
						case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
						case  2 :	4	 	; "Large Instantaneous" 
						case  3 :	2  	; "Large Storage"   
					;	case  4 :	PostError( "Unable to translate DHWHeater:TankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 			; "Large Tankless" 
						case  5 :	3		; "Small Instantaneous" 
						case  6 :	1		; "Small Storage"     
						case  9 :	5	 	; "UEF-rated Instantaneous" 
					;	case  7 :	PostError( "Unable to translate DHWHeater:TankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) 	; "Unfired Storage Tank" 
						case  8 :	PostError( "Unable to translate DHWHeater:HeaterType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
                  case 10 : 3;  "Consumer Instantaneous (UEF)"   ->   SmallInstantaneous
                  case 11 : 4;  "Commercial Instantaneous (TE)   ->   LargeInstantaneous
                  case 12 : 1;  "Consumer Storage (UEF)"   ->   SmallStorage
                  case 13 : 2;  "Commercial Storage (TE & SBL)   ->   Large Storage
                  case 14 : 2;  "Residential-Duty Commercial Storage (UEF)"   ->   LargeStorage
                  case 15 : 4;  Residential-Duty Commercial Instantaneous (UEF)   ->   LargeInstantaneous
						default :	PostError( "Unable to translate DHWHeater:HeaterType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceDHWHeater:HeaterType )
					endswitch  endif endif  }
      ; UEF -> whType = INSTANTANEOUSUEF (5)
	"Set cseDHWHEATER:whHeatSrc"
			cseDHWHEATER:whHeatSrc	= {	switch ( SourceDHWHeater:HeaterElementType )
														case  0 :	if (SourceDHWHeater:ShowTankLocation > 0.5)
																		then  5		; "Electric Resistance"  -> ResistanceX - switched from Res - SAC 4/14/16
																		else  2		; "Resistance"
																		endif
														case  1 :	1		; "Natural Gas"          -> Fuel
														case  2 :	1		; "Propane"              -> Fuel 
														case  3 :	3		; "Heat Pump"            -> ASHP
														case  4 :	1		; "Oil"                  -> Fuel
														case  5 :	4		; "Heat Pump (2016)"     -> ASHPX		; SAC 3/19/16
														default :	PostError( "Unable to translate DHWHeater:HeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceDHWHeater:HeaterElementType )
													endswitch  }
      ; UEF -> whHeatSrc = Fuel (1)  (required when whType = INSTANTANEOUSUEF (5))
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
	"Set cseDHWHEATER:whFuelMtr"
			cseDHWHEATER:whFuelMtr	= {	if (Proj:StandardsVersion > 2016 .OR. Proj:DRtgRefRunID == 2014)		; SAC 11/9/15  - SAC 4/7/16 - added in RESNET here (tic #631)
													then	switch ( SourceDHWHeater:HeaterElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
																case  0 :	UNDEFINED		; "Electric Resistance"  
																case  3 :	UNDEFINED		; "Heat Pump (2013)" 
																case  5 :	UNDEFINED		; "Heat Pump (2016)" 
																default :	if (     Proj:Fuel_HaveNatGas > 0.5 .AND. GlobalCompAssigned( Proj:CSE_NatGasMETER    )) then  Proj:CSE_NatGasMETER
																				else if (Proj:Fuel_HaveOther  > 0.5 .AND. GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then  Proj:CSE_OtherFuelMETER
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - expected Proj:*METER not found.", Name )  endif endif
															endswitch
													else	switch ( SourceDHWHeater:HeaterElementType )
																case  0 :	UNDEFINED		; "Electric Resistance"   
																case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
																case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
																case  3 :	UNDEFINED		; "Heat Pump (2013)" 
																case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
																case  5 :	UNDEFINED		; "Heat Pump (2016)" 
																default :	UNDEFINED
															endswitch  endif  }

   ; SAC 9/10/15   ; SAC 10/25/19 - added use of NonStdTankVolume (Sanden HPWHs in elec central systems only)   ; SAC 3/6/20 - revise logic for multiple central compressor types (Colmac)
	"Set cseDHWHEATER:whVol"   cseDHWHEATER:whVol	=            ; revised logic for std CHPWH - SAC 07/05/21 (tic #1275)
   {  if (SourceDHWHeater:HeaterElementType == 5 .AND.
          IfValidAnd( SourceDHWHeater:HPWH_NEEARated > 0 ) .AND.
          IfValidAnd( SourceDHWHeater:CentralHPWHCprsrType > 0 ) .AND.
          IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ) .AND.
          IfValidAnd( SourceDHWHeater:IsElecCentralHtr > 0 ) .AND.
          IfValidAnd( SourceDHWHeater:NonStdTankVolume > 0 ))
      then  SourceDHWHeater:NonStdTankVolume
      else if (IfValidAnd( SourceDHWHeater:TankVolume > 0 )==0)
      then  UNDEFINED
      else if (            SourceDHWHeater:HeaterElementType == 5 .AND. 
               IfValidAnd( SourceDHWHeater:HPWH_NEEARated  < 0.5 ) .AND.
               IfValidAnd( SourceDHWHeater:HPWH_ComProduct < 0.5 ) )                  ; SAC 02/01/21 (tic #1260)
      then  SourceDHWHeater:TankVolume                                            ; Heat Pump WH including UEF rated
      else if ( ( IfValidAnd( SourceDHWHeater:HeaterType = 3 ) == 0 .AND.           ; Not Large Storage AND
                  IfValidAnd( SourceDHWHeater:HeaterType = 6 ) == 0 .AND.           ; Not Consumer Storage (UEF) 
                  IfValidAnd( SourceDHWHeater:HeaterType = 12 ) == 0 .AND.          ; Not Small Storage
                  IfValidAnd( SourceDHWHeater:HeaterType = 13 ) == 0 .AND.          ; Not Commercial Storage
                  IfValidAnd( SourceDHWHeater:HeaterType = 14 ) == 0 ) .OR.         ; Not Residential-Duty Commercial Storage (UEF)
  		 			 SourceDHWHeater:HeaterElementType == 5 )                           ; NEAA Rated (or Com) HPWH
      then  UNDEFINED 
   	else  SourceDHWHeater:TankVolume  
      endif endif endif endif  }

	"Set cseDHWHEATER:whEF"  cseDHWHEATER:whEF		= {	
    if ( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) .AND. 
         SourceDHWHeater:HeaterElementType == 5 )                              ; LH 170717 - UEF Rated Heat Pump Water Heater
    then  if( SourceDHWHeater:IsUEF .AND. 
              IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
          then  SourceDHWHeater:UEFModelCalcEF                                     
          else if( SourceDHWHeater:HPWH_NEEARated  < 0.5 .AND.                 ; LH 170717 - EF Rated Heat Pump Water Heater
                   SourceDHWHeater:HPWH_ComProduct < 0.5 )                     ; SAC 02/01/21 (tic #1260)
          then  SourceDHWHeater:EnergyFactor                                        
          else  UNDEFINED
          endif endif
    else if ( SourceDHWHeater:HeaterElementType != 5 .AND. 
				  ( IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 ) ) )     ; SAC 8/21/15 - only for small instantaneous & storage		
    then  if( IfValidAnd( SourceDHWHeater:HeaterType = 10 )  .AND.             ; LH 170717 - Consumer Storage (UEF)
              IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )               ; LH 170717 - Consumer Instantaneous (UEF) - RE translated to whEF
          then  if( SourceDHWHeater:HeaterElementType = 1 )
                then 0.9734*SourceDHWHeater:UEFModelCalcRE + 0.01835           ; LH 170718 - Gas RE to EF Eqn provided by Jim Lutz and CEC
                else SourceDHWHeater:UEFModelCalcRE                            ; LH 170718 - Electric RE to EF equivalence provided by Jim Lutz and CEC
                endif
          else if( IfValidAnd( SourceDHWHeater:HeaterType = 12 ) .AND.         ; LH 170717 - Consumer Storage (UEF)
                   IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
          then  SourceDHWHeater:UEFModelCalcEF                                      
          else if( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) )
          then  SourceDHWHeater:EnergyFactor  
          else  UNDEFINED
          endif endif endif
    else  UNDEFINED  
    endif endif  }

	"Set cseDHWHEATER:whUEF"      cseDHWHEATER:whUEF  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ))
         then  SourceDHWHeater:EnergyFactor  else  UNDEFINED  endif  }
         ; UEF -> whHeatSrc = Fuel  (required when whType = INSTANTANEOUSUEF (5))

	"Set cseDHWHEATER:whEff" cseDHWHEATER:whEff	= {	
    if ( SourceDHWHeater:HeaterElementType != 5 .AND. 
				 ( IfValidAnd( whType = 2 ) .OR.                                       ; SAC 8/21/15 - only for boiler & large instantaneous & storage
           IfValidAnd( whType = 4 ) ) )		                                     
    then if( IfValidAnd( SourceDHWHeater:HeaterType = 14 ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)   
             IfValidAnd( SourceDHWHeater:RecovEff > 0 ) )
      then SourceDHWHeater:RecovEff/100                                       
      else if( IfValidAnd( SourceDHWHeater:HeaterType = 15 ) .AND.               ; LH 170717 - Residential-Duty Commercial Instantaneous (UEF)
               IfValidAnd( SourceDHWHeater:UEFModelCalcTE > 0 ) )
      then SourceDHWHeater:UEFModelCalcTE                                     
      else if( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) )                ; LH 170718 - Commercial Instantaneous (TE) and Commercial Storage (TE & SBL) covered under this cat
      then SourceDHWHeater:EnergyFactor
      else UNDEFINED
      endif endif endif

		else if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:RecovEff > 0 ))
		then  SourceDHWHeater:RecovEff / 100
		else  UNDEFINED  
    endif endif }
; Code Snippet for rule above:
;    else if( IfValidAnd( whType = 3 ) .AND. 
;             IfValidAnd( SourceDHWHeater:HeaterType = 10 ) .AND.                 LH 170718 - Consumer Instantaneous (UEF)
;             IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )
;    then SourceDHWHeater:UEFModelCalcRE  



   ; SAC 5/25/17 - UEF-rated Instantaneous properties
   ; LH 170717 - Not modified for 2016 UEF Rated Mods - relates to new whType = 5
   "Set cseDHWHEATER:whRatedFlow"      cseDHWHEATER:whRatedFlow   = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:RatedFlow > 0 ))
         then  SourceDHWHeater:RatedFlow  else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whAnnualFuel"     cseDHWHEATER:whAnnualFuel  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:AnnFuelUse > 0 ))
         then  SourceDHWHeater:AnnFuelUse  else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whAnnualElec"     cseDHWHEATER:whAnnualElec  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:AnnElecUse > 0 ))
         then  SourceDHWHeater:AnnElecUse  else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whStbyElec"       cseDHWHEATER:whStbyElec    = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:StandbyElec > 0 ))
         then  SourceDHWHeater:StandbyElec  else  UNDEFINED  endif  }

   "Set cseDHWHEATER:whTankCount (tanks per htr/compressor)"   cseDHWHEATER:whTankCount  =      ; SAC 5/28/20
      {  if (IfValidAnd( SourceDHWHeater:TankCountSim > 0 ))
         then  SourceDHWHeater:TankCountSim
         else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whInsulR"      cseDHWHEATER:whInsulR  =         ; SAC 5/28/20
      {  if (IfValidAnd( SourceDHWHeater:InsulRValSim >= 0 ))
         then  SourceDHWHeater:InsulRValSim
         else  UNDEFINED  endif  }

   ; increased min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
   "Set cseDHWHEATER:whResHtPwr (upper)"     cseDHWHEATER:whResHtPwr  =    ; SAC 5/29/20
      {  if (IfValidAnd( SourceDHWHeater:ResHtPwrSim[1] >= 0.1 ))
         then  SourceDHWHeater:ResHtPwrSim[1]
         else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whResHtPwr2 (lower)"    cseDHWHEATER:whResHtPwr2 = 
      {  if (IfValidAnd( SourceDHWHeater:ResHtPwrSim[2] >= 0.1 ))
         then  SourceDHWHeater:ResHtPwrSim[2]
         else  UNDEFINED  endif  }

; whHPAF removed from CSE by CB - SAC 1/22/20
;	"Set cseDHWHEATER:whHPAF"
;			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  T24RClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:ClimateZone )  else  UNDEFINED  endif  }

	; SAC 11/10/15 - added logic to transmit Pilot Energy in Btuh directly into whSBL input
	"Set cseDHWHEATER:whSBL"  cseDHWHEATER:whSBL	= {	
    if( IfValidAnd( whType = 2 ) )		                                         ; SAC 8/21/15 - only for large storage		
    then if( IfValidAnd( SourceDHWHeater:HeaterType = 14 ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)            
             IfValidAnd( SourceDHWHeater:UEFModelCalcSL > 0 ) )
      then SourceDHWHeater:UEFModelCalcSL                                      
      else if( IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND.          ; LH 170718 - Commercial Storage (TE & SBL) covered under this line item
               IfValidAnd( SourceDHWHeater:StandbyLossFrac < 1 ) .AND.
				       IfValidAnd( SourceDHWHeater:TankVolume > 0 ) )
      then                                                                     ; SAC 9/8/15 - revised to be based on TankVolume
        SourceDHWHeater:StandbyLossFrac * 8.25 * SourceDHWHeater:TankVolume * 70
						; no whSBL modeled for any whType other than LargeStorage - this setting moved to whPilotPwr below
						;						else if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ))
						;						then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
						;						else  UNDEFINED  endif endif  }
			else  UNDEFINED  
      endif endif

									;				 IfValidAnd( SourceDHWHeater:InputRatingSim > 0 ) .AND. IfValidAnd( SourceDHWHeater:HeaterType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceDHWHeater:InputRatingSim * SourceDHWHeater:StandbyLossFrac  else  UNDEFINED  endif  }
    else UNDEFINED
    endif }


	"Set cseDHWHEATER:whPilotPwr" cseDHWHEATER:whPilotPwr	= {
    if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND. IfValidAnd( whHeatSrc = 1 ))
													then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
													else  UNDEFINED  endif  }

	; SAC 11/10/15 - added whParElec to model Elec Mini Tank elec use
	"Set cseDHWHEATER:whParElec"
			cseDHWHEATER:whParElec	= {	if (IfValidAnd( SourceDHWHeater:AllowElecMiniTank > 0 ) .AND. IfValidAnd( SourceDHWHeater:HasElecMiniTank > 0 ) .AND.
														 IfValidAnd( SourceDHWHeater:ElecMiniTankPower > 0 ) )
													then  SourceDHWHeater:ElecMiniTankPower  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whElecMtr"		cseDHWHEATER:whElecMtr		= {	if (IfValidAnd( whParElec > 0 )) then  Proj:CSE_ElecMETER  else  UNCHANGED  endif  }

; SAC 3/19/16 - DHW input generation for new ASHP detailed model
; SAC 5/19/16 - updated logic w/ HPWH_NEEARated
; SAC 11/16/17 - updated w/ new NEEA list (tic #927)  - FURTHER UPDATES NEEDED ONCE NEW SIM TYPES IMPLEMENTED IN CSE
	"Set cseDHWHEATER:whASHPType"		cseDHWHEATER:whASHPType		=     ; added ASHPAutoSize to logic - SAC 07/05/21 (tic #1275)
      {  if (SourceDHWHeater:HeaterElementType != 5 .OR.
				 (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND.
              (IfValidAnd( SourceDHWHeater:HPWH_NEEARated  > 0.5 ) .OR.
               IfValidAnd( SourceDHWHeater:HPWH_ComProduct > 0.5 )))) then  UNDEFINED
			else if (IfValidAnd( SourceDHWHeater:HPWH_NEEARated  > 0.5 )==0 .AND.
                  IfValidAnd( SourceDHWHeater:HPWH_ComProduct > 0.5 )==0 .AND.
                  IfValidAnd( SourceDHWHeater:ASHPAutoSize    > 0.5 )==0) then  "Generic"
			else	switch ( SourceDHWHeater:ASHPType )
						case  11: "AOSmithPHPT60"		; "AO Smith PHPT 60"
						case  12: "AOSmithPHPT80"		; "AO Smith PHPT 80"
						case  13: "AOSmithHPTU50"		; "AO Smith HPTU 50"
						case  14: "AOSmithHPTU66"		; "AO Smith HPTU 66"
						case  15: "AOSmithHPTU80"		; "AO Smith HPTU 80"
			;			case  19: "GE2014StdMode"		; "GE2014 50"
			;			case  23: "GE2014StdMode80"	; "GE2014 80"
						case  19: "GE2014"		      ; "GE2014 50"
						case  23: "GE2014_80"	      ; "GE2014 80"
						case  21: "RheemHB50"			; "Rheem HB 50"
						case  22: "Stiebel220E"			; "Stiebel 220E"
                  case  39: "RheemHBDR4550"     ; "Rheem HBDR-45-50"  - NEW SIM TYPES (tic #927) - SAC 11/28/17
                  case  40: "RheemHBDR4565"     ; "Rheem HBDR-45-65"
                  case  41: "RheemHBDR4580"     ; "Rheem HBDR-45-80"
                  case  42: "RheemHBDR2250"     ; "Rheem HBDR-22-50"
                  case  43: "RheemHBDR2265"     ; "Rheem HBDR-22-65"
                  case  44: "RheemHBDR2280"     ; "Rheem HBDR-22-80"
						default :	if (Proj:EnergyCodeYearNum >= 2016 .OR.
						                IfValidAnd( Proj:EnableResearchMode > 0.5 ))
										then	switch ( SourceDHWHeater:ASHPType )
													case 16: "Sanden40"				; "Sanden 40"
													case 17: "Sanden80"				; "Sanden 80"
													case 31: "AOSmithHPTU80DR"		; "AO Smith HPTU 80 DR"  - SAC 3/28/17
													case 32: "AOSmithSHPT50"		; "AO Smith SHPT 50"   
													case 33: "AOSmithSHPT66"		; "AO Smith SHPT 66"   
													case 34: "AOSmithSHPT80"		; "AO Smith SHPT 80"   
                                       case 72: "AOSmithCAHP120"     ; "AO Smith CAHP-120"     ; SAC 01/30/21 (tic #1260)
						                     case 37: "GE2014"             ; "GE2014 50 Eff"
													case 35: "GE2014_80"          ; GE2014_80 efficiency mode  - SAC 4/3/17
													case 36: "GE2014_80DR"        ; GE2014_80 efficiency mode w/ DR
													case 38: "GE2012"             ; GE2012_50   - SAC 8/10/17
                                 ;      case 45: "ColmacCxA20"        ; "Colmac CxA20"  - SAC 3/9/20 (Colmac)
                                 ;      case 46: "NyleC185A"          ; "Nyle C185A external"  - SAC 4/19/20
                                 ;      case 47: "NyleC250A"          ; "Nyle C250A external"  - SAC 4/19/20
                                       case 48: "ColmacCxV5_SP"      ; Colmac CxV-5       ; SAC 5/27/20
                                       case 49: "ColmacCxA10_SP"     ; Colmac CxA-10
                                       case 50: "ColmacCxA15_SP"     ; Colmac CxA-15
                                       case 45: "ColmacCxA20_SP"     ; Colmac CxA-20
                                       case 51: "ColmacCxA25_SP"     ; Colmac CxA-25
                                       case 52: "ColmacCxA30_SP"     ; Colmac CxA-30
                                       case 53: "NyleC25A_SP"        ; Nyle C25A
                                       case 54: "NyleC60A_SP"        ; Nyle C60A
                                       case 55: "NyleC90A_SP"        ; Nyle C90A
                                       case 56: "NyleC125A_SP"       ; Nyle C125A
                                       case 46: "NyleC185A_SP"       ; Nyle C185A
                                       case 47: "NyleC250A_SP"       ; Nyle C250A
                                       case 67: "NyleC60A_CWP_SP"    ; Nyle C60A-CWP         ; SAC 6/23/20 - added cold wthr package presets
                                       case 68: "NyleC90A_CWP_SP"    ; Nyle C90A-CWP    
                                       case 69: "NyleC125A_CWP_SP"   ; Nyle C125A-CWP   
                                       case 70: "NyleC185A_CWP_SP"   ; Nyle C185A-CWP   
                                       case 71: "NyleC250A_CWP_SP"   ; Nyle C250A-CWP   
                                       case 57: "SandenGS3"          ; Sanden GS3-45HPA-US   ; used to map to 17 - Sanden 80
                  case  58: "BWC202065"         ; SAC 6/16/20 - NEEA additions
                  case  59: "Rheem2020Prem40"
                  case  60: "Rheem2020Prem50"
                  case  61: "Rheem2020Prem65"
                  case  62: "Rheem2020Prem80"
                  case  63: "Rheem2020Build40"
                  case  64: "Rheem2020Build50"
                  case  65: "Rheem2020Build65"
                  case  66: "Rheem2020Build80"
                  case  73: "AWHSTier3Generic40"    ; NEEA generic tier 3 options - SAC 06/17/21
                  case  74: "AWHSTier3Generic50"
                  case  75: "AWHSTier3Generic65"
                  case  76: "AWHSTier3Generic80"
                  case  77: "RheemPlugInShared40"     ; SAC 11/04/22
                  case  78: "RheemPlugInShared50"
                  case  79: "RheemPlugInShared65"
                  case  80: "RheemPlugInShared80"
                  case  81: "RheemPlugInDedicated40"
                  case  82: "RheemPlugInDedicated50"
                  case  91: "Scalable_SP"    ; 5kW    ; SAC 06/22/21
                  case  92: "Scalable_SP"    ; 11kW
                  case  93: "Scalable_SP"    ; 20kW
                  case  94: "Scalable_SP"    ; 26kW
                  case  95: "Scalable_SP"    ; 40kW
                  case  96: "Scalable_SP"    ; 45kW
													case 99: "WorstCaseMedium"		; "Worst Case Medium"
													default:  UNDEFINED
												endswitch
										else  UNDEFINED  endif
					endswitch  endif endif  }

	"Set cseDHWHEATER:whHeatingCap - wtr htr compressor output"    cseDHWHEATER:whHeatingCap  =       ; SAC 06/24/21   ; added AutoSzCap - SAC 07/09/21 (tic #1275)
      {  if (SourceDHWHeater:HeaterElementType != 5 .OR.
				 (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND.
              (IfValidAnd( SourceDHWHeater:HPWH_NEEARated  > 0.5 ) .OR.
               IfValidAnd( SourceDHWHeater:HPWH_ComProduct > 0.5 )))) then  UNDEFINED
         else if (IfValidAnd( AutoSzCap > 0 )) then  AutoSzCap
			else if (IfValidAnd( SourceDHWHeater:HPWH_NEEARated  > 0.5 )==0 .AND.
                  IfValidAnd( SourceDHWHeater:HPWH_ComProduct > 0.5 )==0) then  UNDEFINED
			else	switch ( SourceDHWHeater:ASHPType )
                  case  91:   5 * 3412    ;  5kW
                  case  92:  11 * 3412    ; 11kW
                  case  93:  20 * 3412    ; 20kW
                  case  94:  26 * 3412    ; 26kW
                  case  95:  40 * 3412    ; 40kW
                  case  96:  45 * 3412    ; 45kW
                  default : UNDEFINED
               endswitch  endif endif endif  }
;"dbg" Proj:Action = { if (Proj:RunAbbrev == "s" .AND. SumAll( cseDHWHEATER:AutoSzCap ) > 0) then  StoreBEMProc( Format( "AutoszdCHPWH data-std" ), 0 )  else UNCHANGED endif }

	"Set cseDHWHEATER:whVolRunning - tank vol needed in excess of htg cap to get through htg event"    cseDHWHEATER:whVolRunning  =     ; SAC 07/09/21 (tic #1275)
      {  if (SourceDHWHeater:HeaterElementType != 5 .OR.
				 (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND.
              (IfValidAnd( SourceDHWHeater:HPWH_NEEARated  > 0.5 ) .OR.
               IfValidAnd( SourceDHWHeater:HPWH_ComProduct > 0.5 )))) then  UNDEFINED
         else if (IfValidAnd( AutoSzVol > 0 )) then  AutoSzVol
			else	UNDEFINED  endif endif  }

   ; SAC 6/13/18 - updated InputRating property name to InputRatingSim to accommodate InputRating being ignored for most heater types (tic #940)
   ; increased min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
	"Set cseDHWHEATER:whResHtPwr"		cseDHWHEATER:whResHtPwr		= {	if (SourceDHWHeater:HeaterElementType != 0 .OR.
                                                                         IfValidAnd( SourceDHWHeater:ShowTankLocation > 0 )==0 .OR.
																								 IfValidAnd( SourceDHWHeater:InputRatingSim >= 0.1 )==0) then  UNDEFINED
																							else	SourceDHWHeater:InputRatingSim  endif  }

   ; updates for large std design central HPWHs - SAC 07/10/21
	"Set cseDHWHEATER:whZone"			cseDHWHEATER:whZone			= {	if (IfValidAnd( SourceDHWHeater:ShowTankLocation > 0 )==0 .OR.
																								 IfValidAnd( SourceDHWHeater:TankOutside > 0 ) .OR.
																								 LocalCompAssigned( SourceDHWHeater:TankZone ) < 1 .OR.
                                                                         IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
																							else if (LocalCompAssigned( SourceDHWHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
																							else	SourceDHWHeater:TankZone:CSE_ZONE  endif endif  }
;"dbg" cseDHWHEATER:Action = {  PostMessageToLog( "cseDHWHEATER '%s' setting whTEx_x for '%s' run:  ShowTankLocation=%g", Name, Proj:RunAbbrev, ValidOr( SourceDHWHeater:ShowTankLocation, -999 ) ) }
	; SAC 1/4/20 - added distinction between TankOutside ($tDbO) & zone unassigned (uncond => ($tDbO + 70) / 2) (tic #862)
	"Set cseDHWHEATER:whTEx_x"			cseDHWHEATER:whTEx_x			= {	if (IfValidAnd( SourceDHWHeater:ShowTankLocation > 0 )==0 .OR. 
																								 LocalCompAssigned( whZone ) > 0) then  UNDEFINED
	                                                                  else if (IfValidAnd( SourceDHWHeater:TankOutside > 0 )) then  "$tDbO"
                                                                     else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
                                                                     then  if (LocalCompAssigned( SourceDHWHeater:TankZone ) > 0)
                                                                           then  if (LocalCompAssigned( SourceDHWHeater:TankZone ) == ComponentType( "Zone" ) .OR.
                                                                                     LocalCompAssigned( SourceDHWHeater:TankZone ) == ComponentType( "OtherZone" ))
                                                                                 then  if (IfValidAnd( SourceDHWHeater:TankZone:Type < 10 ))
                                                                                       then  "70"
                                                                                       else  "($tDbO + 70) / 2"  endif
                                                                                 else  "($tDbO + 70) / 2"  endif
                                                                           else  "$tDbO"  endif
	                                                                  else  "($tDbO + 70) / 2"  endif endif endif  }

   ; removed restriction on ASHPSplit > 0 and ASHPType > 0 when setting both whASHPSrcZn & whASHPSrcT_x - SAC 03/25/22 (tic #1327)
   ; RESTORED restriction on ASHPSplit > 0 and ASHPType > 0 when setting both whASHPSrcZn & whASHPSrcT_x FOR 2019 analysis - SAC 11/18/22 (tic #1341)
     ;        (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:HPWH_NEEARated > 0.5 )) .OR.
     ;        (IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .AND. IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IsCentralHPWH > 0 )==0) .OR.
   "Set cseDHWHEATER:whASHPSrcZn"   cseDHWHEATER:whASHPSrcZn   =     ; revise logic to reference ASHPTSrcOutside only for 2022+ analysis - SAC 11/18/22 (tic #1341)
      {  if (SourceDHWHeater:HeaterElementType != 5 .OR.
             ( IfValidAnd( Proj:AnalysisVersion < 220000 ) .AND. 
               ( (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:HPWH_NEEARated > 0.5 )) .OR.
                 (IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .AND. IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IsCentralHPWH > 0 )==0) ) ) .OR.
             IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ) .OR.
             LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) < 1 .OR.
             IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
         else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone:CSE_ZONE ) < 1) then  UNDEFINED
         else   SourceDHWHeater:ASHPTSrcZone:CSE_ZONE  endif endif  }
     ;        (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:HPWH_NEEARated > 0.5 )) .OR. 
     ;        (IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .AND. IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IsCentralHPWH > 0 )==0) .OR.
   "Set cseDHWHEATER:whASHPSrcT_x"   cseDHWHEATER:whASHPSrcT_x   =
      {  if (SourceDHWHeater:HeaterElementType != 5 .OR.
             ( IfValidAnd( Proj:AnalysisVersion < 220000 ) .AND. 
               ( (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:HPWH_NEEARated > 0.5 )) .OR.
                 (IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .AND. IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IsCentralHPWH > 0 )==0) ) ) .OR.
             LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
         else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
         then  if (IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ))
               then  "$tDbO"
               else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) > 0)
               then  if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) == ComponentType( "Zone" ) .OR.
                         LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) == ComponentType( "OtherZone" ))
                     then  if (IfValidAnd( SourceDHWHeater:ASHPTSrcZone:Type < 10 ))
                           then  "70"
                           else  "($tDbO + 70) / 2"  endif
                     else  "($tDbO + 70) / 2"  endif
               else  "$tDbO"  endif endif
         else   "$tDbO"  endif endif  }

   "Set cseDHWHEATER:whUAMult"  ; SAC 10/18/17
      cseDHWHEATER:whUAMult  = {
         if (LocalStatus( SourceDHWHeater:StandbyLossMult ) < 1 .OR. IfValidAnd( SourceDHWHeater:StandbyLossMult = 1 )) then  UNDEFINED
         else if ((SourceDHWHeater:HeaterElementType == 5 .OR. (SourceDHWHeater:HeaterElementType == 0 .AND. SourceDHWHeater:ShowTankLocation > 0.5)) .AND.
                  Proj:EnergyCodeYearNum >= 2019)
         then  SourceDHWHeater:StandbyLossMult
         else  UNDEFINED  endif endif  }

   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  = {
         if (Proj:EnergyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 2/28/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)

   "Set cseDHWHEATER:alter_whMult_x to facilitate autosizing of elec central DHW heater"     cseDHWHEATER:alter_whMult_x  =      ; SAC 12/4/19
      {  if (IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. IfValidAnd( Proj:AnalysisVersion > 190101 ) .AND.
	          IfValidAnd( SourceDHWSys:DrawMaxNumHrs > 0 ) .AND. IfValidAnd( SourceDHWSys:LoadMaxNumHrs > 0 ))
	      then  Format( "NumCntrlWHtrs( %c%s%c)", 34, Parent( Name ), 34 )
	      else  UNDEFINED  endif  }
; SAC 12/31/19 - remove whVol alter (tic #862)
;   "Set cseDHWHEATER:alter_whVol_x to facilitate autosizing of elec central DHW heater"      cseDHWHEATER:alter_whVol_x  = 
;      {  if (LocalStatus( alter_whMult_x ) > 0)
;	      then  Format( "max( 80, @DHWSYS[ %c%s%c].drawMax / NumCntrlWHtrs( %c%s%c))", 34, Parent( Name ), 34,  34, Parent( Name ), 34 )
;	      else  UNDEFINED  endif  }

; LH - 170708 Debug Message - disable prior to release
; "Post Message Regarding Simulation Inputs" cseDHWHeater:Action = {
;   switch( SourceDHWHeater:HeaterType )
;   case  10 :  MessageBox( "Consumer Instantaneous (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whEF = '%s'
;                            whEff = '%s'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whEF, whEff )
;   case  12 :  MessageBox( "Consumer Storage (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whVol = '%.1f'
;                            whEF = '%.2f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whVol, whEF )
;   case  14 :  MessageBox( "Residential-Duty Commercial Storage (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whVol = '%.1f'
;                            whEff = '%f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whVol, whEff )
;   case  15 :   MessageBox( "Residential-Duty Commercial Instantaneous (UEF)
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whEff = '%f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whEff )
;   default  : UNCHANGED
;   endswitch }


END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWTANK:SurfaceArea"
			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:HeaterType ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:HeaterType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:HeaterType ) ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:HeaterType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:HeaterType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceDHWHeater:ExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceDHWHeater:TankVolume >= 0 ))
																					then  SourceDHWHeater:TankVolume
																					else	UNDEFINED  endif  }
	; SAC 9/11/15 - define minimum wtInsulR as 12
	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ) > 12)
																					then	ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 )
																					else	12  endif  }
	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceDHWHeater:AmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
   ; SAC 1/6/20 - switched Uncond wtTEx_x from "$tDbO" to "($tDbO + 70) / 2" (tic #862)
	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceDHWHeater:AmbientCond =  1 )) then  "($tDbO + 70) / 2"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_HVACSys" 1 0 0 1
;*************************************************************************
   ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
	"Set cseDHWHEATER:whType"
			cseDHWHEATER:whType		= {	switch ( SourceHVACSys:DHWTankType )
														case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
														case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
														case  2 :	4	 	; "Large Instantaneous" 
														case  3 :	2  	; "Large Storage"   
													;	case  4 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 		; "Large Tankless" 
														case  5 :	3		; "Small Instantaneous" 
														case  6 :	1		; "Small Storage"     
													;	case  7 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) ; "Unfired Storage Tank" 
														case  8 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
														default :	PostError( "Unable to translate HVACSys:DHWTankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceHVACSys:DHWTankType )
													endswitch  }
	"Set cseDHWHEATER:whHeatSrc"
			cseDHWHEATER:whHeatSrc	= {	switch ( SourceHVACSys:DHWHeaterElementType )
														case  0 :	2		; "Electric Resistance"   
														case  1 :	1		; "Natural Gas"   -> Fuel
														case  2 :	1		; "Propane"       -> Fuel 
														case  3 :	3		; "Heat Pump"     -> ASHP
														case  4 :	1		; "Oil"           -> Fuel
														default :	PostError( "Unable to translate SourceHVACSys:DHWHeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceHVACSys:DHWHeaterElementType )
													endswitch  }
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
	"Set cseDHWHEATER:whFuelMtr"
			cseDHWHEATER:whFuelMtr	= {	switch ( SourceHVACSys:DHWHeaterElementType )
														case  0 :	UNDEFINED		; "Electric Resistance"   
														case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
														case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
														case  3 :	UNDEFINED		; "Heat Pump" 
														case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
														default :	UNDEFINED
													endswitch  }

	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
			cseDHWHEATER:whVol	= {	if ((IfValidAnd( SourceHVACSys:DHWTankType = 3 )==0 .AND. IfValidAnd( SourceHVACSys:DHWTankType = 6 )==0) .OR. IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 )==0) then  UNDEFINED
												else  SourceHVACSys:DHWTankVolume  endif  }

	"Set cseDHWHEATER:whEF"
			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
													(IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 )))		; SAC 8/21/15 - only for small instantaneous & storage
												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whEff"
			cseDHWHEATER:whEff	= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
													(IfValidAnd( whType = 2 ) .OR. IfValidAnd( whType = 4 )))		; SAC 8/21/15 - only for large instantaneous & storage
												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
; whHPAF removed from CSE by CB - SAC 1/22/20
;	"Set cseDHWHEATER:whHPAF"
;			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  T24RClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:ClimateZone )  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whSBL"
			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceHVACSys:DHWStandbyLossFrac > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWStandbyLossFrac < 1 ) .AND.
													 IfValidAnd( SourceHVACSys:DHWTankVolume > 0 ) .AND. IfValidAnd( whType = 2 ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
												then  SourceHVACSys:DHWStandbyLossFrac * 8.25 * SourceHVACSys:DHWTankVolume * 70  else  UNDEFINED  endif  }
									;				 IfValidAnd( SourceHVACSys:DHWInputRatingSim > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWTankType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceHVACSys:DHWInputRatingSim * SourceHVACSys:DHWStandbyLossFrac  else  UNDEFINED  endif  }

   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  = {
         if (Proj:EnergyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 2/28/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_HVACSys" 1 0 0 1
;*************************************************************************
	"Set cseDHWTANK:SurfaceArea"
			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceHVACSys:DHWExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceHVACSys:DHWIntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 ))
																					then  SourceHVACSys:DHWTankVolume
																					else	UNDEFINED  endif  }
	; SAC 9/11/15 - define minimum wtInsulR as 12
	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ) > 12)
																					then	ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 )
																					else	12  endif  }
	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond =  1 )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END

; SAC 12/31/15 - DHW input generation kludge to setup CSE DHW inputs for HVACSys-based AirToWater heat pumps
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_AWHP_OLD" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"			cseDHWHEATER:whType		= {	1	}		; "Small Storage"     
	"Set cseDHWHEATER:whHeatSrc"		cseDHWHEATER:whHeatSrc	= {	3	}		; ASHP
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"		cseDHWHEATER:whFuelMtr	= {	
;	"Set cseDHWHEATER:whVol"			cseDHWHEATER:whVol		= {	
;	"Set cseDHWHEATER:whEF"				cseDHWHEATER:whEF			= {	
;	"Set cseDHWHEATER:whEff"			cseDHWHEATER:whEff		= {	
; whHPAF removed from CSE by CB - SAC 1/22/20
;	"Set cseDHWHEATER:whHPAF"			cseDHWHEATER:whHPAF		= {	1  }
;	"Set cseDHWHEATER:whSBL"			cseDHWHEATER:whSBL		= {	
	"Set cseDHWHEATER:whLDEF"			cseDHWHEATER:whLDEF		= {	3.4  }
   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  = {
         if (Proj:EnergyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 2/28/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)
END

;************************************************************************* SAC 12/04/22
RULELIST "CSE_SimulationPrep_DHWHtr_AWHP" 1 0 0 1
;*************************************************************************
   "Set cseDHWHEATER:whType"        cseDHWHEATER:whType        = {  1  }      ; "Small Storage"     
   "Set cseDHWHEATER:whHeatSrc"     cseDHWHEATER:whHeatSrc     = {  4  }      ; "ASHPX"
   "Set cseDHWHEATER:whASHPType"    cseDHWHEATER:whASHPType    = {  "GE2012"  }
;      whMult = 1                        // Water heater multiplier
   "Set cseDHWHEATER:whFAdjElec_x"  cseDHWHEATER:whFAdjElec_x =               ; SAC 12/11/22 (tic #1318)
      {  if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 34 ) .AND.
             IfValidAnd( SourceHVACSys:ClSysMultiSpeed > 0 ))
         then  "FAWHPD"
         else  UNDEFINED  endif  }

;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;   "Set cseDHWHEATER:whFuelMtr"      cseDHWHEATER:whFuelMtr   = {   
;   "Set cseDHWHEATER:whVol"         cseDHWHEATER:whVol      = {   
;   "Set cseDHWHEATER:whEF"            cseDHWHEATER:whEF         = {   
;   "Set cseDHWHEATER:whEff"         cseDHWHEATER:whEff      = {   
; whHPAF removed from CSE by CB - SAC 1/22/20
;   "Set cseDHWHEATER:whHPAF"         cseDHWHEATER:whHPAF      = {   1  }
;   "Set cseDHWHEATER:whSBL"         cseDHWHEATER:whSBL      = {   
;   "Set cseDHWHEATER:whLDEF"         cseDHWHEATER:whLDEF      = {   3.4  }
   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  = {
         if (Proj:EnergyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 2/28/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)

   "Set cseDHWHEATER:DefaultHPWHZone"     cseDHWHEATER:DefaultHPWHZone  =     ; based on 2022+ Std design options - SAC 12/12/22 (tic #1318)
      {  if (T24RCustomStandardDesign:HPWHLoc( "StdOption", EnumString( Proj:StdDesignFuel ), "BldgType", Proj:BldgTypeTblStr, "NumPropHPWH", Proj:NumProposedHPWHs, "ClimateZone", Proj:ClimateZone ) > 0)
         then  ; override std design HPWH loc w/ largest cond zone
               MaxAllComp( Zone:CondVolume )
         else if (ComponentCount( Garage ) > 0) then  MaxAllComp( Garage:Area )
         else if (GlobalCompAssigned( Proj:DfltMFamLaundryZn ) > 0) then  Proj:DfltMFamLaundryZn
         else if (ComponentCount( CrawlSpace ) > 0) then  MaxAllComp( CrawlSpace:Area )
         else if (ComponentCount( Attic ) > 0) then  MaxAllComp( Attic:FloorArea )
         else  UNDEFINED  endif endif endif endif endif  }
   "Set cseDHWHEATER:whZone"        cseDHWHEATER:whZone  = 
      {  if (LocalCompAssigned( DefaultHPWHZone ) > 0) then  DefaultHPWHZone:CSE_ZONE
         else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whTEx_x"       cseDHWHEATER:whTEx_x  =
      {  if (LocalCompAssigned( whZone ) > 0) then  UNDEFINED
         else  "$tDbO"  endif  }
      ;   or possibly Uncond estimate: "($tDbO + 70) / 2"
   "Set cseDHWHEATER:whASHPSrcZn"   cseDHWHEATER:whASHPSrcZn   =     ; garage or outside
      {  if (LocalCompAssigned( DefaultHPWHZone ) == ComponentType( "Garage" ))
         then  DefaultHPWHZone:CSE_ZONE
         else  UNDEFINED  endif  }
   "Set cseDHWHEATER:whASHPSrcT_x"  cseDHWHEATER:whASHPSrcT_x  =
      {  if (LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
         else  "$tDbO"  endif  }
END


;*************************************************************************          ; SAC 5/28/20
RULELIST "CSE_SimulationPrep_DHWLoopHtr_DHWSys" 1 0 0 1
;*************************************************************************
   "Set cseDHWLOOPHEATER:whType"       cseDHWLOOPHEATER:whType =              ; SAC 02/19/21 (tic #1260)
      {  if (SourceDHWLoopTankSys:CHPWHLoopTankType == 2 .OR.  ; NEEA HPWH
             SourceDHWLoopTankSys:CHPWHLoopTankType == 3)      ; Com Product
         then  1     ; Small Storage
         else  6     ; BuiltUp
         endif  }
   "Set cseDHWLOOPHEATER:whHeatSrc"    cseDHWLOOPHEATER:whHeatSrc =
      {  if (SourceDHWLoopTankSys:CHPWHLoopTankType == 1)   ; Electric Resistance
         then  5     ; ResistanceX
         else  4     ; ASHPX
         endif  }

   "Set cseDHWLOOPHEATER:whResType - resistance loop tank heater controls"       cseDHWLOOPHEATER:whResType =     ; SAC 07/16/21 (tic #1275)
      {  if (SourceDHWLoopTankSys:CHPWHLoopTankType == 1)   ; Electric Resistance
         then  if (Proj:RunAbbrev == "s" .OR. Proj:RunAbbrev == "smf")
               then  switch (SourceDHWLoopTankSys:StdCHPWHLoopTankResCtrls)
                        case  1 :  "Typical"
                        case  2 :  "SwingTank"
                        default :  UNDEFINED
                     endswitch
               else  switch (SourceDHWLoopTankSys:CHPWHLoopTankResCtrls)
                        case  1 :  "Typical"
                        case  2 :  "SwingTank"
                        default :  UNDEFINED
                     endswitch
               endif
         else  UNDEFINED
         endif  }

   "Set cseDHWLOOPHEATER:whASHPType"       cseDHWLOOPHEATER:whASHPType =
      {  if (whHeatSrc != 4) then  UNDEFINED
         else  switch ( SourceDHWLoopTankSys:CHPWHLoopTankASHPType )
                  case  11: "AOSmithPHPT60"     ; "AO Smith PHPT 60"
                  case  12: "AOSmithPHPT80"     ; "AO Smith PHPT 80"
                  case  13: "AOSmithHPTU50"     ; "AO Smith HPTU 50"
                  case  14: "AOSmithHPTU66"     ; "AO Smith HPTU 66"
                  case  15: "AOSmithHPTU80"     ; "AO Smith HPTU 80"
                  case  19: "GE2014"            ; "GE2014 50"
                  case  23: "GE2014_80"         ; "GE2014 80"
                  case  21: "RheemHB50"         ; "Rheem HB 50"
                  case  22: "Stiebel220E"       ; "Stiebel 220E"
                  case  39: "RheemHBDR4550"     ; "Rheem HBDR-45-50"  - NEW SIM TYPES (tic #927) - SAC 11/28/17
                  case  40: "RheemHBDR4565"     ; "Rheem HBDR-45-65"
                  case  41: "RheemHBDR4580"     ; "Rheem HBDR-45-80"
                  case  42: "RheemHBDR2250"     ; "Rheem HBDR-22-50"
                  case  43: "RheemHBDR2265"     ; "Rheem HBDR-22-65"
                  case  44: "RheemHBDR2280"     ; "Rheem HBDR-22-80"
                  case  16: "Sanden40"          ; "Sanden 40"
                  case  17: "Sanden80"          ; "Sanden 80"
                  case  31: "AOSmithHPTU80DR"   ; "AO Smith HPTU 80 DR"  - SAC 3/28/17
                  case  32: "AOSmithSHPT50"     ; "AO Smith SHPT 50"   
                  case  33: "AOSmithSHPT66"     ; "AO Smith SHPT 66"   
                  case  34: "AOSmithSHPT80"     ; "AO Smith SHPT 80"   
                  case  72: "AOSmithCAHP120"    ; "AO Smith CAHP-120"     ; SAC 01/30/21 (tic #1260)
                  case  37: "GE2014"            ; "GE2014 50 Eff"
                  case  35: "GE2014_80"         ; GE2014_80 efficiency mode  - SAC 4/3/17
                  case  36: "GE2014_80DR"       ; GE2014_80 efficiency mode w/ DR
                  case  38: "GE2012"            ; GE2012_50   - SAC 8/10/17
                  case  48: "ColmacCxV5_SP"     ; Colmac CxV-5       ; SAC 5/27/20
                  case  49: "ColmacCxA10_SP"    ; Colmac CxA-10
                  case  50: "ColmacCxA15_SP"    ; Colmac CxA-15
                  case  45: "ColmacCxA20_SP"    ; Colmac CxA-20
                  case  51: "ColmacCxA25_SP"    ; Colmac CxA-25
                  case  52: "ColmacCxA30_SP"    ; Colmac CxA-30
                  case  53: "NyleC25A_SP"       ; Nyle C25A
                  case  54: "NyleC60A_SP"       ; Nyle C60A
                  case  55: "NyleC90A_SP"       ; Nyle C90A
                  case  56: "NyleC125A_SP"      ; Nyle C125A
                  case  46: "NyleC185A_SP"      ; Nyle C185A
                  case  47: "NyleC250A_SP"      ; Nyle C250A
                  case  67: "NyleC60A_CWP_SP"   ; Nyle C60A-CWP         ; SAC 6/23/20 - added cold wthr package presets
                  case  68: "NyleC90A_CWP_SP"   ; Nyle C90A-CWP    
                  case  69: "NyleC125A_CWP_SP"  ; Nyle C125A-CWP   
                  case  70: "NyleC185A_CWP_SP"  ; Nyle C185A-CWP   
                  case  71: "NyleC250A_CWP_SP"  ; Nyle C250A-CWP   
                  case  57: "SandenGS3"         ; Sanden GS3-45HPA-US   ; used to map to 17 - Sanden 80
                  case  58: "BWC202065"         ; SAC 6/16/20 - NEEA additions
                  case  59: "Rheem2020Prem40"
                  case  60: "Rheem2020Prem50"
                  case  61: "Rheem2020Prem65"
                  case  62: "Rheem2020Prem80"
                  case  63: "Rheem2020Build40"
                  case  64: "Rheem2020Build50"
                  case  65: "Rheem2020Build65"
                  case  66: "Rheem2020Build80"
                  case  73: "AWHSTier3Generic40"    ; NEEA generic tier 3 options - SAC 06/17/21
                  case  74: "AWHSTier3Generic50"
                  case  75: "AWHSTier3Generic65"
                  case  76: "AWHSTier3Generic80"
                  case  77: "RheemPlugInShared40"     ; SAC 11/04/22
                  case  78: "RheemPlugInShared50"
                  case  79: "RheemPlugInShared65"
                  case  80: "RheemPlugInShared80"
                  case  81: "RheemPlugInDedicated40"
                  case  82: "RheemPlugInDedicated50"
                  case  91: "Scalable_SP"    ; 5kW    ; SAC 06/22/21
                  case  92: "Scalable_SP"    ; 11kW
                  case  93: "Scalable_SP"    ; 20kW
                  case  94: "Scalable_SP"    ; 26kW
                  case  95: "Scalable_SP"    ; 40kW
                  case  96: "Scalable_SP"    ; 45kW
                  case  99: "WorstCaseMedium"   ; "Worst Case Medium"
                  default : UNDEFINED
               endswitch  endif  }

   "Set cseDHWLOOPHEATER:whEF"         cseDHWLOOPHEATER:whEF =
      {  if (whType == 1 .AND. whHeatSrc == 5)     ; Small Storge / ResistanceX
         then  0.97  else  UNDEFINED  endif  }
   "Set cseDHWLOOPHEATER:whMult"       cseDHWLOOPHEATER:whMult       = {  SourceDHWLoopTankSys:CHPWHLoopTankCompCnt  }

   ; prevent output of whVol OR whTankCount for NEEA HPWHs - SAC 09/04/20
   "Set cseDHWLOOPHEATER:whVol"        cseDHWLOOPHEATER:whVol        =
      {  if (SourceDHWLoopTankSys:CHPWHLoopTankType == 2 .OR.
             SourceDHWLoopTankSys:CHPWHLoopTankType == 3) then  UNDEFINED
         else  SourceDHWLoopTankSys:CHPWHLoopTankVol     / SourceDHWLoopTankSys:CHPWHLoopTankCompCnt
         endif  }
   "Set cseDHWLOOPHEATER:whTankCount"  cseDHWLOOPHEATER:whTankCount  =
      {  if (SourceDHWLoopTankSys:CHPWHLoopTankType == 2 .OR.
             SourceDHWLoopTankSys:CHPWHLoopTankType == 3) then  UNDEFINED
         else  ValidOr( SourceDHWLoopTankSys:CHPWHLoopTankTankCnt, 1 ) / SourceDHWLoopTankSys:CHPWHLoopTankCompCnt
         endif  }
   "Set cseDHWLOOPHEATER:whInsulR"     cseDHWLOOPHEATER:whInsulR     =
      {  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankRVal > 0 )==0 .OR.
             SourceDHWLoopTankSys:CHPWHLoopTankType == 2 .OR.
             SourceDHWLoopTankSys:CHPWHLoopTankType == 3) then  UNDEFINED
         else            SourceDHWLoopTankSys:CHPWHLoopTankRVal    endif  }

	"Set cseDHWLOOPHEATER:whHeatingCap - wtr htr compressor output"   cseDHWLOOPHEATER:whHeatingCap  =       ; SAC 06/24/21
      {  if (whHeatSrc != 4) then  UNDEFINED
         else  switch ( SourceDHWLoopTankSys:CHPWHLoopTankASHPType )
                  case  91:   5 * 3412    ;  5kW
                  case  92:  11 * 3412    ; 11kW
                  case  93:  20 * 3412    ; 20kW
                  case  94:  26 * 3412    ; 26kW
                  case  95:  40 * 3412    ; 40kW
                  case  96:  45 * 3412    ; 45kW
                  default : UNDEFINED
               endswitch  endif  }

   ; SAC 5/28/20 - from today's DHW dev team call   ; SAC 6/1/20 - revised to prevent for BuiltUp ASHPX   ; min whVol - SAC 09/04/20
   ; reference CHPWHLoopTankResHtPwr - SAC 07/03/21 (tic #1275)
   ; new default based on NumAssignedDUFracs - SAC 07/16/21 (tic #1275)
   "Set cseDHWLOOPHEATER:whResHtPwr"   cseDHWLOOPHEATER:whResHtPwr   =     ; zero-out whResHtPwr & specify only whResHtPwr2 for whResType = SwingTank - SAC 07/16/21 (tic #1275)
      {  if (whType == 6 .AND. whHeatSrc == 4) then  UNDEFINED   ; BuiltUp / ASHPX
         else if (IfValidAnd( whResType = "SwingTank" )) then  UNDEFINED
         else if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankResHtPwr > 0 ))
         then  SourceDHWLoopTankSys:CHPWHLoopTankResHtPwr
         else if (IfValidAnd( SourceDHWLoopTankSys:NumAssignedDUFracs > 0 ))
         then  1.75 * 100 * SourceDHWLoopTankSys:NumAssignedDUFracs
         else if (IfValidAnd( whVol >= 0.001 )==0) then  UNDEFINED
         else  1000 * whVol / 10  endif endif endif endif endif  }
   "Set cseDHWLOOPHEATER:whResHtPwr2"  cseDHWLOOPHEATER:whResHtPwr2  =
      {  if (whType == 6 .AND. whHeatSrc == 4) then  UNDEFINED   ; BuiltUp / ASHPX
         else if (IfValidAnd( whResType = "SwingTank" ) .AND.
                  LocalStatus( whResHtPwr ) < 1)
         then  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankResHtPwr > 0 ))
               then  SourceDHWLoopTankSys:CHPWHLoopTankResHtPwr
               else if (IfValidAnd( SourceDHWLoopTankSys:NumAssignedDUFracs > 0 ))
               then  1.75 * 100 * SourceDHWLoopTankSys:NumAssignedDUFracs
               else  UNDEFINED  endif endif
         else  whResHtPwr  endif endif  }

   ; SAC 11/18/19
   ; SAC 7/1/20 - fixed bug where compressor, not loop tank, location used for loop tank heater
   ; updates for large std design central HPWHs - SAC 07/10/21
   "Set cseDHWLOOPHEATER:whZone"       cseDHWLOOPHEATER:whZone       =
      {  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankLoc = 1 ) .OR.
             LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone ) < 1 .OR.
             IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
         else if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone:CSE_ZONE ) < 1) then  UNDEFINED
         else   SourceDHWLoopTankSys:CHPWHLoopTankZone:CSE_ZONE
         endif endif  }
   ; SAC 1/4/20 - added distinction between TankOutside ($tDbO) & zone unassigned (uncond => ($tDbO + 70) / 2) (tic #862)
   ; SAC 7/1/20 - fixed bug where compressor, not loop tank, location used for loop tank heater
   "Set cseDHWLOOPHEATER:whTEx_x"      cseDHWLOOPHEATER:whTEx_x      =
      {  if (LocalCompAssigned( whZone ) > 0) then  UNDEFINED
         else if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankLoc = 1 )) then  "$tDbO"
         else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
         then  if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone ) > 0)
               then  if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone ) == ComponentType( "Zone" ) .OR.
                         LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone ) == ComponentType( "OtherZone" ))
                     then  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankZone:Type < 10 ))
                           then  "70"
                           else  "($tDbO + 70) / 2"  endif
                     else  "($tDbO + 70) / 2"  endif
               else  "$tDbO"  endif
         else   "($tDbO + 70) / 2"  endif endif endif  }

   ; SAC 7/1/20 - fixed bug where compressor, not loop tank, air source used for loop tank heater
   ; prevent output of whASHPSrc* for CHPWHLoopTankType undefined or Resistance - SAC 07/11/21 (tic #1275)
   "Set cseDHWLOOPHEATER:whASHPSrcZn"  cseDHWLOOPHEATER:whASHPSrcZn  =        ; SAC 6/3/20
      {  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankType > 1 )==0 .OR.
             IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirLoc = 1 ) .OR.
             LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone ) < 1 .OR.
             IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
         else if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone:CSE_ZONE ) < 1) then  UNDEFINED
         else   SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone:CSE_ZONE
         endif endif  }
   ; SAC 7/1/20 - fixed bug where compressor, not loop tank, air source used for loop tank heater
   "Set cseDHWLOOPHEATER:whASHPSrcT_x" cseDHWLOOPHEATER:whASHPSrcT_x =        ; SAC 6/3/20
      {  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankType > 1 )==0 .OR.
             LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
         else if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirLoc = 1 )) then  "$tDbO"
         else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
         then  if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone ) > 0)
               then  if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone ) == ComponentType( "Zone" ) .OR.
                         LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone ) == ComponentType( "OtherZone" ))
                     then  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone:Type < 10 ))
                           then  "70"
                           else  "($tDbO + 70) / 2"  endif
                     else  "($tDbO + 70) / 2"  endif
               else  "$tDbO"  endif
         else   "($tDbO + 70) / 2"  endif endif endif  }

   "Set cseDHWLOOPHEATER:whXBUEndUse"  cseDHWLOOPHEATER:whXBUEndUse      = {   "User2"  }
END
;*************************************************************************          ; SAC 11/14/19
RULELIST "CSE_SimulationPrep_DHWLoopHtr_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWLOOPHEATER:whType"
			cseDHWLOOPHEATER:whType		= {	1  }   ; Small Storage
	"Set cseDHWLOOPHEATER:whHeatSrc"
			cseDHWLOOPHEATER:whHeatSrc	= {	5	}   ; ResistanceX

	"Set cseDHWLOOPHEATER:whVol"   cseDHWLOOPHEATER:whVol	= {	SourceDHWLoopTankHeater:whVol  }
	"Set cseDHWLOOPHEATER:whEF"  cseDHWLOOPHEATER:whEF		= {	SourceDHWLoopTankHeater:whEF   }
   ; added min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
	"Set cseDHWLOOPHEATER:whResHtPwr"   cseDHWLOOPHEATER:whResHtPwr	=
      {	if (IfValidAnd( SourceDHWLoopTankHeater:whResHtPwr >= 0.1 )) then  SourceDHWLoopTankHeater:whResHtPwr  else  UNDEFINED  endif   }

   ; SAC 11/18/19
   ; updates for large std design central HPWHs - SAC 07/10/21
	"Set cseDHWLOOPHEATER:whZone"	      cseDHWLOOPHEATER:whZone		= {	if (IfValidAnd( SourceDHWLoopTankHeater:TankOutside > 0 ) .OR.
	                                                                         LocalCompAssigned( SourceDHWLoopTankHeater:TankZone ) < 1 .OR.
                                                                            IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
																						      else if (LocalCompAssigned( SourceDHWLoopTankHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
																						      else	SourceDHWLoopTankHeater:TankZone:CSE_ZONE
																						      endif endif  }
	; SAC 1/4/20 - added distinction between TankOutside ($tDbO) & zone unassigned (uncond => ($tDbO + 70) / 2) (tic #862)
	"Set cseDHWLOOPHEATER:whTEx_x"		cseDHWLOOPHEATER:whTEx_x	= {	if (LocalCompAssigned( whZone ) > 0) then  UNDEFINED
      	                                                               else if (IfValidAnd( SourceDHWLoopTankHeater:TankOutside > 0 )) then  "$tDbO"
                                                                        else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
                                                                        then  if (LocalCompAssigned( SourceDHWLoopTankHeater:TankZone ) > 0)
                                                                              then  if (LocalCompAssigned( SourceDHWLoopTankHeater:TankZone ) == ComponentType( "Zone" ) .OR.
                                                                                        LocalCompAssigned( SourceDHWLoopTankHeater:TankZone ) == ComponentType( "OtherZone" ))
                                                                                    then  if (IfValidAnd( SourceDHWLoopTankHeater:TankZone:Type < 10 ))
                                                                                          then  "70"
                                                                                          else  "($tDbO + 70) / 2"  endif
                                                                                    else  "($tDbO + 70) / 2"  endif
                                                                              else  "$tDbO"  endif
																						      else	"($tDbO + 70) / 2"  endif endif endif  }

	"Set cseDHWLOOPHEATER:whXBUEndUse"  cseDHWLOOPHEATER:whXBUEndUse		= {	"User2"  }
END
;*************************************************************************    ; SAC 10/24/19 - added writing of DHWLOOPHEATER for 'new' CSE central electric system model
RULELIST "CSE_SimulationPrep_DHWLoopHtr_DHWHtr___OLD" 1 0 0 1                 ;   --- UNUSED ---
;*************************************************************************
   ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
	"Set cseDHWLOOPHEATER:whType"
			cseDHWLOOPHEATER:whType		= {	if (SourceDHWHeater:HeaterElementType == 5) then  1	; "Heat Pump (2016)" -> "Small Storage"
													else	switch ( SourceDHWHeater:HeaterType )
																case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
																case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
																case  2 :	4	 	; "Large Instantaneous" 
																case  3 :	2  	; "Large Storage"   
															;	case  4 :	PostError( "Unable to translate DHWHeater:TankType = 'Large Tankless' (4) to cseDHWLOOPHEATER:whType" ) 			; "Large Tankless" 
																case  5 :	3		; "Small Instantaneous" 
																case  6 :	1		; "Small Storage"     
																case  9 :	5	 	; "UEF-rated Instantaneous" 
															;	case  7 :	PostError( "Unable to translate DHWHeater:TankType = 'Unfired Storage Tank' (7) to cseDHWLOOPHEATER:whType" ) 	; "Unfired Storage Tank" 
																case  8 :	PostError( "Unable to translate DHWHeater:HeaterType = 'Electric Mini Tank' (8) to cseDHWLOOPHEATER:whType" ) 	; "Electric Mini Tank" 
                                case 10 : 3;  "Consumer Instantaneous (UEF)"   ->   SmallInstantaneous
                                case 11 : 4;  "Commercial Instantaneous (TE)   ->   LargeInstantaneous
                                case 12 : 1;  "Consumer Storage (UEF)"   ->   SmallStorage
                                case 13 : 2;  "Commercial Storage (TE & SBL)   ->   Large Storage
                                case 14 : 2;  "Residential-Duty Commercial Storage (UEF)"   ->   LargeStorage
                                case 15 : 4;  Residential-Duty Commercial Instantaneous (UEF)   ->   LargeInstantaneous
																default :	PostError( "Unable to translate DHWHeater:HeaterType = 'unrecognized' (%g) to cseDHWLOOPHEATER:whType", SourceDHWHeater:HeaterType )
															endswitch  endif  }

      ; UEF -> whType = INSTANTANEOUSUEF (5)
	"Set cseDHWLOOPHEATER:whHeatSrc"
			cseDHWLOOPHEATER:whHeatSrc	= {	switch ( SourceDHWHeater:HeaterElementType )
														case  0 :	if (SourceDHWHeater:ShowTankLocation > 0.5)
																		then  5		; "Electric Resistance"  -> ResistanceX - switched from Res - SAC 4/14/16
																		else  2		; "Resistance"
																		endif
														case  1 :	1		; "Natural Gas"          -> Fuel
														case  2 :	1		; "Propane"              -> Fuel 
														case  3 :	3		; "Heat Pump"            -> ASHP
														case  4 :	1		; "Oil"                  -> Fuel
														case  5 :	4		; "Heat Pump (2016)"     -> ASHPX		; SAC 3/19/16
														default :	PostError( "Unable to translate DHWHeater:HeaterElementType = 'unrecognized' (%g) to cseDHWLOOPHEATER:whHeatSrc", SourceDHWHeater:HeaterElementType )
													endswitch  }
      ; UEF -> whHeatSrc = Fuel (1)  (required when whType = INSTANTANEOUSUEF (5))

	"Set cseDHWLOOPHEATER:whVol"   cseDHWLOOPHEATER:whVol	= {	                           ; SAC 9/10/15
    if (IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. 
                    SourceDHWHeater:HeaterElementType == 5 .AND. 
                    SourceDHWHeater:HPWH_NEEARated < 0.5) 
   then  SourceDHWHeater:TankVolume                                            ; Heat Pump WH including UEF rated
   else if ( ( IfValidAnd( SourceDHWHeater:HeaterType = 3 ) == 0 .AND.           ; Not Large Storage AND
               IfValidAnd( SourceDHWHeater:HeaterType = 6 ) == 0 .AND.           ; Not Consumer Storage (UEF) 
               IfValidAnd( SourceDHWHeater:HeaterType = 12 ) == 0 .AND.          ; Not Small Storage
               IfValidAnd( SourceDHWHeater:HeaterType = 13 ) == 0 .AND.          ; Not Commercial Storage
               IfValidAnd( SourceDHWHeater:HeaterType = 14 ) == 0 ) .OR.         ; Not Residential-Duty Commercial Storage (UEF)
		 				IfValidAnd( SourceDHWHeater:TankVolume >= 0 )== 0 .OR.             ; No Tank Vol Defined
             SourceDHWHeater:HeaterElementType == 5 )                           ; NEAA Rated HP
   then  UNDEFINED 
	 else  SourceDHWHeater:TankVolume  
   endif endif  }

	"Set cseDHWLOOPHEATER:whEF"  cseDHWLOOPHEATER:whEF		= {	
    if ( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) .AND. 
        SourceDHWHeater:HeaterElementType == 5 )                               ; LH 170717 - UEF Rated Heat Pump Water Heater
    then if( SourceDHWHeater:IsUEF .AND. 
             IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
      then SourceDHWHeater:UEFModelCalcEF                                     
      else if( SourceDHWHeater:HPWH_NEEARated < 0.5 )                          ; LH 170717 - EF Rated Heat Pump Water Heater
      then SourceDHWHeater:EnergyFactor                                        
      else UNDEFINED
      endif endif
    else if ( SourceDHWHeater:HeaterElementType != 5 .AND. 
						( IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 ) ) )       ; SAC 8/21/15 - only for small instantaneous & storage		
    then if( IfValidAnd( SourceDHWHeater:HeaterType = 10 )  .AND.                ; LH 170717 - Consumer Storage (UEF)
             IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )                ; LH 170717 - Consumer Instantaneous (UEF) - RE translated to whEF
      then if( SourceDHWHeater:HeaterElementType = 1 )
        then 0.9734*SourceDHWHeater:UEFModelCalcRE + 0.01835                   ; LH 170718 - Gas RE to EF Eqn provided by Jim Lutz and CEC
        else SourceDHWHeater:UEFModelCalcRE                                    ; LH 170718 - Electric RE to EF equivalence provided by Jim Lutz and CEC
        endif
      else if( IfValidAnd( SourceDHWHeater:HeaterType = 12 ) .AND.               ; LH 170717 - Consumer Storage (UEF)
               IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
      then SourceDHWHeater:UEFModelCalcEF                                      
      else if( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) )
      then  SourceDHWHeater:EnergyFactor  
      else UNDEFINED
      endif endif endif
    else  UNDEFINED  
    endif endif  }

	"Set cseDHWLOOPHEATER:whUEF"      cseDHWLOOPHEATER:whUEF  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ))
         then  SourceDHWHeater:EnergyFactor  else  UNDEFINED  endif  }
         ; UEF -> whHeatSrc = Fuel  (required when whType = INSTANTANEOUSUEF (5))

	"Set cseDHWLOOPHEATER:whEff" cseDHWLOOPHEATER:whEff	= {	
    if ( SourceDHWHeater:HeaterElementType != 5 .AND. 
				 ( IfValidAnd( whType = 2 ) .OR.                                       ; SAC 8/21/15 - only for boiler & large instantaneous & storage
           IfValidAnd( whType = 4 ) ) )		                                     
    then if( IfValidAnd( SourceDHWHeater:HeaterType = 14 ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)   
             IfValidAnd( SourceDHWHeater:RecovEff > 0 ) )
      then SourceDHWHeater:RecovEff/100                                       
      else if( IfValidAnd( SourceDHWHeater:HeaterType = 15 ) .AND.               ; LH 170717 - Residential-Duty Commercial Instantaneous (UEF)
               IfValidAnd( SourceDHWHeater:UEFModelCalcTE > 0 ) )
      then SourceDHWHeater:UEFModelCalcTE                                     
      else if( IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) )                ; LH 170718 - Commercial Instantaneous (TE) and Commercial Storage (TE & SBL) covered under this cat
      then SourceDHWHeater:EnergyFactor
      else UNDEFINED
      endif endif endif

		else if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:RecovEff > 0 ))
		then  SourceDHWHeater:RecovEff / 100
		else  UNDEFINED  
    endif endif }
; Code Snippet for rule above:
;    else if( IfValidAnd( whType = 3 ) .AND. 
;             IfValidAnd( SourceDHWHeater:HeaterType = 10 ) .AND.                 LH 170718 - Consumer Instantaneous (UEF)
;             IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )
;    then SourceDHWHeater:UEFModelCalcRE  


   ; SAC 5/25/17 - UEF-rated Instantaneous properties
   ; LH 170717 - Not modified for 2016 UEF Rated Mods - relates to new whType = 5
   "Set cseDHWLOOPHEATER:whRatedFlow"      cseDHWLOOPHEATER:whRatedFlow   = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:RatedFlow > 0 ))
         then  SourceDHWHeater:RatedFlow  else  UNDEFINED  endif  }
   "Set cseDHWLOOPHEATER:whAnnualFuel"     cseDHWLOOPHEATER:whAnnualFuel  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:AnnFuelUse > 0 ))
         then  SourceDHWHeater:AnnFuelUse  else  UNDEFINED  endif  }
   "Set cseDHWLOOPHEATER:whAnnualElec"     cseDHWLOOPHEATER:whAnnualElec  = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:AnnElecUse > 0 ))
         then  SourceDHWHeater:AnnElecUse  else  UNDEFINED  endif  }
   "Set cseDHWLOOPHEATER:whStbyElec"       cseDHWLOOPHEATER:whStbyElec    = {
         if (IfValidAnd( whType = 5 ) .AND. IfValidAnd( SourceDHWHeater:StandbyElec > 0 ))
         then  SourceDHWHeater:StandbyElec  else  UNDEFINED  endif  }

; whHPAF removed from CSE by CB - SAC 1/22/20
;	"Set cseDHWLOOPHEATER:whHPAF"
;			cseDHWLOOPHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  T24RClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:ClimateZone )  else  UNDEFINED  endif  }

	; SAC 11/10/15 - added logic to transmit Pilot Energy in Btuh directly into whSBL input
	"Set cseDHWLOOPHEATER:whSBL"  cseDHWLOOPHEATER:whSBL	= {	
    if( IfValidAnd( whType = 2 ) )		                                         ; SAC 8/21/15 - only for large storage		
    then if( IfValidAnd( SourceDHWHeater:HeaterType = 14 ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)            
             IfValidAnd( SourceDHWHeater:UEFModelCalcSL > 0 ) )
      then SourceDHWHeater:UEFModelCalcSL                                      
      else if( IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND.          ; LH 170718 - Commercial Storage (TE & SBL) covered under this line item
               IfValidAnd( SourceDHWHeater:StandbyLossFrac < 1 ) .AND.
				       IfValidAnd( SourceDHWHeater:TankVolume > 0 ) )
      then                                                                     ; SAC 9/8/15 - revised to be based on TankVolume
        SourceDHWHeater:StandbyLossFrac * 8.25 * SourceDHWHeater:TankVolume * 70
						; no whSBL modeled for any whType other than LargeStorage - this setting moved to whPilotPwr below
						;						else if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ))
						;						then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
						;						else  UNDEFINED  endif endif  }
			else  UNDEFINED  
      endif endif

									;				 IfValidAnd( SourceDHWHeater:InputRatingSim > 0 ) .AND. IfValidAnd( SourceDHWHeater:HeaterType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceDHWHeater:InputRatingSim * SourceDHWHeater:StandbyLossFrac  else  UNDEFINED  endif  }
    else UNDEFINED
    endif }


	"Set cseDHWLOOPHEATER:whPilotPwr" cseDHWLOOPHEATER:whPilotPwr	= {
    if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND. IfValidAnd( whHeatSrc = 1 ))
													then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
													else  UNDEFINED  endif  }

	; SAC 11/10/15 - added whParElec to model Elec Mini Tank elec use
	"Set cseDHWLOOPHEATER:whParElec"
			cseDHWLOOPHEATER:whParElec	= {	if (IfValidAnd( SourceDHWHeater:AllowElecMiniTank > 0 ) .AND. IfValidAnd( SourceDHWHeater:HasElecMiniTank > 0 ) .AND.
														 IfValidAnd( SourceDHWHeater:ElecMiniTankPower > 0 ) )
													then  SourceDHWHeater:ElecMiniTankPower  else  UNDEFINED  endif  }
	"Set cseDHWLOOPHEATER:whElecMtr"		cseDHWLOOPHEATER:whElecMtr		= {	if (IfValidAnd( whParElec > 0 )) then  Proj:CSE_ElecMETER  else  UNCHANGED  endif  }

   ; SAC 6/13/18 - updated InputRating property name to InputRatingSim to accommodate InputRating being ignored for most heater types (tic #940)
   ; increased min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
	"Set cseDHWLOOPHEATER:whResHtPwr"		cseDHWLOOPHEATER:whResHtPwr		= {	if (SourceDHWHeater:HeaterElementType != 0 .OR. SourceDHWHeater:ShowTankLocation < 1 .OR.
																								 IfValidAnd( SourceDHWHeater:InputRatingSim >= 0.1 )==0) then  UNDEFINED
																							else	SourceDHWHeater:InputRatingSim  endif  }

   ; updates for large std design central HPWHs - SAC 07/10/21
	"Set cseDHWLOOPHEATER:whZone"			cseDHWLOOPHEATER:whZone		= {	if (SourceDHWHeater:ShowTankLocation < 1 .OR.
																						   		 IfValidAnd( SourceDHWHeater:TankOutside > 0 ) .OR.
																						   		 LocalCompAssigned( SourceDHWHeater:TankZone ) < 1 .OR.
                                                                            IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
																						   	else if (LocalCompAssigned( SourceDHWHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
																						   	else	SourceDHWHeater:TankZone:CSE_ZONE  endif endif  }
	"Set cseDHWLOOPHEATER:whTEx_x"		cseDHWLOOPHEATER:whTEx_x	= {	if (SourceDHWHeater:ShowTankLocation < 1 .OR. 
																							   	 LocalCompAssigned( whZone ) > 0) then  UNDEFINED
                                                                        else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
                                                                        then  if (IfValidAnd( SourceDHWHeater:TankOutside > 0 )) then  "$tDbO"
                                                                              else if (LocalCompAssigned( SourceDHWHeater:TankZone ) > 0)
                                                                              then  if (LocalCompAssigned( SourceDHWHeater:TankZone ) == ComponentType( "Zone" ) .OR.
                                                                                        LocalCompAssigned( SourceDHWHeater:TankZone ) == ComponentType( "OtherZone" ))
                                                                                    then  if (IfValidAnd( SourceDHWHeater:TankZone:Type < 10 ))
                                                                                          then  "70"
                                                                                          else  "($tDbO + 70) / 2"  endif
                                                                                    else  "($tDbO + 70) / 2"  endif
                                                                              else  "$tDbO"  endif endif
																							   else	"$tDbO"  endif endif  }
	"Set cseDHWLOOPHEATER:whASHPSrcZn"	cseDHWLOOPHEATER:whASHPSrcZn	= {	if (SourceDHWHeater:HeaterElementType != 5 .OR.
																					   			 (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. SourceDHWHeater:HPWH_NEEARated > 0.5) .OR.
																					   			 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																					   			 IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ) .OR.
																					   			 LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) < 1 .OR.
                                                                            IfValidAnd( IsStdLargeCHPWH > 0 )) then  UNDEFINED
																					   		else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone:CSE_ZONE ) < 1) then  UNDEFINED
																					   		else	SourceDHWHeater:ASHPTSrcZone:CSE_ZONE  endif endif  }
	"Set cseDHWLOOPHEATER:whASHPSrcT_x"	cseDHWLOOPHEATER:whASHPSrcT_x	= {	if (SourceDHWHeater:HeaterElementType != 5 .OR.
																					   			 (IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .AND. SourceDHWHeater:HPWH_NEEARated > 0.5) .OR. 
																					   			 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																					   			 LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
                                                                        else if (IfValidAnd( IsStdLargeCHPWH > 0 ))
                                                                        then  if (IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 )) then  "$tDbO"
                                                                              else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) > 0)
                                                                              then  if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) == ComponentType( "Zone" ) .OR.
                                                                                        LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) == ComponentType( "OtherZone" ))
                                                                                    then  if (IfValidAnd( SourceDHWHeater:ASHPTSrcZone:Type < 10 ))
                                                                                          then  "70"
                                                                                          else  "($tDbO + 70) / 2"  endif
                                                                                    else  "($tDbO + 70) / 2"  endif
                                                                              else  "$tDbO"  endif endif
																					   		else	"$tDbO"  endif endif  }

   "Set cseDHWLOOPHEATER:whUAMult"  ; SAC 10/18/17
      cseDHWLOOPHEATER:whUAMult  = {
         if (LocalStatus( SourceDHWHeater:StandbyLossMult ) < 1 .OR. IfValidAnd( SourceDHWHeater:StandbyLossMult = 1 )) then  UNDEFINED
         else if ((SourceDHWHeater:HeaterElementType == 5 .OR. (SourceDHWHeater:HeaterElementType == 0 .AND. SourceDHWHeater:ShowTankLocation > 0.5)) .AND.
                  Proj:EnergyCodeYearNum >= 2019)
         then  SourceDHWHeater:StandbyLossMult
         else  UNDEFINED  endif endif  }

   "Set cseDHWLOOPHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWLOOPHEATER:whXBUEndUse  = {
         if (Proj:EnergyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 2/28/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)

END
;*************************************************************************


; SAC 10/21/15 - added DHWLOOP
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoop" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOP for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   "Set cseDHWLOOP:wlMult"     cseDHWLOOP:wlMult    = {
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  1
         else if (IfValidAnd( SourceDHWSys:NRecircLoops >= 1 ) .AND.
                  IfValidAnd( SourceDHWSys:DisplayNumLoops > 0 ))
         then  SourceDHWSys:NRecircLoops
         else  UNDEFINED  endif endif  }
   ; SAC 10/24/19 - modified logic for 'new' CSE central electric system model
   "Set cseDHWLOOP:wlFlow"     cseDHWLOOP:wlFlow    = {
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  0
         else if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ) .AND.
                  IfValidAnd( SourceDHWSys:NumAssignedDUFracs > 0 ))
         then  0.17 * SourceDHWSys:NumAssignedDUFracs
         else  6  endif endif  }
   "Set cseDHWLOOP:wlFUA"      cseDHWLOOP:wlFUA     = {  2.0  }

   ; based on Res ACm table B-3
   "Set cseDHWLOOP:wlTIn1"     cseDHWLOOP:wlTIn1    = {
         if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
         else if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 )) then  UNDEFINED    ; SAC 11/14/19 - prevent output for NewCentralElecModel
         else  switch ( SourceDHWSys:MFamDistType )
                     case       0 :  130      ; "Multi-family: No loops or recirc pump"
                     case    5056 :  130      ; "No Control"
                     case    6336 :  130      ; "Multi-family: Recirculation demand control"
                     case 8393664 :  130      ; "No Control with HERS verification"
                     case 8394944 :  130      ; "Demand Control with HERS verification"
                     default      :  UNDEFINED      ; others set via expression below
               endswitch  endif endif  }
   "Set cseDHWLOOP:wlTIn1_x"   cseDHWLOOP:wlTIn1_x  = {
         if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
         else if (SourceDHWSys:MFamDistType ==    6592 ||   ; "Temperature modulation"
                  SourceDHWSys:MFamDistType == 8395200 )    ; "Temperature modulation with HERS verification"
         then  "hourval( 120, 120, 120, 120, 120, 125, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 125)"
         else if (SourceDHWSys:MFamDistType ==    6848 ||   ; "Temperature modulation & monitoring"
                  SourceDHWSys:MFamDistType == 8395456 )    ; "Temperature modulation & monitoring with HERS verification"
         then  "hourval( 115, 115, 115, 115, 115, 120, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 120)"
         else  UNDEFINED  endif endif endif  }

   ; based on Res ACm table B-3
   "Set cseDHWLOOP:wlRunF"     cseDHWLOOP:wlRunF    = {
         if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
         else  switch ( SourceDHWSys:MFamDistType )
                  case    6336 :  0.2      ; "Multi-family: Recirculation demand control"
                  case 8394944 :  0.2      ; "Demand Control with HERS verification"
                  default      :  1.0      ; all others
               endswitch  endif  }

   ; SAC 10/28/15 - added DHWLOOPPUMP creation
   "Create Child cseDHWLOOPPUMP"          cseDHWLOOP:ChildcseDHWLOOPPUMP            =     ; SAC 2/11/20 - added logic to trigger creation for either old and new Pump inputs (tic #862)
      {  if (IfValidAnd( SourceDHWSys:MFamDistType  < 1 ) .OR.
             ( IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ) .AND.
               IfValidAnd( SourceDHWSys:RecircPumpPwr > 0 )==0 ) .OR.
             ( IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 )==0 .AND.
               ( IfValidAnd( SourceDHWSys:RecircPumpHP  > 0 )==0 .OR.
                 IfValidAnd( SourceDHWSys:RecircPumpEff > 0 )==0 ) )) then  UNCHANGED
         else   CreateComp( cseDHWLOOPPUMP, "dhwlppmp-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPPUMP:wlpMult"      cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpMult    = {
         UNDEFINED  }
   "Set ChildcseDHWLOOPPUMP:wlpPwr"       cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpPwr     =     ; SAC 10/24/19 - use RecircPumpPwr for 'new' CSE central electric system model
      {  if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ))
         then  SourceDHWSys:RecircPumpPwr
         else  746 * SourceDHWSys:RecircPumpHP / SourceDHWSys:RecircPumpEff
         endif  }
   "Set ChildcseDHWLOOPPUMP:wlpElecMtr"   cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpElecMtr = {
         Proj:CSE_ElecMETER  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
   "Create Child cseDHWLOOPSEG-1"               cseDHWLOOP:ChildcseDHWLOOPSEGs[1]      = {   
         CreateComp( cseDHWLOOPSEG, "dhwlpseg1-" + substr( SourceDHWSys:Name, 0, 44 ) )  }
   "Set ChildcseDHWLOOPSEGs[1]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[1]:SegmentIndex  = {  1  }
   "Create Child cseDHWLOOPSEG-2"               cseDHWLOOP:ChildcseDHWLOOPSEGs[2]      = {   
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg2-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[2]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[2]:SegmentIndex  = {  2  }
   "Create Child cseDHWLOOPSEG-3"               cseDHWLOOP:ChildcseDHWLOOPSEGs[3]      = {   
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg3-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[3]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[3]:SegmentIndex  = {  3  }
   "Create Child cseDHWLOOPSEG-4"               cseDHWLOOP:ChildcseDHWLOOPSEGs[4]      = {   
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg4-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[4]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[4]:SegmentIndex  = {  4  }
   "Create Child cseDHWLOOPSEG-5"               cseDHWLOOP:ChildcseDHWLOOPSEGs[5]      = {   
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg5-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[5]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[5]:SegmentIndex  = {  5  }
   "Create Child cseDHWLOOPSEG-6"               cseDHWLOOP:ChildcseDHWLOOPSEGs[6]      = {   
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg6-" + substr( SourceDHWSys:Name, 0, 44 ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[6]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[6]:SegmentIndex  = {  6  }

   ; cseDHWLOOPSEG defaulting done all at once, not called for each individual 
   "Call subordinate rulelist to setup remaining cseDHWLOOPSEG properties"
            Proj:Action      = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopSeg" )  }
END

; SAC 10/22/15 - added DHWLOOPSEG
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopSeg" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPSEG for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; SegmentIndex must already set
   "Set cseDHWLOOPSEG:wgTy"
      cseDHWLOOPSEG:wgTy = {
         if (IfValidAnd( SegmentIndex > 3 ))
         then   2      ; demand
         else   1      ; supply
         endif  }
   ; based on Res ACM method WH-LOOPSZ
   "Set cseDHWLOOPSEG:NUnitThisSeg"
      cseDHWLOOPSEG:NUnitThisSeg = {
         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. IfValidAnd( wlMult > 0 )==0)
         then  -1  ; ERROR
         else if (IfValidAnd( SegmentIndex < 4 )==0)
         then  0      ; no NUnit... for segments 4-6
         else if (IfValidAnd( SegmentIndex < 3 ))
         then   SourceDHWSys:NumDUsServed / wlMult
         else   SourceDHWSys:NumDUsServed / wlMult / 2
         endif endif endif  }
   "Set cseDHWLOOPSEG:wgSize"
      cseDHWLOOPSEG:wgSize = {
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  2.0
         else if (IfValidAnd( SegmentIndex > 3 ))
         then   ; RETURN pipe segments
               if (IfValidAnd( Proj:NumStories > 4 ))
               then   1.0
               else   0.75
               endif
         else   ; SUPPLY pipe segments
               if (IfValidAnd( NUnitThisSeg > 0 ))
               then   T24RDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdDesignBase,
                                                      "NUnit", NUnitThisSeg, "IsBranch", "No" )
               else   UNDEFINED      ; error
               endif
         endif endif  }

   ; based on Res ACM method WH-LOOPLEN
   ; SAC 8/1/16 - fixed formula for AvgFloorHeight - replaced NumStories in denominator w/ (NumStories-1)
   ; mods to ensure non-DHW ZOnes & OtherZones not included in floors served calcs - SAC 08/30/20 (MFamProto)
   "Set Proj:AvgFloorHeight"     ; SAC 9/19/19 - OtherZone (MFamProto)
      Proj:AvgFloorHeight = {
         if (MaxAll( cseZONE:znEaveZ ) <= 0 .OR. IfValidAnd( NumStories_HasDHW > 0 )==0) then  1
         else if (ComponentCount( OtherZone ) > 0)
         then  if (min( MinAll( Zone:Bottom_HasDHW ), MinAll( OtherZone:Bottom_HasDHW ) ) > -1000)
               then  ( MaxAll( cseZONE:znEaveZ ) - min( MinAll( Zone:Bottom_HasDHW ), MinAll( OtherZone:Bottom_HasDHW ) ) ) / max( NumStories_HasDHW, 1 )
               else   1      ; error
               endif
         else if (MinAll( Zone:Bottom_HasDHW ) > -1000)
         then  ( MaxAll( cseZONE:znEaveZ ) - MinAll( Zone:Bottom_HasDHW ) ) / max( NumStories_HasDHW, 1 )
         else   1      ; error
         endif endif endif  }
      ; SAC 12/5/18 - replaced logic below (which fails for single zone models) w/ above which works for any # of zones (during mods for tic #975)
      ;   if (MaxAll( cseZONE:znEaveZ ) > 0 .AND.
      ;       MinAll( cseZONE:znEaveZ ) > -1000 .AND.
      ;       IfValidAnd( NumStories > 0 ) )
      ;   then  ( MaxAll( cseZONE:znEaveZ ) - MinAll( cseZONE:znEaveZ ) ) / max( (NumStories-1), 1 )
      ;   else   1      ; error
      ;   endif  }
   "Set Zone:BottomFlrEstimate - Z-level of the lowest floor in this zone (for central DHWSys pipe lengths)" 
      Zone:BottomFlrEstimate  = {
         if (IfValidAnd( CSE_ZONE:znEaveZ > -100 ) .AND. IfValidAnd( HasDHWUse > 0 ))
         then  if (IfValidAnd( FloorHeight > 6 ))
               then  CSE_ZONE:znEaveZ - (        FloorHeight * ValidOr( NumStories, 1 ))
               else  CSE_ZONE:znEaveZ - (Proj:AvgFloorHeight * ValidOr( NumStories, 1 ))  endif
         else  999  endif  }
   "Set OtherZone:BottomFlrEstimate - Z-level of the lowest floor in this zone (for central DHWSys pipe lengths)"      ; SAC 9/19/19 - OtherZone (MFamProto)
      OtherZone:BottomFlrEstimate  = {
         if (IfValidAnd( CSE_ZONE:znEaveZ > -100 ) .AND. IfValidAnd( HasDHWUse > 0 ))
         then  if (IfValidAnd( FloorHeight > 6 ))
               then  CSE_ZONE:znEaveZ - (        FloorHeight * ValidOr( NumStories, 1 ))
               else  CSE_ZONE:znEaveZ - (Proj:AvgFloorHeight * ValidOr( NumStories, 1 ))  endif
         else  999  endif  }
   ; 8/4/16 - added rules to calculate range of floors served by each central DHWSys
   "Set DwellUnit:TopZEstimate - top Z of highest floor in parent zone (for central DHWSys pipe lengths)"
      DwellUnit:TopZEstimate[1]     = {   ParentRef( CSE_ZONE:znEaveZ )  }
   "Set DwellUnit:BottomZEstimate - bot Z of lowest floor in parent zone (for central DHWSys pipe lengths)"
      DwellUnit:BottomZEstimate[1]  = {   Zone:BottomFlrEstimate  }

   "Set DwellUnitType:TopZEstimate - top Z of highest floor in referencing DwellUnits (ctrl DHWSys piping)"
      DwellUnitType:TopZEstimate    = { MaxRevRef( DwellUnit:DwellUnitTypeRef, DwellUnit:TopZEstimate ) }
   "Set DwellUnitType:TopZEstimate[2]"     DwellUnitType:TopZEstimate[2]     = {  TopZEstimate[1]  }
   "Set DwellUnitType:TopZEstimate[3]"     DwellUnitType:TopZEstimate[3]     = {  TopZEstimate[1]  }
   "Set DwellUnitType:TopZEstimate[4]"     DwellUnitType:TopZEstimate[4]     = {  TopZEstimate[1]  }
   "Set DwellUnitType:TopZEstimate[5]"     DwellUnitType:TopZEstimate[5]     = {  TopZEstimate[1]  }
   "Set DwellUnitType:BottomZEstimate - bot Z of lowest floor in referencing DwellUnits (ctrl DHWSys piping)"
      DwellUnitType:BottomZEstimate = { MinRevRef( DwellUnit:DwellUnitTypeRef, DwellUnit:BottomZEstimate ) }
   "Set DwellUnitType:BottomZEstimate[2]"  DwellUnitType:BottomZEstimate[2]  = {  BottomZEstimate[1]  }
   "Set DwellUnitType:BottomZEstimate[3]"  DwellUnitType:BottomZEstimate[3]  = {  BottomZEstimate[1]  }
   "Set DwellUnitType:BottomZEstimate[4]"  DwellUnitType:BottomZEstimate[4]  = {  BottomZEstimate[1]  }
   "Set DwellUnitType:BottomZEstimate[5]"  DwellUnitType:BottomZEstimate[5]  = {  BottomZEstimate[1]  }

   ; SAC 8/4/16 - added to enable/improve simulation of multiple central systems serving different floors
   "Set DHWSys:FloorZRange - top minus bottom Z of all floors served by this system"      ; SAC 9/19/19 - OtherZone (MFamProto)   ; SAC 10/3/19 - fix for when OtherZOnes present but not assigned (MFamProto)
      DHWSys:FloorZRange   = {
         if (IfValidAnd( Proj:IsMultiFamily > 0.5 ))
         then  if (SumRevRef( OtherZone:ozDHWSys, OtherZone:CondFloorArea ) > 0)
               Then  max( MaxRevRef( OtherZone:ozDHWSys, OtherZone:Top_HasDHW ),
                          MaxRevRef( DwellUnitType:DHWSysRef, DwellUnitType:TopZEstimate,
                                                              DwellUnitType:NumDHWSysTypes ) ) -
                     min( MinRevRef( OtherZone:ozDHWSys, OtherZone:BottomFlrEstimate ),
                          MinRevRef( DwellUnitType:DHWSysRef, DwellUnitType:BottomZEstimate,
                                                              DwellUnitType:NumDHWSysTypes ) )
               else  MaxRevRef( DwellUnitType:DHWSysRef, DwellUnitType:TopZEstimate,
                                                         DwellUnitType:NumDHWSysTypes ) -
                     MinRevRef( DwellUnitType:DHWSysRef, DwellUnitType:BottomZEstimate,
                                                         DwellUnitType:NumDHWSysTypes )
               endif
         else  MaxAll( cseZONE:znEaveZ ) - MinAll( Zone:BottomFlrEstimate )
         endif  }

   "Set DHWSys:NumFloorsServed - # of floors served by this DHW system (used for central pipe segment sizing)"
      DHWSys:NumFloorsServed  = {         ;  Proj:NumStories  }      ; > 0
         if (IfValidAnd( FloorZRange > 0 ) .AND. IfValidAnd( Proj:AvgFloorHeight > 0 ))
         then  int( (FloorZRange / Proj:AvgFloorHeight) + 0.5 )
         else  1     ; ERROR
         endif  }
   "Set DHWSys:AvgFlrHtServed - Avg height of flrs served by this DHW sys (used for central pipe seg sizing)"
      DHWSys:AvgFlrHtServed   = {
         if (IfValidAnd( FloorZRange > 0 ) .AND. IfValidAnd( NumFloorsServed > 0 ))
         then  FloorZRange / NumFloorsServed
         else  Proj:AvgFloorHeight     ; ERROR
         endif  }

   "Set cseDHWLOOPSEG:AvgDULen"
      cseDHWLOOPSEG:AvgDULen = {
         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0) then  0      ; error
         else   sqrt( ValidOr( SourceDHWSys:FloorAreaServed[1], 0 ) / SourceDHWSys:NumDUsServed )
         endif  }
   "Set cseDHWLOOPSEG:wgLength"
      cseDHWLOOPSEG:wgLength = {
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 )) then  0
         else if (IfValidAnd( SegmentIndex = 1 ) .OR. IfValidAnd( SegmentIndex = 6 ))
         then      8 + ( SourceDHWSys:AvgFlrHtServed * ValidOr( SourceDHWSys:NumFloorsServed, 1 ) / 2 )
         else   ; segment index not 1 or 6
               if (  IfValidAnd( SourceDHWSys:NumDUsServed    >  0 )==0 .OR. 
                     IfValidAnd( SourceDHWSys:NRecircLoops    >= 1 )==0 .OR.
                     IfValidAnd( SourceDHWSys:NumFloorsServed >  0 )==0 ) then  UNDEFINED      ; error
               else   AvgDULen * SourceDHWSys:NumDUsServed /
                     (4 * SourceDHWSys:NRecircLoops * SourceDHWSys:NumFloorsServed)
               endif
         endif endif  }
   "Set cseDHWLOOPSEG:wgInsulThk"
      cseDHWLOOPSEG:wgInsulThk    = {   SourceDHWSys:LoopPipeInsulThk  }
   "Set cseDHWLOOPSEG:wgInsulK"
      cseDHWLOOPSEG:wgInsulK      = {   0.02167  }
   "Set cseDHWLOOPSEG:wgFNoDraw"
      cseDHWLOOPSEG:wgFNoDraw     = {   if (IfValidAnd( SegmentIndex > 0 )==0) then  UNDEFINED
                                        else   switch ( SegmentIndex )
                                                 case  1 :  0.2
                                                 case  2 :  0.4
                                                 case  3 :  0.6
                                                 default :  1.0
                                              endswitch  endif  }
   "Set cseDHWLOOPSEG:wgExT"
      cseDHWLOOPSEG:wgExT    = {   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
                                   else  switch ( SourceDHWSys:RecircPipeLoc[1] )
                                            case  0 :  70      ; Conditioned
                                            case  1 :  70      ; Semi-Conditioned
                                            default :  UNDEFINED
                                         endswitch  endif  }
   "Set cseDHWLOOPSEG:wgExT_x"
      cseDHWLOOPSEG:wgExT_x  = {   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
                                   else   switch ( SourceDHWSys:RecircPipeLoc[1] )
                                            case  2 :  "$TdbO"            ; Unconditioned (outdoor)
                                            case  3 :  "@Weather.tgrnd"   ; Underground (ground)
                                            default :  UNDEFINED
                                         endswitch  endif  }
   "Set cseDHWLOOPSEG:wgExH"
      cseDHWLOOPSEG:wgExH    = {   1.5  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
   ; SAC 8/1/16 - modified to create branches for loop segs #2 & 3 (rather than only #1)
   ; SAC 10/24/19 - added logic to PREVENT DHWLOOPBRANCH creation when running 'new' CSE central electric system model     ; SAC 10/30/19 - added logic to reference new Proj:SimulateCentralDHWBranches flag  ; SAC 11/06/19 - default 0->1
   "Create Child cseDHWLOOPBRANCH"
      cseDHWLOOPSEG:ChildcseDHWLOOPBRANCH = {
         if (IfValidAnd( SourceDHWSys:NewCentralElecModel > 0 ) .AND.
             IfValidAnd( Proj:SimulateCentralDHWBranches == 0 )) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:MFamDistType < 1 ) .AND. IfValidAnd( SegmentIndex = 1 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr1-" + substr( SourceDHWSys:Name, 0, 44 ) )
         else if (IfValidAnd( SegmentIndex = 2 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr2-" + substr( SourceDHWSys:Name, 0, 44 ) )
         else if (IfValidAnd( SegmentIndex = 3 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr3-" + substr( SourceDHWSys:Name, 0, 44 ) )
         else  UNDEFINED  endif endif endif endif  }
   "Call subordinate rulelist to setup remaining cseDHWLOOPBRANCH properties (all at once, not by branch)"
      Proj:Action = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopBranch" )  }
END

; SAC 10/22/15 - added DHWLOOPBRANCH
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopBranch" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPBRANCH for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; based on Res ACM method WH-BRNU
   "Set cseDHWLOOPBRANCH:NUnitThisBranch"   
      cseDHWLOOPBRANCH:NUnitThisBranch = {
         if (IfValidAnd( SourceDHWSys:NumFloorsServed > 0 )==0) then  -1  ; ERROR
         else  max( (SourceDHWSys:NumFloorsServed / 2), 1 )  endif  }
   ; based on Res ACM method WH-BRN
   ; SAC 8/1/16 - revised expression based on loop segment branch fixes - replaced NUnitThisBranch in denominator w/ ()
   "Set cseDHWLOOPBRANCH:wbMult"
      cseDHWLOOPBRANCH:wbMult = {
         if (IfValidAnd( SourceDHWSys:MFamDistType < 1 ) .AND. NUnitThisBranch > 0 .AND.
             IfValidAnd( SourceDHWSys:NumDUsServed > 0 ))
         then  SourceDHWSys:NumDUsServed /  NUnitThisBranch
         else if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. NUnitThisBranch <= 0 .OR.
             IfValidAnd( SourceDHWSys:NRecircLoops > 0 )==0) then  UNDEFINED
         else  SourceDHWSys:NumDUsServed / (NUnitThisBranch * SourceDHWSys:NRecircLoops * 2)  endif endif  }

   ; based on Res ACM method WH-BRSZ
   "Set cseDHWLOOPBRANCH:wbSize"
      cseDHWLOOPBRANCH:wbSize = {
         if (IfValidAnd( NUnitThisBranch > 0 ))
         then   T24RDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdDesignBase,
                                                "NUnit", NUnitThisBranch, "IsBranch", "Yes" )
         else   UNDEFINED      ; error
         endif  }
   ; based on Res ACM method WH-BRLEN
   "Set cseDHWLOOPBRANCH:wbLength"
      cseDHWLOOPBRANCH:wbLength = {
         4 + ( SourceDHWSys:AvgFlrHtServed * ValidOr( SourceDHWSys:NumFloorsServed, 1 ) / 2 )  }

   "Set cseDHWLOOPBRANCH:wbFlow"       cseDHWLOOPBRANCH:wbFlow       = {   2        }
   "Set cseDHWLOOPBRANCH:wbInsulThk"   cseDHWLOOPBRANCH:wbInsulThk   = {   SourceDHWSys:LoopPipeInsulThk  }
   "Set cseDHWLOOPBRANCH:wbInsulK"     cseDHWLOOPBRANCH:wbInsulK     = {   0.02167  }
   "Set cseDHWLOOPBRANCH:wbExH"        cseDHWLOOPBRANCH:wbExH        = {   1.5      }
   "Set cseDHWLOOPBRANCH:wbExT"        cseDHWLOOPBRANCH:wbExT        = {   70       }

   ;   wbFWaste is based on Res ACM method WH-BRWF
   ;      wbFWaste = Nwaste * SCHwaste * fVol
   ;      NWaste = 19.84 * exp( -0.544 * Nunit,b)               Nunit,b = Nfloor/2
   ;      SCHwaste per Table B-4
   ;      fVol = 1.4
   ;      So 
   "Set cseDHWLOOPBRANCH:wbFWaste_x"   cseDHWLOOPBRANCH:wbFWaste_x  = {   
      Format( "1.4 * 19.84 * exp( -0.544 * %g ) * hourval( 0.01, 0.02, 0.05, 0.22, 0.25, 0.22, 0.06, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01)", NUnitThisBranch )  }

END


; SAC 12/18/18 - setup cseDHWSYS for HPWH Sizing run(s) (HPWHSIZE)
;*************************************************************************
RULELIST "CSE_DHWSystem_SetupHPWHSizingRun" 1 0 0 1
   "Store cseDHWSYS:wsFuelMtr"      cseDHWSYS:StoreWSFuelMtr   = {
         if (LocalStatus( wsFuelMtr ) < 1) then  UNDEFINED
         else  wsFuelMtr  endif  }
   "Store cseDHWSYS:wsFXHwMtr"      cseDHWSYS:StoreWSFXHwMtr   = {
         if (LocalStatus( wsFXHwMtr ) < 1) then  UNDEFINED
         else  wsFXHwMtr  endif  }
   "Store cseDHWSYS:wsWHHwMtr"      cseDHWSYS:StoreWSWHHwMtr   = {
         if (LocalStatus( wsWHHwMtr ) < 1) then  UNDEFINED
         else  wsWHHwMtr  endif  }
;   "Store cseDHWSYS:wsSSF"          cseDHWSYS:StoreWSSSF       = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( wsSSF   ) < 1) then  UNDEFINED
;         else  wsSSF    endif  }
;   "Store cseDHWSYS:wsSSF_x"        cseDHWSYS:StoreWSSSF_x     = {
;         if (LocalStatus( wsSSF_x ) < 1) then  UNDEFINED
;         else  wsSSF_x  endif  }

   "Blast cseDHWSYS:wsFuelMtr (if necessary)"   cseDHWSYS:wsFuelMtr  = {
         if (LocalStatus( wsFuelMtr ) < 1 .OR.
             LocalCompAssigned( SourceDHWSys ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:NumDHWHeaters > SourceDHWSys:NumElecHeaters ))
         then  UNCHANGED
         else  UNDEFINED  endif endif  }
   "Blast cseDHWSYS:wsFXHwMtr"                  cseDHWSYS:wsFXHwMtr  = {
         if (LocalStatus( wsFXHwMtr ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsWHHwMtr"                  cseDHWSYS:wsWHHwMtr  = {
         if (LocalStatus( wsWHHwMtr ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
;   "Blast cseDHWSYS:wsSSF"                      cseDHWSYS:wsSSF      = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( wsSSF   ) < 1) then  UNCHANGED
;         else  UNDEFINED  endif  }
;   "Blast cseDHWSYS:wsSSF_x"                    cseDHWSYS:wsSSF_x    = {
;         if (LocalStatus( wsSSF_x ) < 1) then  UNCHANGED
;         else  UNDEFINED  endif  }

   "Store cseDHWSYS:wsSolarSys"     cseDHWSYS:StoreWSSolarSys  =           ; SAC 2/11/20 (tic #862)
      {  if (LocalStatus( wsSolarSys ) < 1 .OR.
             IfValidAnd( Proj:CSE_HPWHSizUseSSF > 0 )==0) then  UNDEFINED
         else  wsSolarSys  endif  }
   "Blast cseDHWSYS:wsSolarSys (if needed)"  cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Set cseDHWSYS:wsSSF"      cseDHWSYS:wsSSF  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1 .OR. IfValidAnd( SourceDHWSys:SolFracAnn > 0 )==0) then  UNCHANGED
         else  SourceDHWSys:SolFracAnn  endif  }
END
;*************************************************************************
RULELIST "CSE_DHWSystem_RestoreFollowingHPWHSizingRun" 1 0 0 1
   "Restore cseDHWSYS:wsFuelMtr"       cseDHWSYS:wsFuelMtr   = {
         if (LocalStatus( StoreWSFuelMtr ) < 1) then  UNDEFINED
         else  StoreWSFuelMtr  endif  }
   "Restore cseDHWSYS:wsFXHwMtr"       cseDHWSYS:wsFXHwMtr   = {
         if (LocalStatus( StoreWSFXHwMtr ) < 1) then  UNDEFINED
         else  StoreWSFXHwMtr  endif  }
   "Restore cseDHWSYS:wsWHHwMtr"       cseDHWSYS:wsWHHwMtr   = {
         if (LocalStatus( StoreWSWHHwMtr ) < 1) then  UNDEFINED
         else  StoreWSWHHwMtr  endif  }
;   "Restore cseDHWSYS:wsSSF"           cseDHWSYS:wsSSF       = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( StoreWSSSF   ) < 1) then  UNDEFINED
;         else  StoreWSSSF    endif  }
;   "Restore cseDHWSYS:wsSSF_x"         cseDHWSYS:wsSSF_x     = {
;         if (LocalStatus( StoreWSSSF_x ) < 1) then  UNDEFINED
;         else  StoreWSSSF_x  endif  }

   "Blast cseDHWSYS:wsSSF"             cseDHWSYS:wsSSF  =                  ; SAC 2/11/20 (tic #862)
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Restore cseDHWSYS:wsSolarSys"      cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  StoreWSSolarSys  endif  }
END
;*************************************************************************

; SAC 12/11/18 - setup cseDHWHEATER for HPWH Sizing run(s) (HPWHSIZE)
;*************************************************************************
RULELIST "CSE_DHWHeater_SetupHPWHSizingRun" 1 0 0 1
   "Store cseDHWHEATER:whZone"      cseDHWHEATER:StoreWHZone   = {
         if (LocalStatus( whZone ) < 1) then  UNDEFINED
         else  whZone  endif  }
   "Store cseDHWHEATER:whTEx_x"     cseDHWHEATER:StoreWHTEx_x  = {
         if (LocalStatus( whTEx_x ) < 1) then  UNDEFINED
         else  whTEx_x  endif  }
   "Store cseDHWHEATER:whMult"      cseDHWHEATER:StoreWHMult   = {  whMult  }

   "Set cseDHWHEATER:whTEx_x for HPWH sizing run"  cseDHWHEATER:whTEx_x  = {
         if (IfValidAnd( whZone:znModel = 3 ))   ; "CZM"
         then  "70"
         else  "$tDbO"  endif  }
   "Blast cseDHWHEATER:whZone for HPWH sizing run"    cseDHWHEATER:whZone       = {  UNDEFINED   }
   "Set cseDHWHEATER:whMult_x for HPWH sizing run"    cseDHWHEATER:whMult_x     = {  Format( "%g * HPWHSIZE", whMult )  }
   "Blast cseDHWHEATER:whMult for HPWH sizing run"    cseDHWHEATER:whMult       = {  UNDEFINED   }
;   "Set cseDHWHEATER:whXBUEndUse for HPWH sizing run" cseDHWHEATER:whXBUEndUse  = {  "User2"     }
END
;*************************************************************************
RULELIST "CSE_DHWHeater_RestoreFollowingHPWHSizingRun" 1 0 0 1
   "Restore cseDHWHEATER:whZone"      cseDHWHEATER:whZone   = {
         if (LocalStatus( StoreWHZone ) < 1) then  UNDEFINED
         else  StoreWHZone  endif  }
   "Restore cseDHWHEATER:whTEx_x"     cseDHWHEATER:whTEx_x  = {
         if (LocalStatus( StoreWHTEx_x ) < 1) then  UNDEFINED
         else  StoreWHTEx_x  endif  }

   "Blast cseDHWHEATER:whMult_x following HPWH sizing run"     cseDHWHEATER:whMult_x     = {  UNDEFINED  }
;   "Blast cseDHWHEATER:whXBUEndUse following HPWH sizing run"  cseDHWHEATER:whXBUEndUse  = {  UNDEFINED  }
   "Set cseDHWHEATER:whMult following HPWH sizing run"      cseDHWHEATER:whMult = {
         StoreWHMult * ValidOr( CentralWHMult, 1 )  }
END
;*************************************************************************

;************************************************************************* SAC 12/17/18 - rulelists for Proj-level HPWHSIZE prep and clean-up
RULELIST "CSE_Project_SetupHPWHSizingRun" 1 0 0 1
   "Create Proj:CSE_HPWHSizExport prior to performing HPWHSIZE run"
      Proj:CSE_HPWHSizExport  = {
         if (LocalCompAssigned( CSE_HPWHSizExport ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORT, "HPWH Sizing Export" )  endif  }
   "Set Proj:CSE_HPWHSizExport:exType  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exType   = {  "MTR"      }
;   "Set Proj:CSE_HPWHSizExport:exFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exFreq   = {  "Year"     }
   "Set Proj:CSE_HPWHSizExport:exFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exFreq   = {  "HOUR"     }
   "Set Proj:CSE_HPWHSizExport:exMeter (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exMeter  = {  "MtrElec"  }
;   "Set Proj:CSE_HPWHSizExport:exBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exBtuSf  = {  3413       }  ; kWh
   "Set Proj:CSE_HPWHSizExport:exBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exBtuSf  = {  1000       }  ; kBtu
	"Set Proj:CSE_HPWHSizExport:exDayBeg_x (for HPWHSIZE)"    Proj:CSE_HPWHSizExport:exDayBeg_x  = {  "Jan 1"   }
	"Set Proj:CSE_HPWHSizExport:exDayEnd_x (for HPWHSIZE)"    Proj:CSE_HPWHSizExport:exDayEnd_x  = {  "Dec 31"  }

   "Create Proj:CSE_HPWHSizReport prior to performing HPWHSIZE run"
      Proj:CSE_HPWHSizReport  = {
         if (LocalCompAssigned( CSE_HPWHSizReport ) > 0) then  UNCHANGED
         else  CreateComp( cseREPORT, "HPWH Sizing Report" )  endif  }
   "Set Proj:CSE_HPWHSizReport:rpType_x (for HPWHSIZE run)"  Proj:CSE_HPWHSizReport:rpType_x = {  "MTR"      }
   "Set Proj:CSE_HPWHSizReport:rpFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpFreq   = {  "Month"    }
   "Set Proj:CSE_HPWHSizReport:rpMeter (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpMeter  = {  "MtrElec"  }
   "Set Proj:CSE_HPWHSizReport:rpBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpBtuSf  = {  3413       }
END
;*************************************************************************
RULELIST "CSE_Project_RestoreHPWHSizingRun" 1 0 0 1
   "Blast (if present) Proj:CSE_HPWHSizExport following HPWHSIZE run"
      Proj:CSE_HPWHSizExport  = {   if (LocalCompAssigned( CSE_HPWHSizExport ) < 1) then  UNCHANGED
                                    else  DeleteComp()  endif  }
   "Blast (if present) Proj:CSE_HPWHSizReport following HPWHSIZE run"
      Proj:CSE_HPWHSizReport  = {   if (LocalCompAssigned( CSE_HPWHSizReport ) < 1) then  UNCHANGED
                                    else  DeleteComp()  endif  }
END
;*************************************************************************


;************************************************************************* SAC 1/27/20 (StdSolarSys) 
RULELIST "CSE_DHWSolarSys_SetupSolarSysSizingRun" 1 0 0 1
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult  =
            {  ValidOr( StdDHWSolarSysRef:StdDsgnCntFloat[1], 2 )  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  =
            {  ValidOr( StdDHWSolarSysRef:StdDsgnCntFloat[2], 10 )  }

   "Remove Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:swTankVol"          ; SAC 2/19/20 - remove swTankVol to ensure that CSE can autosize it (needed when varying multipliers)
           Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:swTankVol  = {  UNDEFINED  }

   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:CSEPreRunRequired"
        Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:CSEPreRunRequired  = {  1  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:CSEPreRunRequired"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:CSEPreRunRequired  = {  1  }

; no need to store/restore CSE_DHWSizingRunReqd, since run during solar sizing negates need in annual sim - SAC 07/01/21
   "Store for later restoration Proj:CSE_DHWPreRunReqd via CSE_DHWPreRunReqdsv"
      Proj:CSE_DHWPreRunReqdSv = {  CSE_DHWPreRunReqd  }
   "Toggle Proj:CSE_DHWPreRunReqd OFF"       Proj:CSE_DHWPreRunReqd  = {  0  }
   "Toggle Proj:CSE_DHWSolarPreRunReqd ON"   Proj:CSE_DHWSolarPreRunReqd  = {  1  }
END
;*************************************************************************
RULELIST "CSE_DHWSolarSys_RestoreFollowingSolarSysSizingRun" 1 0 0 1
   ; assumption - DHWSolarSys:StdDsgnSSFCalced[1-2] populated from sizing run source code
   "Set Proj:StdDHWSolarSysRef:RequiredSSF"
        Proj:StdDHWSolarSysRef:RequiredSSF  =
            {  if (Proj:ClimateZone < 10) 
               then  0.2  
               else  0.35  endif  }

   "Set Proj:StdDHWSolarSysRef:CountFlt"
        Proj:StdDHWSolarSysRef:CountFlt  =
   {  if (IfValidAnd( StdDHWSolarSysRef:StdDsgnSSFCalced[1] > 0 ) .AND.
          IfValidAnd( StdDHWSolarSysRef:StdDsgnSSFCalced[2] > 0 ))
      then  StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult +
            ( ( StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult - StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult ) *
              ( StdDHWSolarSysRef:RequiredSSF         - StdDHWSolarSysRef:StdDsgnSSFCalced[1] ) /
              ( StdDHWSolarSysRef:StdDsgnSSFCalced[2] - StdDHWSolarSysRef:StdDsgnSSFCalced[1] ) )
      else  StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  endif  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult  =
            {  ValidOr( StdDHWSolarSysRef:CountFlt, 2 )  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  =
            {  UNDEFINED  }

; no need to store/restore CSE_DHWSizingRunReqd, since run during solar sizing negates need in annual sim - SAC 07/01/21
;   "Restore original Proj:CSE_DHWSizingRunReqd (via CSE_DHWSizingRunReqdSv)"
;      Proj:CSE_DHWSizingRunReqd = {  CSE_DHWSizingRunReqdSv  }
   "Restore original Proj:CSE_DHWPreRunReqd (via CSE_DHWPreRunReqdsv)"
      Proj:CSE_DHWPreRunReqd = {  CSE_DHWPreRunReqdSv  }
   "Toggle Proj:CSE_DHWSolarPreRunReqd OFF"  Proj:CSE_DHWSolarPreRunReqd  = {  0  }

   "Delete Proj:CSE_SolarSysSizExport (and child ExportCols)"
      Proj:CSE_SolarSysSizExport  = {  DeleteComp()  }
; de-referencing the StdDHWSolarSysRef prevents us from identifiying which DHWSolarSys results to store as the official Std design - SAC 1/29/20
;   "DE-Reference Proj:StdDHWSolarSysRef"
;      Proj:StdDHWSolarSysRef  = {  UNDEFINED  }

   ; for autosized CHPWHs - post calced and stored Cap & Vol to cseDHWHEATER for subsequent (final std design?) simulation - SAC 02/01/22 (MFam)
	"Set cseDHWHEATER:whHeatingCap - autosized wtr htr compressor output"   cseDHWHEATER:whHeatingCap  = 
      {  if (IfValidAnd( CSESizingRunRequired > 0 ) .AND. IfValidAnd( AutoSzCap > 0 ) .AND.
             IfValidAnd( whHeatingCap > 0 )==0)
         then  AutoSzCap
         else  UNCHANGED  endif  }
	"Set cseDHWHEATER:whVolRunning - autosized tank vol needed in excess of htg cap to get through htg event"   cseDHWHEATER:whVolRunning  =
      {  if (IfValidAnd( CSESizingRunRequired > 0 ) .AND. IfValidAnd( AutoSzVol > 0 ) .AND.
             IfValidAnd( whVolRunning > 0 )==0)
         then  AutoSzVol
         else  UNCHANGED  endif  }

   ; for autosized CHPWHs - toggle OFF autosizing flags if calced sizes defined - SAC 07/09/21 (tic #1275)
   "blast cseDHWHEATER:CSESizingRunRequired flag if autosize results present"    cseDHWHEATER:CSESizingRunRequired =
      {  if (IfValidAnd( CSESizingRunRequired > 0 ) .AND. IfValidAnd( AutoSzCap > 0 ) .AND.
             IfValidAnd( AutoSzVol > 0 )) then  UNDEFINED
         else  UNCHANGED  endif  }
   "blast cseDHWSYS:CSESizingRunRequired flag if no children still require autosizing"    cseDHWSYS:CSESizingRunRequired =
      {  if (IfValidAnd( CSESizingRunRequired > 0 ) .AND.
             SumChildren( cseDHWHEATER:CSESizingRunRequired ) < 1) then  UNDEFINED
         else  UNCHANGED  endif  }
   "Set Proj:CSE_DHWSizingRunReqd"     Proj:CSE_DHWSizingRunReqd  = 
      {  if (SumAll( cseDHWSYS:CSESizingRunRequired ) > 0.5) then  1  else  0  endif  }
END
;*************************************************************************

;************************************************************************* SAC 1/27/20 (StdSolarSys) 
RULELIST "CSE_Project_SetupSolarSysSizingExport" 1 0 0 1
   "Setup Proj:StdDHWSolarSysRef counts for sizing run"     Proj:Action  =
      {  EvalRulelist( "CSE_DHWSolarSys_SetupSolarSysSizingRun" )  }

   "Create Proj:CSE_SolarSysSizExport to export data to CSV for use in DHWSolarSys sizing"
      Proj:CSE_SolarSysSizExport  = {
         if (LocalCompAssigned( CSE_SolarSysSizExport ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORT, "DHWSolarSys Sizing Export" )  endif  }
   "Set Proj:CSE_SolarSysSizExport:exType"   Proj:CSE_SolarSysSizExport:exType    = {  "UDT"      }
   "Set Proj:CSE_SolarSysSizExport:exFreq"   Proj:CSE_SolarSysSizExport:exFreq    = {  "YEAR"     }
   "Set Proj:CSE_SolarSysSizExport:exHeader" Proj:CSE_SolarSysSizExport:exHeader  = {  "YESIFNEW"  }
   "Set Proj:CSE_SolarSysSizExport:exFooter" Proj:CSE_SolarSysSizExport:exFooter  = {  "NO"     }

   "Create Proj:CSE_SolarSysSizExpCol[1] - timestamp"     Proj:CSE_SolarSysSizExpCol[1]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[1] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-1" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:Parent"      Proj:CSE_SolarSysSizExpCol[1]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:colhead"     Proj:CSE_SolarSysSizExpCol[1]:colhead   = {  "TimeStamp"  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:colVal_x"    Proj:CSE_SolarSysSizExpCol[1]:colVal_x  = {  "@Top.runDateTime"  }

   "Create Proj:CSE_SolarSysSizExpCol[2] - Wthr"      Proj:CSE_SolarSysSizExpCol[2]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[2] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-2" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:Parent"      Proj:CSE_SolarSysSizExpCol[2]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:colhead"     Proj:CSE_SolarSysSizExpCol[2]:colhead   = {  "Wthr"  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:colVal_x"    Proj:CSE_SolarSysSizExpCol[2]:colVal_x  = {  "@Top.wfName"  }

   "Create Proj:CSE_SolarSysSizExpCol[3] - CZ"        Proj:CSE_SolarSysSizExpCol[3]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[3] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-3" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:Parent"      Proj:CSE_SolarSysSizExpCol[3]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:colhead"     Proj:CSE_SolarSysSizExpCol[3]:colhead   = {  "CZ"  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:colVal_x"    Proj:CSE_SolarSysSizExpCol[3]:colVal_x  = {  "ClimateZone"  }


   ; exportCol colhead="SCMult" colVal=@DHWSolarCollector["dhwsc-dhwss-Solar1"].mult
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1] - SCMult" Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-4" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colhead   = {  "SCMult"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colVal_x  = {  Format( "@DHWSolarCollector[%c%s%c].mult", 34, StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:Name, 34 )  }

   ; exportCol colhead="Area" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].scAreaTot colDec=1
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2] - Area"   Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-5" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colhead   = {  "Area"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].scAreaTot", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colDec"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colDec    = {  1  }

   ; exportCol colhead="Vol" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].tankVol colDec=1
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3] - Vol"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-6" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colhead   = {  "Vol"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].tankVol", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colDec"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colDec    = {  1  }

   ; exportCol colhead="SSF" colVal=@DhwSys["dhwsys-DHWGas"].SSFAnnual
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4] - SSF"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-7" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colhead   = {  "SSF"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].SSFAnnual", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }

   ; added export columns for reporting CHPWH autosizing results - SAC 07/08/21 (tic #1275)
   "Create cseDHWHEATER:AutoSzExpCol[1] - Cap"     cseDHWHEATER:AutoSzExpCol[1]  =
      {  if (IfValidAnd( CSESizingRunRequired > 0 )==0) then  UNDEFINED
         else  CreateComp( cseEXPORTCOL, substr( Name, 0, 44 ) + "-autoszCapExpCol" )  endif  }
   "Set cseDHWHEATER:AutoSzExpCol[1]:Parent"       cseDHWHEATER:AutoSzExpCol[1]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
   "Set cseDHWHEATER:AutoSzExpCol[1]:colhead"      cseDHWHEATER:AutoSzExpCol[1]:colhead   = {  Name + "-cap"  }
   "Set cseDHWHEATER:AutoSzExpCol[1]:colVal_x"     cseDHWHEATER:AutoSzExpCol[1]:colVal_x  = {  Format( "@DHWHEATER[%c%s%c].heatingCap", 34, Name, 34 )  }

   "Create cseDHWHEATER:AutoSzExpCol[2] - Vol"     cseDHWHEATER:AutoSzExpCol[2]  =
      {  if (IfValidAnd( CSESizingRunRequired > 0 )==0) then  UNDEFINED
         else  CreateComp( cseEXPORTCOL, substr( Name, 0, 44 ) + "-autoszVolExpCol" )  endif  }
   "Set cseDHWHEATER:AutoSzExpCol[2]:Parent"       cseDHWHEATER:AutoSzExpCol[2]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
   "Set cseDHWHEATER:AutoSzExpCol[2]:colhead"      cseDHWHEATER:AutoSzExpCol[2]:colhead   = {  Name + "-vol"  }
   "Set cseDHWHEATER:AutoSzExpCol[2]:colVal_x"     cseDHWHEATER:AutoSzExpCol[2]:colVal_x  = {  Format( "@DHWHEATER[%c%s%c].vol", 34, Name, 34 )  }
END
; prior version based on DHWSys
;   "Setup additional ExpCols by DHWSys"      DHWSys:Action  =
;      {  if (IfValidAnd( StdDsgnSolarSysReqd > 0 ) .AND. LocalCompAssigned( DHWSolarSysRef ) > 0 .AND.
;             SumAll( DHWSys:SolarSysSzExpDone ) < 1)
;         then  if (LocalCompAssigned( DHWSolarSysRef:cseDHWSOLARSYSRef       ) > 0 .AND.
;                   LocalCompAssigned( DHWSolarSysRef:cseDHWSOLARCOLLECTORRef ) > 0)
;               then  EvalRulelist( "CSE_DHWSys_SetupSolarSysSizingExport", 1 )
;               else  UNCHANGED  endif
;         else  UNCHANGED  endif  }
;END
;;************************************************************************* SAC 1/27/20 (StdSolarSys) 
;RULELIST "CSE_DHWSys_SetupSolarSysSizingExport" 1 0 0 1
;   ; exportCol colhead="SCMult" colVal=@DHWSolarCollector["dhwsc-dhwss-Solar1"].mult
;   "Create DHWSys:SolarSysSzExpCol[1] - SCMult" DHWSys:SolarSysSzExpCol[1]  = {
;         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-4" )  }
;   "Set DHWSys:SolarSysSzExpCol[1]:Parent"      DHWSys:SolarSysSzExpCol[1]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
;   "Set DHWSys:SolarSysSzExpCol[1]:colhead"     DHWSys:SolarSysSzExpCol[1]:colhead   = {  "SCMult"  }
;   "Set DHWSys:SolarSysSzExpCol[1]:colVal_x"    DHWSys:SolarSysSzExpCol[1]:colVal_x  = {  Format( "@DHWSolarCollector[%c%s%c].mult", 34, LocalRef( DHWSolarSysRef:cseDHWSOLARCOLLECTORRef:Name ), 34 )  }
;
;   ; exportCol colhead="Area" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].scAreaTot colDec=1
;   "Create DHWSys:SolarSysSzExpCol[2] - Area"   DHWSys:SolarSysSzExpCol[2]  = {
;         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-5" )  }
;   "Set DHWSys:SolarSysSzExpCol[2]:Parent"      DHWSys:SolarSysSzExpCol[2]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
;   "Set DHWSys:SolarSysSzExpCol[2]:colhead"     DHWSys:SolarSysSzExpCol[2]:colhead   = {  "Area"  }
;   "Set DHWSys:SolarSysSzExpCol[2]:colVal_x"    DHWSys:SolarSysSzExpCol[2]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].scAreaTot", 34, LocalRef( DHWSolarSysRef:cseDHWSOLARSYSRef:Name ), 34 )  }
;   "Set DHWSys:SolarSysSzExpCol[2]:colDec"      DHWSys:SolarSysSzExpCol[2]:colDec    = {  1  }
;
;   ; exportCol colhead="Vol" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].tankVol colDec=1
;   "Create DHWSys:SolarSysSzExpCol[3] - Vol"    DHWSys:SolarSysSzExpCol[3]  = {
;         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-6" )  }
;   "Set DHWSys:SolarSysSzExpCol[3]:Parent"      DHWSys:SolarSysSzExpCol[3]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
;   "Set DHWSys:SolarSysSzExpCol[3]:colhead"     DHWSys:SolarSysSzExpCol[3]:colhead   = {  "Vol"  }
;   "Set DHWSys:SolarSysSzExpCol[3]:colVal_x"    DHWSys:SolarSysSzExpCol[3]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].tankVol", 34, LocalRef( DHWSolarSysRef:cseDHWSOLARSYSRef:Name ), 34 )  }
;   "Set DHWSys:SolarSysSzExpCol[3]:colDec"      DHWSys:SolarSysSzExpCol[3]:colDec    = {  1  }
;
;   ; exportCol colhead="SSF" colVal=@DhwSys["dhwsys-DHWGas"].SSFAnnual
;   "Create DHWSys:SolarSysSzExpCol[4] - SSF"    DHWSys:SolarSysSzExpCol[4]  = {
;         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-7" )  }
;   "Set DHWSys:SolarSysSzExpCol[4]:Parent"      DHWSys:SolarSysSzExpCol[4]:Parent    = {  Proj:CSE_SolarSysSizExport:Name  }
;   "Set DHWSys:SolarSysSzExpCol[4]:colhead"     DHWSys:SolarSysSzExpCol[4]:colhead   = {  "SSF"  }
;   "Set DHWSys:SolarSysSzExpCol[4]:colVal_x"    DHWSys:SolarSysSzExpCol[4]:colVal_x  = {  Format( "@DhwSys[%c%s%c].SSFAnnual", 34, cseDHWSYSRef[1]:Name, 34 )  }
;
;   "Set DHWSys:SolarSysSzExpDone flag"    DHWSys:SolarSysSzExpDone  = {  1  }
;END
;*************************************************************************

;************************************************************************* SAC 1/28/20 - (tic #1013)
RULELIST "CSE_Project_SetupSolarSysSSFExport" 1 0 0 1
;*************************************************************************
   "Create Proj:CSE_PropSSFExportFile"  Proj:CSE_PropSSFExportFile  = {   CreateComp( cseEXPORTFILE, "xf-dhwSolarSys-SSF" )  }
   "Set Proj:CSE_PropSSFExportFile:xfFileName"   Proj:CSE_PropSSFExportFile:xfFileName  =
      {  ValidOr( ProjFileNameNoExt, "" ) + ValidOr( RunIDProcFile, "" ) + "-SSF.csv"  }

   "Create Proj:CSE_PropSSFExport"           Proj:CSE_PropSSFExport  = {   CreateComp( cseEXPORT, "x-dhwSolarSys-SSF" )  }
   "Set Proj:CSE_PropSSFExport:exExportfile" Proj:CSE_PropSSFExport:exExportfile  = {  CSE_PropSSFExportFile:Name  }
   "Set Proj:CSE_PropSSFExport:exType"       Proj:CSE_PropSSFExport:exType    = {  "UDT"   }
   "Set Proj:CSE_PropSSFExport:exFreq"       Proj:CSE_PropSSFExport:exFreq    = {  "YEAR"  }
;   "Set Proj:CSE_PropSSFExport:exHeader"     Proj:CSE_PropSSFExport:exHeader  = {  "COLUMNSONLY"    }
   "Set Proj:CSE_PropSSFExport:exHeader"     Proj:CSE_PropSSFExport:exHeader  = {  "YESIFNEW"    }
   "Set Proj:CSE_PropSSFExport:exFooter"     Proj:CSE_PropSSFExport:exFooter  = {  "NO"     }

   "Create Proj:CSE_PropSSFExpCol[1] - timestamp"     Proj:CSE_PropSSFExpCol[1]  = {
         if (LocalCompAssigned( CSE_PropSSFExpCol[1] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-1" )  endif  }
   "Set Proj:CSE_PropSSFExpCol[1]:Parent"    Proj:CSE_PropSSFExpCol[1]:Parent    = {  CSE_PropSSFExport:Name  }
   "Set Proj:CSE_PropSSFExpCol[1]:colhead"   Proj:CSE_PropSSFExpCol[1]:colhead   = {  "TimeStamp"  }
   "Set Proj:CSE_PropSSFExpCol[1]:colVal_x"  Proj:CSE_PropSSFExpCol[1]:colVal_x  = {  "@Top.runDateTime"  }

   "Create Proj:CSE_PropSSFExpCol[2] - CZ"      Proj:CSE_PropSSFExpCol[2]  = {
         if (LocalCompAssigned( CSE_PropSSFExpCol[2] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-2" )  endif  }
   "Set Proj:CSE_PropSSFExpCol[2]:Parent"    Proj:CSE_PropSSFExpCol[2]:Parent    = {  CSE_PropSSFExport:Name  }
   "Set Proj:CSE_PropSSFExpCol[2]:colhead"   Proj:CSE_PropSSFExpCol[2]:colhead   = {  "CZ"  }
   "Set Proj:CSE_PropSSFExpCol[2]:colVal_x"  Proj:CSE_PropSSFExpCol[2]:colVal_x  = {  "ClimateZone"  }

   "Create sets of columns for each DHWSolarSys"      DHWSolarSys:Action  =
      {  if (LocalCompAssigned( cseDHWSOLARSYSRef ) < 1 .OR.
             LocalCompAssigned( CSE_PropSSFExpCol[1] ) > 0) then  UNCHANGED
         else  EvalRulelist( "CSE_DHWSolarSys_SetupSolarSysSSFExport", 1 )  endif  }
END
;************************************************************************* SAC 1/28/20 - (tic #1013)
RULELIST "CSE_DHWSolarSys_SetupSolarSysSSFExport" 1 0 0 1
;*************************************************************************
   "Create DHWSolarSys:CSE_PropSSFExpCol[1] - Name" DHWSolarSys:CSE_PropSSFExpCol[1]  = {
         CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-3" )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:Parent"      DHWSolarSys:CSE_PropSSFExpCol[1]:Parent    = {  Proj:CSE_PropSSFExport:Name  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:colhead"     DHWSolarSys:CSE_PropSSFExpCol[1]:colhead   = {  "Name"  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:colVal_x"    DHWSolarSys:CSE_PropSSFExpCol[1]:colVal_x  = {  Format( "%c%s%c", 34, Name, 34 )  }

   ; exportCol colhead="Area" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].scAreaTot colDec=1
   "Create DHWSolarSys:CSE_PropSSFExpCol[2] - SSF"   DHWSolarSys:CSE_PropSSFExpCol[2]  = {
         CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-4" )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:Parent"      DHWSolarSys:CSE_PropSSFExpCol[2]:Parent    = {  Proj:CSE_PropSSFExport:Name  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colhead"     DHWSolarSys:CSE_PropSSFExpCol[2]:colhead   = {  "SSF"  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colVal_x"    DHWSolarSys:CSE_PropSSFExpCol[2]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].SSFAnnual", 34, cseDHWSOLARSYSRef:Name, 34 )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colDec"      DHWSolarSys:CSE_PropSSFExpCol[2]:colDec    = {  3  }
END
;*************************************************************************


;************************************************************************* SAC 5/2/20 (FlexibilityCredit) 
RULELIST "CSE_Project_SetupDHWMinusSolarSysRun" 1 0 0 1
   ; store and then remove any SolarSys or SSF settings for each cseDHWSYS
   "Store cseDHWSYS:wsSolarSys"     cseDHWSYS:StoreWSSolarSys  =  
      {  if (LocalStatus( wsSolarSys ) < 1) then  UNDEFINED
         else  wsSolarSys  endif  }
   "Store cseDHWSYS:wsSSF"          cseDHWSYS:StoreWSSSF  =  
      {  if (LocalStatus( wsSSF ) < 1) then  UNDEFINED
         else  wsSSF  endif  }
   "Store cseDHWSYS:wsSSF_x"        cseDHWSYS:StoreWSSSF_x  =  
      {  if (LocalStatus( wsSSF_x ) < 1) then  UNDEFINED
         else  wsSSF_x  endif  }

   "Blast cseDHWSYS:wsSolarSys (if needed)"  cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsSSF (if needed)"       cseDHWSYS:wsSSF  =
      {  if (LocalStatus( StoreWSSSF )      < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsSSF_x (if needed)"     cseDHWSYS:wsSSF_x  =
      {  if (LocalStatus( StoreWSSSF_x )    < 1) then  UNCHANGED
         else  UNDEFINED  endif  }


   ; setup EXPORT(s) to output hourly DHW results (if needed)

END
;************************************************************************* SAC 5/2/20 (FlexibilityCredit) 
RULELIST "CSE_Project_RestoreFollowingDHWMinusSolarSysRun" 1 0 0 1
   ; restore all SolarSys & SSF settings following the no-solar run
   "Restore cseDHWSYS:wsSolarSys"   cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  StoreWSSolarSys  endif  }
   "Restore cseDHWSYS:wsSSF"        cseDHWSYS:wsSSF  =
      {  if (LocalStatus( StoreWSSSF      ) < 1) then  UNCHANGED
         else  StoreWSSSF  endif  }
   "Restore cseDHWSYS:wsSSF_x"      cseDHWSYS:wsSSF_x  =
      {  if (LocalStatus( StoreWSSSF_x    ) < 1) then  UNCHANGED
         else  StoreWSSSF_x  endif  }
END
;*************************************************************************


; SAC 1/8/19 - removed - part of experimental iterative HPWH sizing mechanism where first run was ElecRes to establish consistent comparisons
;     ; SAC 12/29/18 - rulelist to replace Std HPWH w/ LrgInst Elec Res for first sizing run to establish denominator of small central HPWH sizing target (HPWHSIZE)
;     ;*************************************************************************
;     RULELIST  "cseDHWHEATER_InstallSizingElecRes" 1 0 0 1
;        "Override cseDHWHEATER:whType"      cseDHWHEATER:whType     = {  "LargeInstantaneous"  }
;        "Override cseDHWHEATER:whHeatSrc"   cseDHWHEATER:whHeatSrc  = {  "Resistance"          }
;        "Override cseDHWHEATER:whMult"      cseDHWHEATER:whMult     = {  1  }
;        "Override cseDHWHEATER:whEff"       cseDHWHEATER:whEff      = {  1  }
;     
;        "Blast cseDHWHEATER:whASHPType"     cseDHWHEATER:whASHPType = {  UNDEFINED  }
;        "Blast cseDHWHEATER:whMult_x"       cseDHWHEATER:whMult_x   = {  UNDEFINED  }
;     ;   "Blast cseDHWHEATER:whXBUEndUse" = RVal: "User2"
;        "Blast cseDHWHEATER:whTEx_x"        cseDHWHEATER:whTEx_x    = {  UNDEFINED  }
;     END
;     ; SAC 12/29/18 - rulelist to RESTORE Std HPWH following first small central HPWH sizing run (that used LrgInst Elec Res) (HPWHSIZE)
;     ;*************************************************************************
;     RULELIST  "cseDHWHEATER_RestoreStdElecDHWHeater" 1 0 0 1
;        "Restore cseDHWHEATER:whType"       cseDHWHEATER:whType      = {  "SmallStorage"  }
;        "Restore cseDHWHEATER:whHeatSrc"    cseDHWHEATER:whHeatSrc   = {  "ASHPX"  }
;        "Restore cseDHWHEATER:whASHPType"   cseDHWHEATER:whASHPType  = {  "GE2012"  }
;        "Restore cseDHWHEATER:whMult_x"     cseDHWHEATER:whMult_x    = {  Format( "%g * HPWHSIZE", StoreWHMult )  }
;     ;   "Restore cseDHWHEATER:whXBUEndUse = RVal: "User2"
;        "Restore cseDHWHEATER:whTEx_x"      cseDHWHEATER:whTEx_x     = {
;              if (IfValidAnd( whZone:znModel = 3 ))   ; "CZM"
;              then  "70"
;              else  "$tDbO"  endif  }
;     
;        "Blast cseDHWHEATER:whMult"         cseDHWHEATER:whMult     = {  UNDEFINED  }
;        "Blast cseDHWHEATER:whEff"          cseDHWHEATER:whEff      = {  UNDEFINED  }
;     END
;     ;*************************************************************************


;*************************************************************************  - SAC 1/7/19
RULELIST "Setup_cseDHWHEATREC_SFam" 1 0 0 1
	; cseDHWHEATREC setup
   "Create Child cseDHWHEATREC - 1"    cseDHWSYS:ChildcseDHWHEATRECs[1]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[1] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[1]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[1] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[1] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[1] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( SourceDHWSys:DWHRSysRef[1]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[1]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[1]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[1]  }    - SAC 3/5/19 - removed wrConfig & added wrCountFXDrain, wrCountFXCold & wrFeedsWH
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain = {  SourceDHWSys:DWHRSysShowers[1]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[1]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[1] != 0) then "Yes" else "No" endif  }

   "Create Child cseDHWHEATREC - 2"    cseDHWSYS:ChildcseDHWHEATRECs[2]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[2] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[2]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[2] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[2] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[2] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( SourceDHWSys:DWHRSysRef[2]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[2]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[2]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[2]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain  = {  SourceDHWSys:DWHRSysShowers[2]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[2]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[2] != 0) then "Yes" else "No" endif  }

   "Create Child cseDHWHEATREC - 3"    cseDHWSYS:ChildcseDHWHEATRECs[3]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[3] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[3]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[3] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[3] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[3] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( SourceDHWSys:DWHRSysRef[3]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[3]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[3]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[3]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain  = {  SourceDHWSys:DWHRSysShowers[3]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[3]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[3] != 0) then "Yes" else "No" endif  }

   "Create Child cseDHWHEATREC - 4"    cseDHWSYS:ChildcseDHWHEATRECs[4]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[4] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[4]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[4] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[4] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[4] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( SourceDHWSys:DWHRSysRef[4]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[4]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[4]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[4]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain  = {  SourceDHWSys:DWHRSysShowers[4]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[4]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[4] != 0) then "Yes" else "No" endif  }

   "Create Child cseDHWHEATREC - 5"    cseDHWSYS:ChildcseDHWHEATRECs[5]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[5] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[5]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[5] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[5] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[5] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( SourceDHWSys:DWHRSysRef[5]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[5]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[5]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[5]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain  = {  SourceDHWSys:DWHRSysShowers[5]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[5]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[5] != 0) then "Yes" else "No" endif  }

   "Create Child cseDHWHEATREC - 6"    cseDHWSYS:ChildcseDHWHEATRECs[6]  = {
         if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DWHRSysRef[6] ) < 1) then  UNCHANGED
         else if (IfValidAnd( SourceDHWSys:DWHRSysRef[6]:CSARatedEff > 0 ) .AND. SourceDHWSys:DWHRSysShowers[6] > 0 .AND.
                  (SourceDHWSys:DWHRSysTakeCold[6] > 0 .OR. SourceDHWSys:DWHRSysFeedHeater[6] > 0))
         then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( SourceDHWSys:DWHRSysRef[6]:Name, 0, 44 ) )
         else  UNCHANGED  endif endif  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys  = {  SourceDHWSys:DWHRSysRef[6]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[6]:wrConfig    = {  SourceDHWSys:DWHRSysConfig[6]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain" cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain  = {  SourceDHWSys:DWHRSysShowers[6]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold"  cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold  = {  SourceDHWSys:DWHRSysTakeCold[6]  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH"      cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH      = {  if (SourceDHWSys:DWHRSysFeedHeater[6] != 0) then "Yes" else "No" endif  }
END
;*************************************************************************  - SAC 1/7/19
RULELIST "Setup_cseDHWHEATREC_MFam" 1 0 0 1
	; cseDHWHEATREC setup
      ; SAC 4/1/19 - restored w/ final MFam DWHR work in CSE completed
   "Create Child cseDHWHEATREC - 1"    cseDHWSYS:ChildcseDHWHEATRECs[1]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[1] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[1] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold1[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater1[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold1[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater1[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold1[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater1[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold1[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater1[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold1[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater1[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef1[1]       case 2 : SourceDwellUnitType:DWHRSysRef1[2]
         case 3 : SourceDwellUnitType:DWHRSysRef1[3]       case 4 : SourceDwellUnitType:DWHRSysRef1[4]
         case 5 : SourceDwellUnitType:DWHRSysRef1[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[1]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig1[1]    case 2 : SourceDwellUnitType:DWHRSysConfig1[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig1[3]    case 4 : SourceDwellUnitType:DWHRSysConfig1[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig1[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers1[1]   case 2 : SourceDwellUnitType:DWHRSysShowers1[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers1[3]   case 4 : SourceDwellUnitType:DWHRSysShowers1[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers1[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold1[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold1[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold1[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold1[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold1[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater1[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater1[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater1[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater1[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater1[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }

   "Create Child cseDHWHEATREC - 2"    cseDHWSYS:ChildcseDHWHEATRECs[2]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef2[1] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef2[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers2[1] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold2[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater2[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef2[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef2[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers2[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold2[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater2[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef2[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef2[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers2[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold2[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater2[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef2[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef2[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers2[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold2[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater2[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef2[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef2[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers2[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold2[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater2[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef2[1]       case 2 : SourceDwellUnitType:DWHRSysRef2[2]
         case 3 : SourceDwellUnitType:DWHRSysRef2[3]       case 4 : SourceDwellUnitType:DWHRSysRef2[4]
         case 5 : SourceDwellUnitType:DWHRSysRef2[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[2]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig2[1]    case 2 : SourceDwellUnitType:DWHRSysConfig2[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig2[3]    case 4 : SourceDwellUnitType:DWHRSysConfig2[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig2[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers2[1]   case 2 : SourceDwellUnitType:DWHRSysShowers2[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers2[3]   case 4 : SourceDwellUnitType:DWHRSysShowers2[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers2[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold2[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold2[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold2[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold2[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold2[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater2[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater2[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater2[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater2[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater2[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }

   "Create Child cseDHWHEATREC - 3"    cseDHWSYS:ChildcseDHWHEATRECs[3]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef3[1] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef3[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers3[1] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold3[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater3[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef3[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef3[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers3[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold3[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater3[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef3[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef3[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers3[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold3[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater3[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef3[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef3[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers3[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold3[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater3[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef3[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef3[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers3[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold3[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater3[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef3[1]       case 2 : SourceDwellUnitType:DWHRSysRef3[2]
         case 3 : SourceDwellUnitType:DWHRSysRef3[3]       case 4 : SourceDwellUnitType:DWHRSysRef3[4]
         case 5 : SourceDwellUnitType:DWHRSysRef3[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[3]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig3[1]    case 2 : SourceDwellUnitType:DWHRSysConfig3[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig3[3]    case 4 : SourceDwellUnitType:DWHRSysConfig3[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig3[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers3[1]   case 2 : SourceDwellUnitType:DWHRSysShowers3[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers3[3]   case 4 : SourceDwellUnitType:DWHRSysShowers3[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers3[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold3[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold3[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold3[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold3[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold3[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater3[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater3[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater3[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater3[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater3[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }

   "Create Child cseDHWHEATREC - 4"    cseDHWSYS:ChildcseDHWHEATRECs[4]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef4[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef4[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers4[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold4[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater4[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef4[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef4[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers4[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold4[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater4[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef4[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef4[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers4[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold4[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater4[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef4[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef4[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers4[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold4[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater4[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef4[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef4[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers4[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold4[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater4[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef4[1]       case 2 : SourceDwellUnitType:DWHRSysRef4[2]
         case 3 : SourceDwellUnitType:DWHRSysRef4[3]       case 4 : SourceDwellUnitType:DWHRSysRef4[4]
         case 5 : SourceDwellUnitType:DWHRSysRef4[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[4]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig4[1]    case 2 : SourceDwellUnitType:DWHRSysConfig4[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig4[3]    case 4 : SourceDwellUnitType:DWHRSysConfig4[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig4[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers4[1]   case 2 : SourceDwellUnitType:DWHRSysShowers4[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers4[3]   case 4 : SourceDwellUnitType:DWHRSysShowers4[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers4[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold4[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold4[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold4[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold4[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold4[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater4[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater4[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater4[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater4[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater4[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }

   "Create Child cseDHWHEATREC - 5"    cseDHWSYS:ChildcseDHWHEATRECs[5]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef5[1] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef5[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers5[1] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold5[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater5[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef5[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef5[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers5[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold5[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater5[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef5[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef5[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers5[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold5[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater5[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef5[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef5[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers5[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold5[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater5[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef5[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef5[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers5[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold5[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater5[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef5[1]       case 2 : SourceDwellUnitType:DWHRSysRef5[2]
         case 3 : SourceDwellUnitType:DWHRSysRef5[3]       case 4 : SourceDwellUnitType:DWHRSysRef5[4]
         case 5 : SourceDwellUnitType:DWHRSysRef5[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[5]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig5[1]    case 2 : SourceDwellUnitType:DWHRSysConfig5[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig5[3]    case 4 : SourceDwellUnitType:DWHRSysConfig5[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig5[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers5[1]   case 2 : SourceDwellUnitType:DWHRSysShowers5[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers5[3]   case 4 : SourceDwellUnitType:DWHRSysShowers5[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers5[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold5[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold5[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold5[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold5[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold5[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater5[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater5[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater5[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater5[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater5[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }

   "Create Child cseDHWHEATREC - 6"    cseDHWSYS:ChildcseDHWHEATRECs[6]  = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef6[1] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef6[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers6[1] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[1] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold6[1] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater6[1] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef6[2] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef6[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers6[2] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[2] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold6[2] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater6[2] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef6[3] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef6[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers6[3] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[3] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold6[3] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater6[3] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef6[4] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef6[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers6[4] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[4] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold6[4] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater6[4] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef6[5] ) < 1) then  UNCHANGED
                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef6[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers6[5] > 0 ) .AND.
                           ((IfValidAnd( SourceDwellUnitType:AllowShowerDWHR[5] > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysTakeCold6[5] > 0 )) .OR. IfValidAnd( SourceDwellUnitType:DWHRSysFeedHeater6[5] > 0 )))
                  then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + substr( Name, 0, 44 ) )
                  else  UNCHANGED  endif endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysRef6[1]       case 2 : SourceDwellUnitType:DWHRSysRef6[2]
         case 3 : SourceDwellUnitType:DWHRSysRef6[3]       case 4 : SourceDwellUnitType:DWHRSysRef6[4]
         case 5 : SourceDwellUnitType:DWHRSysRef6[5]       default : UNCHANGED
      endswitch  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrConfig"       cseDHWSYS:ChildcseDHWHEATRECs[6]:wrConfig    = {
;      switch (DUTypeDHWSysIndex)
;         case 1 : SourceDwellUnitType:DWHRSysConfig6[1]    case 2 : SourceDwellUnitType:DWHRSysConfig6[2]
;         case 3 : SourceDwellUnitType:DWHRSysConfig6[3]    case 4 : SourceDwellUnitType:DWHRSysConfig6[4]
;         case 5 : SourceDwellUnitType:DWHRSysConfig6[5]    default : UNCHANGED
;      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain  = {
      switch (DUTypeDHWSysIndex)
         case 1 : SourceDwellUnitType:DWHRSysShowers6[1]   case 2 : SourceDwellUnitType:DWHRSysShowers6[2]
         case 3 : SourceDwellUnitType:DWHRSysShowers6[3]   case 4 : SourceDwellUnitType:DWHRSysShowers6[4]
         case 5 : SourceDwellUnitType:DWHRSysShowers6[5]   default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold   = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:AllowShowerDWHR[1] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold6[1]  endif
         case 2 : if (SourceDwellUnitType:AllowShowerDWHR[2] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold6[2]  endif
         case 3 : if (SourceDwellUnitType:AllowShowerDWHR[3] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold6[3]  endif
         case 4 : if (SourceDwellUnitType:AllowShowerDWHR[4] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold6[4]  endif
         case 5 : if (SourceDwellUnitType:AllowShowerDWHR[5] < 1) then  UNCHANGED
                  else  SourceDwellUnitType:DWHRSysTakeCold6[5]  endif
         default : UNCHANGED
      endswitch  }
   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH       = {
      switch (DUTypeDHWSysIndex)
         case 1 : if (SourceDwellUnitType:DWHRSysFeedHeater6[1] != 0) then "Yes" else "No" endif
         case 2 : if (SourceDwellUnitType:DWHRSysFeedHeater6[2] != 0) then "Yes" else "No" endif
         case 3 : if (SourceDwellUnitType:DWHRSysFeedHeater6[3] != 0) then "Yes" else "No" endif
         case 4 : if (SourceDwellUnitType:DWHRSysFeedHeater6[4] != 0) then "Yes" else "No" endif
         case 5 : if (SourceDwellUnitType:DWHRSysFeedHeater6[5] != 0) then "Yes" else "No" endif
         default : UNCHANGED
      endswitch  }
END
;*************************************************************************



;*************************************************************************   - SAC 1/3/19 - rules to 
RULELIST  "CSE_DHWSystem_CalculateHPWHMultiplier" 1 0 0 1
   ;  x = # of water heaters
   ;  y = energy or TDV or whatever
   ;  Results from 3 runs are (x1, y1), (x2, y2), and (x3, y3).  x1, x2, and x3 must all have different values (else divide by 0, see below).
   ;  Fitted parabola is y = Ax^2 + Bx + C
   ;  Find A, B, C from 3 points --
   ;  A = (x3 * (y2 - y1) + x2 * (y1 - y3) + x1 * (y3 - y2))
   ;  B = (x3^2 * (y1 - y2) + x2^2 * (y3 - y1) + x1^2 * (y2 - y3))
   ;  Now find x for minimum y ... slope is 0 at minimum.
   ;  0 = 2Ax + B
   ;  x = -B / 2A    - SAC 1/3/19 - added min val of 1.0
   ;
   ;  FullA = A(above) / (x1 - x2)(x1 - x3)(x2 - x3)
   ;  Note 1: if FullA < 0, then the parabola opens *down* and the runs are not behaving as expected.
   ;  Note 2: A, B, and C can also be found with simple matrix operations ... if those are available, this could be done with less code.

   ; SAC 1/4/19 - added separate calc of Coef A w/ error message when it goes negative (inverted parabola) and also lowered min CentralWHMult from 1 to 0.2
   "Set cseDHWSYS:CentralWHMultCoefA based on sizing run results"    cseDHWSYS:CentralWHMultCoefA  = {
         (SourceDHWSys:StdHPWHSzRunMlts[3] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[1]) +
          SourceDHWSys:StdHPWHSzRunMlts[2] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[3]) + 
          SourceDHWSys:StdHPWHSzRunMlts[1] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[2])) /
         ((SourceDHWSys:StdHPWHSzRunMlts[1] - SourceDHWSys:StdHPWHSzRunMlts[2]) *
          (SourceDHWSys:StdHPWHSzRunMlts[1] - SourceDHWSys:StdHPWHSzRunMlts[3]) *
          (SourceDHWSys:StdHPWHSzRunMlts[2] - SourceDHWSys:StdHPWHSzRunMlts[3]))  }
   "Post error if cseDHWSYS:CentralWHMult parabola is inverted or flat"    cseDHWSYS:Action  = {
         if (IfValidAnd( CentralWHMultCoefA > 0 )) then  UNCHANGED
         else if (LocalStatus( CentralWHMultCoefA ) < 1)
         then  PostError( "Unable to determine standard design HPWH size for DHWSys '%s', cseDHWSYS '%s':  CentralWHMultCoefA undefined", SourceDHWSys:Name, Name )
         else  PostError( "Unable to determine standard design HPWH size for DHWSys '%s', cseDHWSYS '%s':  CentralWHMultCoefA = %g", SourceDHWSys:Name, Name, CentralWHMultCoefA )
         endif endif  }

   "Set cseDHWSYS:CentralWHMult based on sizing run results"      cseDHWSYS:CentralWHMult  = {
      if (IfValidAnd( CentralWHMultCoefA > 0 )==0) then  SourceDHWSys:StdHPWHSzRunMlts[2]  ; initial guess
      else
         max( 0.2,
            -( SourceDHWSys:StdHPWHSzRunMlts[3]*SourceDHWSys:StdHPWHSzRunMlts[3] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[2]) +
               SourceDHWSys:StdHPWHSzRunMlts[2]*SourceDHWSys:StdHPWHSzRunMlts[2] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[1]) +
               SourceDHWSys:StdHPWHSzRunMlts[1]*SourceDHWSys:StdHPWHSzRunMlts[1] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[3]) ) /
             (2 * (SourceDHWSys:StdHPWHSzRunMlts[3] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[1]) +
                   SourceDHWSys:StdHPWHSzRunMlts[2] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[3]) + 
                   SourceDHWSys:StdHPWHSzRunMlts[1] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[2]))) )
      endif  }

   "Round cseDHWSYS:CentralWHMult to nearest tenth"      cseDHWSYS:CentralWHMult  = {
      if (IfValidAnd( CentralWHMult > 0 )==0) then  UNCHANGED
      else  int( (CentralWHMult*10)+0.5 ) / 10
      endif  }
END
;*************************************************************************


;************************************************************************* SAC 1/15/20 (tic #1013)
RULELIST "CSE_SimulationPrep_DHW_SolarSys" 1 0 0 1
;   Rules to setup DHWSOLARSYS & DHWSOLARCOLLECTOR objects 
;*************************************************************************
   "Create a CSE DHWSOLARSYS for this DHWSolarSys"    DHWSolarSys:cseDHWSOLARSYSRef  =
      {  CreateComp( cseDHWSOLARSYS, "dhwss-" + substr( Name, 0, 44 ) )  }
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swElecMtr"      DHWSolarSys:cseDHWSOLARSYSRef:swElecMtr  = {  Proj:CSE_ElecMETER  }
;           "swEndUse",          BEMP_Str,  1,  0,  1, "",                 0,  0,                          3208, "enduse to accumulate solar water heating to (default to DHW)"
;           "swParElec",         BEMP_Flt,  1,  0,  1, "W",                0,  0,                          3208, "electrical parasitic power to represent recirculation pumps or other system-level electrical devices" 
;           "swTankMult",        BEMP_Flt,  1,  0,  1, "",                 0,  0,                          3201, "tank multiplier" 
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankVol"      DHWSolarSys:cseDHWSOLARSYSRef:swTankVol     =      ; SAC 1/28/20 (StdSolarSys)
      {  if (IfValidAnd( TankVolume > 0 )) then  TankVolume
         else  UNDEFINED  endif  }
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankInsulR"   DHWSolarSys:cseDHWSOLARSYSRef:swTankInsulR  = {  12  }
;           "swTankUA",          BEMP_Flt,  1,  0,  0, "",                 0,  0,                          8005, "tank UA"  
;           "swTankZone",        BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseZONE",    0, "",     3201, "Zone tank located in"
;           "swTankTEx",         BEMP_Flt,  1,  0,  1, "F",               0,  0,                          3208, "temperature surrounding tank" 
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankTEx_x"    DHWSolarSys:cseDHWSOLARSYSRef:swTankTEx_x   = {  "($tDbO + 70) / 2"  }  ; SAC 2/24/20 - equivalent to unconditioned

   "Create a CSE DHWSOLARCOLLECTOR for this DHWSolarSys"    DHWSolarSys:cseDHWSOLARCOLLECTORRef  =
      {  CreateComp( cseDHWSOLARCOLLECTOR, "dhwsc-" + substr( Name, 0, 44 ) )  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:Parent"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:Parent  = {  cseDHWSOLARSYSRef:Name  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scArea"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scArea  = {  Area  }  ; 25  }

   "Force DHWSolarSys:CountFlt to (int) Count if not EnableResearchMode"   DHWSolarSys:CountFlt  =       ; SAC 1/25/20 - added only for EnableResearchMode (per BAW request)
      {  if (IfValidAnd( Proj:EnableResearchMode > 0 )) then  UNCHANGED
         else  ValidOr( Count, 1 )  endif  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scMult"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scMult  = {  CountFlt  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scTilt"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scTilt  = {  Tilt  }  ; 30  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scAzm"       DHWSolarSys:cseDHWSOLARCOLLECTORRef:scAzm   = {  Azimuth  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRUL_x"    DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRUL_x ={  Format( "%g * 0.17611", EffCurveSlope )  }   ; testing: "-0.7"    ; conversion of SRCC slope units (W/m2-C) to CSE IP (Btuh/ft2-F) - per e-mail from CB 1/15/20
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRTA"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRTA  = {  EffCurveYInt  }  ; testing: 0.6
;           "scPumpPwr",         BEMP_Flt,  1,  0,  1, "W",                0,  0,                          3201, "pump power (watts)" 
;           "scPumpFlow",        BEMP_Flt,  1,  0,  1, "GPM",              0,  0,                          3208, "pump flow" 
;           "scPumpLiqHeatF",    BEMP_Flt,  1,  0,  1, "",                 0,  0,                          3208, "pump liquid HeatF" 

   "Set DHWSolarSys:CSESimValid"    DHWSolarSys:CSESimValid  =
      {  if (LocalCompAssigned( cseDHWSOLARSYSRef ) > 0 .AND.
             IfValidAnd( cseDHWSOLARCOLLECTORRef:scArea > 0 )) then  1
         else  UNDEFINED  endif  }
END
;*************************************************************************


; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	;*************************************************************************
;	RULELIST "CSE_SimulationPrep_DHWHtr_LDEF" 1 0 0 1
;	;*************************************************************************
;	
;		"Set cseDHWHEATER:LDEFCoefs[1] - a"		cseDHWHEATER:LDEFCoefs[1]	= {	switch (whHeatSrc)
;																											case  1 :	-0.098311	; Gas, Propane, Oil
;																											case  2 :	-0.91263		; Electric
;																											default :	 0.44189		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[2] - b"		cseDHWHEATER:LDEFCoefs[2]	= {	switch (whHeatSrc)
;																											case  1 :	 0.240182	; Gas, Propane, Oil
;																											case  2 :	 0.94278		; Electric
;																											default :	-0.28361		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[3] - c"		cseDHWHEATER:LDEFCoefs[3]	= {	switch (whHeatSrc)
;																											case  1 :	 1.356491	; Gas, Propane, Oil
;																											case  2 :	 4.31687		; Electric
;																											default :	-0.71673		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[4] - d"		cseDHWHEATER:LDEFCoefs[4]	= {	switch (whHeatSrc)
;																											case  1 :	-0.872446	; Gas, Propane, Oil
;																											case  2 :	-3.42732		; Electric
;																											default :	 1.13480		; Heat Pump
;																										endswitch  }
;	
;		"Convert cseDHWHEATER:whEF into LDEF (load dependent energy factor)"
;				cseDHWHEATER:whEF		= {	( log(HrlyAdjRecovLoad * 24 / 1000) * ((LDEFCoefs[1] * whEF) + LDEFCoefs[2]) ) + ((LDEFCoefs[3] * whEF) + LDEFCoefs[4])  }
;	END


;*************************************************************************
;*************************************************************************

ENDFILE
